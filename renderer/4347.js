(global.webpackChunkxmind_vana=global.webpackChunkxmind_vana||[]).push([[4347],{4143:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var n=a(23645),l=a.n(n)()((function(e){return e[1]}));l.push([e.id,".uk-text-line-clamp[data-v-f08e9528] {\n  display: -webkit-box;\n  overflow: hidden;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n}\n.note-panel-note-text[data-v-f08e9528] {\n  margin-top: 8px;\n}\n",""]);const i=l},47063:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var n=a(23645),l=a.n(n)()((function(e){return e[1]}));l.push([e.id,".lm-select-icon[data-v-72789004] {\n  visibility: hidden;\n}\n.lm-view-item[data-v-72789004]:focus {\n  background-color: transparent;\n}\n.lm-view-item:hover .lm-select-icon[data-v-72789004] {\n  visibility: visible;\n}\n",""]);const i=l},35278:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var n=a(23645),l=a.n(n)()((function(e){return e[1]}));l.push([e.id,".search-panel-sheet-title[data-v-0fb2d3e2] {\n  margin: 20px 0 16px;\n  font-size: 21px;\n  font-weight: 700;\n  line-height: 27px;\n  letter-spacing: 0.21px;\n}\n",""]);const i=l},47443:(e,t,a)=>{var n=a(42118);e.exports=function(e,t){return!!(null==e?0:e.length)&&n(e,t,0)>-1}},1196:e=>{e.exports=function(e,t,a){for(var n=-1,l=null==e?0:e.length;++n<l;)if(a(t,e[n]))return!0;return!1}},29932:e=>{e.exports=function(e,t){for(var a=-1,n=null==e?0:e.length,l=Array(n);++a<n;)l[a]=t(e[a],a,e);return l}},41848:e=>{e.exports=function(e,t,a,n){for(var l=e.length,i=a+(n?1:-1);n?i--:++i<l;)if(t(e[i],i,e))return i;return-1}},97786:(e,t,a)=>{var n=a(71811),l=a(40327);e.exports=function(e,t){for(var a=0,i=(t=n(t,e)).length;null!=e&&a<i;)e=e[l(t[a++])];return a&&a==i?e:void 0}},13:e=>{e.exports=function(e,t){return null!=e&&t in Object(e)}},42118:(e,t,a)=>{var n=a(41848),l=a(62722),i=a(39375);e.exports=function(e,t,a){return t==t?i(e,t,a):n(e,l,a)}},2958:(e,t,a)=>{var n=a(46384),l=a(90939);e.exports=function(e,t,a,i){var o=a.length,s=o,r=!i;if(null==e)return!s;for(e=Object(e);o--;){var c=a[o];if(r&&c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++o<s;){var u=(c=a[o])[0],p=e[u],d=c[1];if(r&&c[2]){if(void 0===p&&!(u in e))return!1}else{var h=new n;if(i)var v=i(p,d,u,e,t,h);if(!(void 0===v?l(d,p,3,i,h):v))return!1}}return!0}},62722:e=>{e.exports=function(e){return e!=e}},67206:(e,t,a)=>{var n=a(91573),l=a(16432),i=a(6557),o=a(1469),s=a(39601);e.exports=function(e){return"function"==typeof e?e:null==e?i:"object"==typeof e?o(e)?l(e[0],e[1]):n(e):s(e)}},91573:(e,t,a)=>{var n=a(2958),l=a(1499),i=a(42634);e.exports=function(e){var t=l(e);return 1==t.length&&t[0][2]?i(t[0][0],t[0][1]):function(a){return a===e||n(a,e,t)}}},16432:(e,t,a)=>{var n=a(90939),l=a(27361),i=a(79095),o=a(15403),s=a(89162),r=a(42634),c=a(40327);e.exports=function(e,t){return o(e)&&s(t)?r(c(e),t):function(a){var o=l(a,e);return void 0===o&&o===t?i(a,e):n(t,o,3)}}},40371:e=>{e.exports=function(e){return function(t){return null==t?void 0:t[e]}}},79152:(e,t,a)=>{var n=a(97786);e.exports=function(e){return function(t){return n(t,e)}}},80531:(e,t,a)=>{var n=a(62705),l=a(29932),i=a(1469),o=a(33448),s=n?n.prototype:void 0,r=s?s.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(i(t))return l(t,e)+"";if(o(t))return r?r.call(t):"";var a=t+"";return"0"==a&&1/t==-Infinity?"-0":a}},45652:(e,t,a)=>{var n=a(88668),l=a(47443),i=a(1196),o=a(74757),s=a(23593),r=a(21814);e.exports=function(e,t,a){var c=-1,u=l,p=e.length,d=!0,h=[],v=h;if(a)d=!1,u=i;else if(p>=200){var m=t?null:s(e);if(m)return r(m);d=!1,u=o,v=new n}else v=t?[]:h;e:for(;++c<p;){var f=e[c],y=t?t(f):f;if(f=a||0!==f?f:0,d&&y==y){for(var k=v.length;k--;)if(v[k]===y)continue e;t&&v.push(y),h.push(f)}else u(v,y,a)||(v!==h&&v.push(y),h.push(f))}return h}},71811:(e,t,a)=>{var n=a(1469),l=a(15403),i=a(55514),o=a(79833);e.exports=function(e,t){return n(e)?e:l(e,t)?[e]:i(o(e))}},23593:(e,t,a)=>{var n=a(58525),l=a(50308),i=a(21814),o=n&&1/i(new n([,-0]))[1]==1/0?function(e){return new n(e)}:l;e.exports=o},1499:(e,t,a)=>{var n=a(89162),l=a(3674);e.exports=function(e){for(var t=l(e),a=t.length;a--;){var i=t[a],o=e[i];t[a]=[i,o,n(o)]}return t}},222:(e,t,a)=>{var n=a(71811),l=a(35694),i=a(1469),o=a(65776),s=a(41780),r=a(40327);e.exports=function(e,t,a){for(var c=-1,u=(t=n(t,e)).length,p=!1;++c<u;){var d=r(t[c]);if(!(p=null!=e&&a(e,d)))break;e=e[d]}return p||++c!=u?p:!!(u=null==e?0:e.length)&&s(u)&&o(d,u)&&(i(e)||l(e))}},15403:(e,t,a)=>{var n=a(1469),l=a(33448),i=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,o=/^\w*$/;e.exports=function(e,t){if(n(e))return!1;var a=typeof e;return!("number"!=a&&"symbol"!=a&&"boolean"!=a&&null!=e&&!l(e))||(o.test(e)||!i.test(e)||null!=t&&e in Object(t))}},89162:(e,t,a)=>{var n=a(13218);e.exports=function(e){return e==e&&!n(e)}},42634:e=>{e.exports=function(e,t){return function(a){return null!=a&&(a[e]===t&&(void 0!==t||e in Object(a)))}}},24523:(e,t,a)=>{var n=a(88306);e.exports=function(e){var t=n(e,(function(e){return 500===a.size&&a.clear(),e})),a=t.cache;return t}},39375:e=>{e.exports=function(e,t,a){for(var n=a-1,l=e.length;++n<l;)if(e[n]===t)return n;return-1}},55514:(e,t,a)=>{var n=a(24523),l=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,i=/\\(\\)?/g,o=n((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(l,(function(e,a,n,l){t.push(n?l.replace(i,"$1"):a||e)})),t}));e.exports=o},40327:(e,t,a)=>{var n=a(33448);e.exports=function(e){if("string"==typeof e||n(e))return e;var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t}},27361:(e,t,a)=>{var n=a(97786);e.exports=function(e,t,a){var l=null==e?void 0:n(e,t);return void 0===l?a:l}},79095:(e,t,a)=>{var n=a(13),l=a(222);e.exports=function(e,t){return null!=e&&l(e,t,n)}},6557:e=>{e.exports=function(e){return e}},88306:(e,t,a)=>{var n=a(83369);function l(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var a=function(){var n=arguments,l=t?t.apply(this,n):n[0],i=a.cache;if(i.has(l))return i.get(l);var o=e.apply(this,n);return a.cache=i.set(l,o)||i,o};return a.cache=new(l.Cache||n),a}l.Cache=n,e.exports=l},50308:e=>{e.exports=function(){}},39601:(e,t,a)=>{var n=a(40371),l=a(79152),i=a(15403),o=a(40327);e.exports=function(e){return i(e)?n(o(e)):l(e)}},79833:(e,t,a)=>{var n=a(80531);e.exports=function(e){return null==e?"":n(e)}},45578:(e,t,a)=>{var n=a(67206),l=a(45652);e.exports=function(e,t){return e&&e.length?l(e,n(t,2)):[]}},3004:(e,t,a)=>{"use strict";a.d(t,{Z:()=>r});var n,l=a(2954),i=a(87141),o=a(69931);!function(e){e.NO_RESULT="NO_RESULT",e.NO_RESULT_AS_NETWORK="NO_RESULT_AS_NETWORK",e.NO_NOTE="NO_NOTE",e.NO_TAG="NO_TAG",e.NO_SELECTION="NO_SELECTION",e.NO_FORMAT_AVAILABLE="NO_FORMAT_AVAILABLE",e.SLIDE_NO_SELECTION="SLIDE_NO_SELECTION",e.BULB="BULB"}(n||(n={}));const s=(0,l.aZ)({__name:"common-none-panel",props:{type:{default:"NO_RESULT"},sectionStyle:{default:""}},setup(e){const t=e,a=(0,i.JE)().T,s=(0,l.Fl)((()=>({[n.NO_RESULT]:{image:(0,o.ju)("static/images/empty-panel-icon/no-result.svg"),text:a("No results found."),spacing:"-1px"},[n.NO_RESULT_AS_NETWORK]:{image:(0,o.ju)("static/images/empty-panel-icon/no-result.svg"),text:a("Please check your network connection and try again later."),spacing:"-1px"},[n.NO_NOTE]:{image:(0,o.ju)("static/images/empty-panel-icon/no-note.svg"),text:a("No note exists."),spacing:"-3px"},[n.NO_TAG]:{image:(0,o.ju)("static/images/empty-panel-icon/no-tag.svg"),text:a("No marker, label or task exists."),spacing:"0px"},[n.NO_SELECTION]:{image:(0,o.ju)("static/images/empty-panel-icon/empty-selection.svg"),text:a("Select an object to format."),spacing:"-2px"},[n.NO_FORMAT_AVAILABLE]:{image:(0,o.ju)("static/images/empty-panel-icon/no-format-available.svg"),text:a("This object can't be formatted."),spacing:"5px"},[n.SLIDE_NO_SELECTION]:{image:(0,o.ju)("static/images/empty-panel-icon/slide-empty-selection.svg"),text:a("Select a topic to format."),spacing:"-2px"},[n.BULB]:{image:(0,o.ju)("static/images/empty-panel-icon/zen-mode-bulb.svg"),text:a("Please switch to original appearance to enable format options."),spacing:"5px"}}))),r=(0,l.Fl)((()=>s.value[t.type]||s.value[n.NO_RESULT]));return{__sfc:!0,NonePanelType:n,props:t,$T:a,noneTabs:s,noneTab:r}}});const r=(0,a(51900).Z)(s,(function(){var e=this,t=e._self._c,a=e._self._setupProxy;return t("div",{staticClass:"uk-panel uk-height-expand uk-flex uk-flex-column uk-flex-center uk-width-1-1 uk-common-none-panel"},[t("div",{staticClass:"uk-panel",style:e.sectionStyle},[t("div",{staticClass:"uk-common-none-panel-icon"},[t("img",{staticStyle:{height:"60px",width:"60px"},attrs:{draggable:"false",src:a.noneTab.image,"uk-svg":""}})]),e._v(" "),a.noneTab.text?t("div",{staticClass:"uk-common-none-panel-text",style:{marginTop:a.noneTab.spacing}},[e._v("\n      "+e._s(a.noneTab.text)+"\n    ")]):e._e(),e._v(" "),e._t("none-text")],2)])}),[],!1,null,"52381148",null).exports},86673:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});var n=a(2954),l=a(60746),i=a(87141);const o=(0,n.aZ)({__name:"index",props:{typeCls:{default:"vk-tree-list-outliner"},items:{default:()=>[]},type:{default:"checkbox"},modelValue:{default:()=>[]},indent:{default:0},prefix:{default:""},index:null,container:null,highPerformanceMode:{type:Boolean,default:!1},width:{default:268},textWrap:{type:Boolean,default:!1},allowDirectionKey:{type:Boolean,default:!1},isLineDashVisible:{type:Boolean,default:!0}},emits:["click","update:modelValue","toggleitem"],setup(e,{expose:t,emit:a}){const o=e,{T:s}=(0,i.JE)(),r=(0,l.RS)(),c=(e,t)=>r(e,`${t} -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, Roboto, "Helvetica Neue", Arial, sans-serif`),u=(0,n.iH)({}),p=(0,n.iH)(new Set),d=(0,n.iH)({scrollTop:0,clientHeight:100});(0,n.YP)((()=>o.modelValue),((e,t)=>{null!=e&&e!==t&&(p.value=new Set(e))}),{immediate:!0});const h=e=>{const t=e.target;d.value={scrollTop:t.scrollTop,clientHeight:t.clientHeight}},v=(e=o.container)=>{e&&(d.value={scrollTop:e.scrollTop,clientHeight:e.clientHeight})};(0,n.YP)((()=>o.container),(e=>{e&&(e.addEventListener("scroll",h),v(e))}));const m=()=>{v()};(0,n.bv)((()=>{window.addEventListener("resize",m)})),(0,n.dl)((()=>{v()})),(0,n.Jd)((()=>{window.removeEventListener("resize",m),o.container&&o.container.removeEventListener("scroll",h)}));const f=(0,n.Fl)((()=>s("<Empty Text>"))),y=(0,n.Fl)((()=>{const{items:e,indent:t}=o;if(!e||!e.length)return[];const a="$ROOT_VALUE",n=[],l=(e,t,i=[])=>{const o=e.value===a,s=e.unindent||"sheetTitle"===e.slotType?t:t+1;if(o||n.push({value:e.value,current:e,indent:s,parentValues:i.map((e=>e.value))}),e.items)for(let t=0;t<e.items.length;t++){const a=e.items[t],n=i.concat(o?[]:e);l(a,s,n)}};return l({items:e,value:a},t||-1),n.forEach((e=>{const t=4+20*e.indent,a=o.width-(t+4);let n=c(e.current.text,"sheetTitle"===e.current.slotType?"700 21px":e.current.isTitle?"700 15px":"400 14px")+40;if(e.containerWidth=a,e.textWidth=n,e.singleLineWidth=t+4+n,o.textWrap){const t=Math.ceil(n/a);e.allocatedLine=t}else e.allocatedLine=1})),n})),k=(0,n.Fl)((()=>{const{value:e}=y,t=e=>b(e)&&x(e),a={},n={},l={};for(let t=0;t<e.length;t++){const n=e[t];a[n.value]=n}for(let i=0;i<e.length;i++){const o=e[i],s=o.parentValues.join(",");s in l?n[o.value]=l[s]:l[s]=n[o.value]=o.parentValues.every((e=>t(a[e].current)))}return n})),g=(0,n.Fl)((()=>{let e=y.value.filter((e=>!!k.value[e.value]));if(!o.highPerformanceMode)return{items:e,totalHeight:0};let t=0,a=0;return e.forEach((e=>{var n,l;e.currentTop=`${t}px`,e.currentTopNumber=t;let i=10+18*e.allocatedLine;"sheetTitle"===e.current.slotType&&(i=63);const s=[],r=e.textWidth/(null!==(l=null===(n=e.current.text)||void 0===n?void 0:n.length)&&void 0!==l?l:0),c=Math.floor(e.containerWidth/r);if(o.textWrap&&"sheetTitle"!==e.current.slotType)for(let t=0;t<e.allocatedLine;t++)s.push(e.current.text.slice(t*c,(t+1)*c));else a=Math.max(e.singleLineWidth,a),s.push(e.current.text);e.textLines=s,1!==s.length||s[0]||(s[0]=f.value),t+=i})),e=e.filter((e=>!(e.currentTopNumber<d.value.scrollTop-100)&&!(e.currentTopNumber>d.value.scrollTop+d.value.clientHeight+100))),{items:e,totalHeight:t,commonWidth:a}})),x=e=>e.value in u.value?Boolean(u.value[e.value]):Boolean(e.expanded),b=e=>"items"in e&&Array.isArray(e.items)&&e.items.length>0,T=e=>p.value.has(e.value),I=e=>{a("click",e)},_=e=>{u.value={...u.value,[e.value]:!x(e)},a("toggleitem",e.value)},C=async e=>{const t=new Set([e.value]);p.value=t,a("update:modelValue",Array.from(t)),I(e)},w=async(e,t)=>{t.preventDefault(),t.stopPropagation(),_(e),await(0,n.Y3)(),t.currentTarget.parentNode.focus()},S=e=>{if(!o.allowDirectionKey)return;const t=Array.from(p.value);let a=null;if(t.length){const n=g.value.items.findIndex((e=>e.value===t[0]));a=g.value.items[n+("up"===e?-1:1)]}else g.value.items.find((e=>!e.current.slotType));if(a&&!a.current.slotType){C(a.current);const e=document.querySelector(`button[data-value="${a.value}"]`);e&&e.focus()}};return t({emptyText:f,currentItems:y,visibleItems:k,displayData:g,isItemExpandable:b,isItemExpanded:x,isItemChecked:T,onToggleClick:w,onClickButton:C,onKeydown:S}),{__sfc:!0,$T:s,getTextWidthFn:r,getTextWidth:c,props:o,emit:a,itemExpansions:u,internalValue:p,scrollInfo:d,containerScrollEventHandler:h,updateScrollInfoByPropsContainer:v,windowResizeHandler:m,emptyText:f,currentItems:y,visibleItems:k,displayData:g,isItemExpanded:x,isItemExpandable:b,getTreeListItemIcon:e=>"sheetTitle"===e.slotType?"":b(e)?x(e)?"arrow-fill-down":"arrow-fill-right":o.isLineDashVisible?"outliner-point":"",isItemChecked:T,emitClick:I,toggleItem:_,onClickButton:C,onToggleClick:w,onKeydown:S}}});const s=(0,a(51900).Z)(o,(function(){var e=this,t=e._self._c,a=e._self._setupProxy;return t("ul",{staticClass:"uk-tree-list",class:e.typeCls,staticStyle:{position:"relative"},style:{height:e.highPerformanceMode?`${a.displayData.totalHeight}px`:"auto","flex-shrink":0},on:{keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"up",38,t.key,["Up","ArrowUp"])?null:a.onKeydown("up")},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"down",40,t.key,["Down","ArrowDown"])?null:a.onKeydown("down")}]}},e._l(a.displayData.items,(function(n){return t("li",{key:n.value,class:{"uk-checked":a.isItemChecked(n.current)},staticStyle:{"min-width":"100%","word-break":"break-all"},style:e.highPerformanceMode?{position:"absolute",top:n.currentTop,width:e.textWrap?"100%":`${a.displayData.commonWidth}px`,"--vk-tree-list-indent":n.indent}:{width:"100%","--vk-tree-list-indent":n.indent}},[e._t(n.current.slotType,(function(){return[t("button",{staticClass:"uk-tree-list-item",class:{"uk-checked":a.isItemChecked(n.current),"uk-focus":a.isItemChecked(n.current),"is-title":n.current.isTitle},attrs:{type:"button","data-value":n.value,"data-indent":n.indent},on:{click:function(e){return a.onClickButton(n.current)}}},[t("div",{staticClass:"uk-flex uk-flex-middle"},[e.highPerformanceMode?e._l(n.textLines,(function(a,n){return t("p",{key:n,staticClass:"uk-text-nowrap uk-margin-remove uk-tree-list-item-text"},[e._v("\n              "+e._s(a)+"\n            ")])})):[t("span",{staticClass:"uk-tree-list-item-text"},[e._v(e._s(n.current.text||a.emptyText))])],e._v(" "),n.current.items&&n.current.items.length?t("span",{staticClass:"uk-tree-list-item-badge"},[e._v(e._s(n.current.items.length))]):e._e()],2)])]}),{data:n.current,checked:a.isItemChecked(n.current),index:e.index,offset:20*n.indent+4,onClick:()=>a.onClickButton(n.current)}),e._v(" "),a.getTreeListItemIcon(n.current)?t("span",{staticClass:"uk-tree-list-toggle",class:{"is-expandable":a.isItemExpandable(n.current)},attrs:{"uk-icon":`icon: ${a.getTreeListItemIcon(n.current)}; ratio: 0.8`},on:{click:function(e){return a.onToggleClick(n.current,e)}}}):e._e(),e._v(" "),e.isLineDashVisible?e._l(Array.from({length:n.indent-1},((e,t)=>t+1)),(function(e){return t("span",{key:e,staticClass:"uk-tree-list-toggle-line-dash",style:{left:12+20*(e-1)+"px"}})})):e._e()],2)})),0)}),[],!1,null,null,null).exports},32470:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>V});var n=a(2954),l=a(87141),i=a(46016),o=a(64805),s=a(69931),r=a(89411),c=a(84374),u=a(40623),p=a(77995);const d=e=>{const{T:t}=(0,l.JE)(),{handleCommand:a}=(0,l.JX)(),{activeSheet:o,sheets:s,executeEditorAction:r,executeMutationAction:d,markerModule:x}=(0,c.nZ)(),b=(0,n.Fl)((()=>(0,i.$)().isOutlinerMode)),T=(0,n.iH)(""),I=(0,n.iH)(""),_=(0,n.iH)(e.menuOptions),C=(0,n.iH)("find"),w=(0,n.iH)([]),S=(0,n.Fl)((()=>w.value[0])),R=(0,n.Fl)((()=>{const e=T.value;if(e.length<=0)return null;const t=!_.value.isCurrentMapMode,a=t?s.value.map((e=>e.rootTopic)):[o.value.rootTopic],n=t?s.value.map((e=>e.relationships)).reduce(((e,t)=>e.concat(t))):o.value.relationships,{filters:l}=_.value,{wholeWords:i,matchCase:r}=l;return{keyword:e,rootTopics:a,relationships:n,rgx:f(e,i,r,!0)}})),O=(0,n.Fl)((()=>{if(!R.value)return[];const{filters:e}=_.value,{rootTopics:t,relationships:a,rgx:n}=R.value;let l=[];const i={};return t.forEach((t=>{var r,p,d,h,v,f;let k=[];const x=(e,t,a,n,l,i)=>{k.push({isSearchResult:!0,value:t,text:a,title:n,type:e,topicId:l,slotType:"searchItem",sheetId:i})};for(const a of g([t],b.value)){if(e.topic&&(null!==(r=a.title)&&void 0!==r?r:"").match(n)&&x("topic",a.id,a.title,a.title,a.id,a.ownerSheet.id),e.label){let e=[];const t=s.value.find((e=>a.ownerSheet.id===e.id));if(t){const n=null===(p=t.query({id:a.id}))||void 0===p?void 0:p.asTopic();n&&(e=c.HG.getLabels(n))}i[a.id]={labels:e,sheet:t}}if(e.note&&(null===(d=a.notes)||void 0===d?void 0:d.text)&&a.notes.text.match(n)){const e=`note-${a.id}-${a.notes.text}`;x("note",e,a.notes.text,a.title,a.id,a.ownerSheet.id)}if(e.link&&a.href&&y(a.href)&&a.href.match(n)){const e=`link-${a.id}-${a.href}`;x("link",e,a.href,a.title,a.id,a.ownerSheet.id)}if(e.boundary&&(null===(h=a.boundaries)||void 0===h?void 0:h.length)>0)for(const e of a.boundaries)(null===(v=e.title)||void 0===v?void 0:v.match(n))&&x("boundary",e.id,e.title,a.title,a.id,a.ownerSheet.id)}if(e.relationship&&a)for(const e of a)(null===(f=e.title)||void 0===f?void 0:f.match(n))&&t.ownerSheet.id===e.ownerSheet.id&&x("relationship",e.id,e.title,e.title,null,e.ownerSheet.id);e.label&&Object.keys(i).forEach((e=>{var a,l,s,r,c;let p=i[e].labels;const d=i[e].sheet;if(!d)return;if(t.ownerSheet.id!==d.id)return;const h=null===(a=d.query({id:e}))||void 0===a?void 0:a.asTopic();if(!h)return;const v=null===(s=null===(l=h.parentTopic)||void 0===l?void 0:l.parentTopic)||void 0===s?void 0:s.id,m=v?null===(r=o.value.query({id:v}))||void 0===r?void 0:r.asTopic():null;if(!h.extensionProviders.includes(u.vP.SPREADSHEET)&&m&&m.extensionProviders.includes(u.vP.SPREADSHEET)){const e=(null===(c=i[m.id])||void 0===c?void 0:c.labels)||[];p=p.filter((t=>!e.includes(t)))}p.sort().forEach((t=>{if(t&&t.match(n)){x("label",`label-${e}-${t}`,t,h.title,e,h.ownerSheet.id)}}))})),k=m(n,k),_.value.isCurrentMapMode?l=k:k.length&&l.push(((e,t)=>{const a=e.map((e=>({...e,unindent:!0})));return{isSearchResult:!0,value:t.id,text:t.title,type:"topic",topicId:t.rootTopic.id,slotType:"sheetTitle",sheetId:t.id,expanded:!0,items:a}})(k,t.ownerSheet))})),l})),E=(0,n.Fl)((()=>{const{isCurrentMapMode:e}=_.value;if(!s.value.length)return[];const a=(e?[o.value]:s.value).map((e=>{const{rootTopic:a,title:n}=e;return{value:a.id,text:`[${n}]${h(a,t)}`,expanded:!0,items:v(a,(e=>({value:e.id,text:h(e,t),expanded:!0,items:[],sheetId:e.ownerSheet.id,slotType:"topicItem",type:"topic"})),((e,t)=>({...e,items:[...e.items,t]})),b.value).items,sheetId:e.id,type:"topic",slotType:"sheetTitle"}}));return a.map(((e,t)=>a[t].items.map(((e,n)=>{a[t].items[n].isTitle=!0})))),a})),M=(0,n.Fl)((()=>{const{isCurrentMapMode:e}=_.value;if(!s.value.length)return[];return(e?[o.value]:s.value).map((e=>{const{rootTopic:t}=e;return v(t,(e=>{var t,a;return[{expanded:!0,value:e.id,text:null!==(a=null===(t=e.notes)||void 0===t?void 0:t.text)&&void 0!==a?a:"",title:e.title,slotType:"noteItem",sheetId:e.ownerSheet.id,type:"note"}]}),((e,t)=>e.concat(t)),b.value)})).reduce(((e,t)=>e.concat(t))).filter((e=>e.text.length>0))})),P=(0,n.Fl)((()=>{const e=((e,t)=>{const a=new Map;return e.filter((e=>!a.has(e[t])&&a.set(e[t],1)))})(v(o.value.rootTopic,(e=>e.markers.map((t=>{var a;const n=x.getMarkerInfoById(t);return{type:"marker",value:t,text:(null===(a=o.value.markerDescriptionFor(t))||void 0===a?void 0:a.name)||n.name,icon:n.imageSrc,unindent:!0,slotType:"item",sheetId:e.ownerSheet.id}}))),((e,t)=>e.concat(t)),b.value),"value"),a=[];e.length&&a.push({type:"marker",isTitle:!0,text:t("Marker"),value:"$tag-view-marker",expanded:!0,items:e,slotType:"item",sheetId:o.value.id});const n=c.HG.allLabelsFromSheet(o.value).sort().map((e=>({type:"label",value:e,text:e,unindent:!0,slotType:"item",sheetId:o.value.id})));n.length>0&&a.push({type:"label",isTitle:!0,text:t("Label"),value:"$tag-view-label",expanded:!0,items:n,slotType:"item",sheetId:o.value.id});const l=new Map;return v(o.value.rootTopic,(e=>{if(e.taskPresentation){const a={status:1===e.taskProgress?"done":"todo"},n="status:"+("done"===a.status?"checked":"unchecked");l.has(e.id)||l.set(n,{type:"task",value:JSON.stringify(a),text:"done"===a.status?t("Completed"):t("Uncompleted"),icon:"",unindent:!0,slotType:"item",sheetId:e.ownerSheet.id})}}),(()=>{}),b.value),l.size>0&&(a.push({type:"task",isTitle:!0,text:t("Task"),value:"$tag-view-task",expanded:!0,items:Array.from(l.values()),slotType:"item",sheetId:o.value.id}),l.clear()),a})),L=e=>{d({name:"mutate:replaceText",payload:e})},$=e=>{if(!R.value)return;const{rgx:t}=R.value,a=I.value,n=e.filter((e=>"topic"===e.type)).map((e=>({id:e.topicId,type:"topic",sheetId:e.sheetId}))),l=e.filter((e=>"note"===e.type)).map((e=>({id:e.topicId,type:"note",sheetId:e.sheetId}))),i=e.filter((e=>"label"===e.type)).map((e=>({id:`${e.topicId}-${e.value}`,type:"label",sheetId:e.sheetId,topicId:e.topicId,value:e.value}))),o=e.filter((e=>"link"===e.type)).map((e=>({id:e.topicId,type:"link",sheetId:e.sheetId}))),s=e.filter((e=>"boundary"===e.type)).map((e=>({id:e.value,type:"boundary",sheetId:e.sheetId}))),r=e.filter((e=>"relationship"===e.type)).map((e=>({id:e.value,type:"relationship",sheetId:e.sheetId})));L({topics:n,notes:l,labels:i,links:o,boundaries:s,relationships:r,rgx:t,text:a})};return(0,n.YP)((()=>O.value),(e=>{w.value=w.value.filter((t=>e.find((e=>{let a=!0;return"topicId"in t&&"topicId"in e&&(a=t.topicId===e.topicId),a&&t.type===e.type&&t.value===e.value}))))}),{immediate:!0}),{mode:C,searchContent:T,replaceContent:I,options:_,searchResult:O,workbookData:E,workbookNotesData:M,workbookTagsData:P,selectedItems:w,selectedItem:S,selectItem:e=>w.value=[e],openSearchResultItem:e=>{var t;const n=k(e),l=e.type,o=n?e.topicId:e.value;switch(l){case"topic":b.value?a("editor.selectTopicById",{topicId:o}):d({name:"mutate:selectTopics",payload:{topics:[o],centerOn:!0}});break;case"note":b.value?a("editor.selectTopicById",{topicId:o}):d({name:"mutate:selectTopics",payload:{topics:[o],centerOn:!0}}),setTimeout((()=>{(0,i.$)().setPopoverEditorVisible("notes")}),100);break;case"label":"item"===e.slotType?r({name:"mutateEditor:setHighlightLabels",payload:w.value.filter((e=>"label"===e.type)).map((e=>e.value))}):(b.value?a("editor.selectTopicById",{topicId:o}):d({name:"mutate:selectTopics",payload:{topics:[o],centerOn:!0}}),setTimeout((()=>{(0,i.$)().setPopoverEditorVisible("label")}),100));break;case"link":b.value?a("editor.selectTopicById",{topicId:o}):d({name:"mutate:selectTopics",payload:{topics:[o],centerOn:!0}}),setTimeout((()=>{(0,p.H)()}),100);break;case"boundary":r({name:"mutateEditor:unfoldTopicAncestors",payload:{topicId:o}}),d({name:"mutate:selectBoundaries",payload:{boundaries:[e.value],centerOn:!0}});break;case"relationship":r({name:"mutateEditor:unfoldTopicAncestors",payload:{topicId:o}}),d({name:"mutate:selectRelationships",payload:{relationships:[e.value],centerOn:!0}});break;case"marker":r({name:"mutateEditor:setHighlightMarkers",payload:w.value.filter((e=>"marker"===e.type)).map((e=>e.value))});break;case"task":r({name:"mutateEditor:setHighlightTasks",payload:w.value.filter((e=>"task"===e.type)).map((e=>JSON.parse(e.value)))})}if(!b.value){const{activeSheetViewer:e}=(0,c.nZ)();null===(t=e.value)||void 0===t||t.focus()}},replaceText:L,onReplace:()=>{if(!S.value||!R.value)return;const e=S.value,t=k(e),a=t?e.type:"topic",n=t?["boundary","relationship"].includes(a)?e.value:e.topicId:e.value,l=S.value.sheetId,{rgx:i}=R.value,o=I.value;L({rgx:i,text:o,topics:"topic"===a?[{id:n,type:"topic",sheetId:l}]:[],notes:"note"===a?[{id:n,type:"note",sheetId:l}]:[],labels:"label"===a?[{id:`${n}-${e.value}`,type:"label",sheetId:l,topicId:n,value:e.value}]:[],links:"link"===a?[{id:n,type:"link",sheetId:l}]:[],boundaries:"boundary"===a?[{id:n,type:"boundary",sheetId:l}]:[],relationships:"relationship"===a?[{id:n,type:"relationship",sheetId:l}]:[]})},onReplaceAll:async(e=O.value)=>{const{isCurrentMapMode:t}=_.value;t?$(e):e.reduce((async(e,t)=>(await e,new Promise((e=>{setTimeout((()=>{e($(t.items||[]))}))})))),Promise.resolve())}}};function h(e,t){return e.imageSource?`[${t("Image")}] ${e.title||""}`:e.title}function v(e,t,a,n){let l=t(e);for(const i of e.children)l=a(l,v(i,t,a,n));for(const i of e.detachedChildren)l=a(l,v(i,t,a,n));if(!n){for(const i of e.summaries.map((e=>e.topic)))l=a(l,v(i,t,a,n));e.callout&&(l=a(l,v(e.callout,t,a,n)))}return l}const m=(e,t)=>t.map((t=>{const a=t.text,n=[],l=a.split(e),i=a.match(e);let o=!1;const s=l.length+i.length;for(let e=0;e<s;e++)o?n.push({text:i.shift(),isHighlight:!0}):n.push({text:l.shift(),isHighlight:!1}),o=!o;return t.highlight=n.filter((e=>!!e.text)),t})),f=(e,t,a,n)=>{if(!e)return;e=(e=>e.replace(/[-\\{}*+?|^$.[\]()#]/g,"\\$&"))(e),t&&(/\B/.test(e.charAt(0))||(e="\\b"+e),/\B/.test(e.charAt(e.length-1))||(e+="\\b"));let l="";return a||(l+="i"),n&&(l+="g"),new RegExp(e,l)},y=e=>e.startsWith("http"),k=e=>!!e.isSearchResult;function*g(e,t){var a,n;for(const l of e){yield l;for(const e of g(l.children,t))yield e;for(const e of g(null!==(a=l.detachedChildren)&&void 0!==a?a:[],t))yield e;if(!t){for(const e of g((null!==(n=l.summaries)&&void 0!==n?n:[]).map((e=>e.topic)),t))yield e;l.callout&&(yield l.callout)}}}var x=a(89019);const b=e=>{const t=(0,l.JE)().T,{activeSheet:a,sheets:o,executeEditorAction:s,executeMutationAction:r,markerModule:d}=(0,c.nZ)(),b=(0,n.iH)(""),T=(0,n.iH)(""),I=(0,n.iH)(e.menuOptions),_=(0,n.iH)("find"),C=(0,n.iH)([]),w=(0,n.Fl)((()=>C.value[0])),S=(0,n.Fl)((()=>(0,x.c)().editingCollaborationTopics.map((e=>e.id)))),R=(0,n.Fl)((()=>{const e=b.value;if(e.length<=0)return null;const t=!I.value.isCurrentMapMode,n=t?o.value.map((e=>e.rootTopic)):[a.value.rootTopic],l=t?o.value.map((e=>e.relationships)).reduce(((e,t)=>e.concat(t))):a.value.relationships,{filters:i}=I.value,{wholeWords:s,matchCase:r}=i;return{keyword:e,rootTopics:n,relationships:l,rgx:f(e,s,r,!0)}})),O=(0,n.Fl)((()=>{if(!R.value)return[];const{filters:e}=I.value,{rootTopics:t,relationships:n,rgx:l}=R.value;let i=[];const s={};return t.forEach((t=>{var r,p,d,h,v,f;let k=[];const x=(e,t,a,n,l,i)=>{k.push({isSearchResult:!0,value:t,text:a,title:n,type:e,topicId:l,slotType:"searchItem",sheetId:i})};for(const a of g([t],!1))if(!S.value.includes(a.id)){if(e.topic&&(null!==(r=a.title)&&void 0!==r?r:"").match(l)&&x("topic",a.id,a.title,a.title,a.id,a.ownerSheet.id),e.label){let e=[];const t=o.value.find((e=>a.ownerSheet.id===e.id));if(t){const n=null===(p=t.query({id:a.id}))||void 0===p?void 0:p.asTopic();n&&(e=c.HG.getLabels(n))}s[a.id]={labels:e,sheet:t}}if(e.note&&(null===(d=a.notes)||void 0===d?void 0:d.text)&&a.notes.text.match(l)){const e=`note-${a.id}-${a.notes.text}`;x("note",e,a.notes.text,a.title,a.id,a.ownerSheet.id)}if(e.link&&a.href&&y(a.href)&&a.href.match(l)){const e=`link-${a.id}-${a.href}`;x("link",e,a.href,a.title,a.id,a.ownerSheet.id)}if(e.boundary&&(null===(h=a.boundaries)||void 0===h?void 0:h.length)>0)for(const e of a.boundaries)(null===(v=e.title)||void 0===v?void 0:v.match(l))&&x("boundary",e.id,e.title,a.title,a.id,a.ownerSheet.id)}if(e.relationship&&n)for(const e of n)(null===(f=e.title)||void 0===f?void 0:f.match(l))&&t.ownerSheet.id===e.ownerSheet.id&&x("relationship",e.id,e.title,e.title,null,e.ownerSheet.id);e.label&&Object.keys(s).forEach((e=>{var n,i,o,r,c;let p=s[e].labels;const d=s[e].sheet;if(!d)return;if(t.ownerSheet.id!==d.id)return;const h=null===(n=d.query({id:e}))||void 0===n?void 0:n.asTopic();if(!h)return;const v=null===(o=null===(i=h.parentTopic)||void 0===i?void 0:i.parentTopic)||void 0===o?void 0:o.id,m=v?null===(r=a.value.query({id:v}))||void 0===r?void 0:r.asTopic():null;if(!h.extensionProviders.includes(u.vP.SPREADSHEET)&&m&&m.extensionProviders.includes(u.vP.SPREADSHEET)){const e=(null===(c=s[m.id])||void 0===c?void 0:c.labels)||[];p=p.filter((t=>!e.includes(t)))}p.sort().forEach((t=>{if(t&&t.match(l)){x("label",`label-${e}-${t}`,t,h.title,e,h.ownerSheet.id)}}))})),k=m(l,k),I.value.isCurrentMapMode?i=k:k.length&&i.push(((e,t)=>{const a=e.map((e=>({...e,unindent:!0})));return{isSearchResult:!0,value:t.id,text:t.title,type:"topic",topicId:t.rootTopic.id,slotType:"sheetTitle",sheetId:t.id,expanded:!0,items:a}})(k,t.ownerSheet))})),i})),E=(0,n.Fl)((()=>{const{isCurrentMapMode:e}=I.value;if(!o.value.length)return[];const n=(e?[a.value]:o.value).map((e=>{const{rootTopic:a,title:n}=e;return{value:a.id,text:`[${n}]${h(a,t)}`,expanded:!0,items:v(a,(e=>({value:e.id,text:h(e,t),expanded:!0,items:[],sheetId:e.ownerSheet.id,slotType:"topicItem",type:"topic"})),((e,t)=>({...e,items:[...e.items,t]})),!1).items,sheetId:e.id,type:"topic",slotType:"sheetTitle"}}));return n.map(((e,t)=>n[t].items.map(((e,a)=>{n[t].items[a].isTitle=!0})))),n})),M=(0,n.Fl)((()=>{const{isCurrentMapMode:e}=I.value;if(!o.value.length)return[];return(e?[a.value]:o.value).map((e=>{const{rootTopic:t}=e;return v(t,(e=>{var t,a;return[{expanded:!0,value:e.id,text:null!==(a=null===(t=e.notes)||void 0===t?void 0:t.text)&&void 0!==a?a:"",title:e.title,slotType:"noteItem",sheetId:e.ownerSheet.id,type:"note"}]}),((e,t)=>e.concat(t)),!1)})).reduce(((e,t)=>e.concat(t))).filter((e=>e.text.length>0))})),P=(0,n.Fl)((()=>{const e=((e,t)=>{const a=new Map;return e.filter((e=>!a.has(e[t])&&a.set(e[t],1)))})(v(a.value.rootTopic,(e=>e.markers.map((t=>{var n;const l=d.getMarkerInfoById(t);return{type:"marker",value:t,text:(null===(n=a.value.markerDescriptionFor(t))||void 0===n?void 0:n.name)||l.name,icon:l.imageSrc,unindent:!0,slotType:"item",sheetId:e.ownerSheet.id}}))),((e,t)=>e.concat(t)),!1),"value"),n=[];e.length&&n.push({type:"marker",isTitle:!0,text:t("Marker"),value:"$tag-view-marker",expanded:!0,items:e,slotType:"item",sheetId:a.value.id});const l=c.HG.allLabelsFromSheet(a.value).sort().map((e=>({type:"label",value:e,text:e,unindent:!0,slotType:"item",sheetId:a.value.id})));l.length>0&&n.push({type:"label",isTitle:!0,text:t("Label"),value:"$tag-view-label",expanded:!0,items:l,slotType:"item",sheetId:a.value.id});const i=new Map;return v(a.value.rootTopic,(e=>{if(e.taskPresentation){const a={status:1===e.taskProgress?"done":"todo"},n="status:"+("done"===a.status?"checked":"unchecked");i.has(e.id)||i.set(n,{type:"task",value:JSON.stringify(a),text:"done"===a.status?t("Completed"):t("Uncompleted"),icon:"",unindent:!0,slotType:"item",sheetId:e.ownerSheet.id})}}),(()=>{}),!1),i.size>0&&(n.push({type:"task",isTitle:!0,text:t("Task"),value:"$tag-view-task",expanded:!0,items:Array.from(i.values()),slotType:"item",sheetId:a.value.id}),i.clear()),n})),L=e=>{r({name:"mutate:replaceText",payload:e})},$=e=>{if(!R.value)return;const{rgx:t}=R.value,a=T.value,n=e.filter((e=>"topic"===e.type)).map((e=>({id:e.topicId,type:"topic",sheetId:e.sheetId}))),l=e.filter((e=>"note"===e.type)).map((e=>({id:e.topicId,type:"note",sheetId:e.sheetId}))),i=e.filter((e=>"label"===e.type)).map((e=>({id:`${e.topicId}-${e.value}`,type:"label",sheetId:e.sheetId,topicId:e.topicId,value:e.value}))),o=e.filter((e=>"link"===e.type)).map((e=>({id:e.topicId,type:"link",sheetId:e.sheetId}))),s=e.filter((e=>"boundary"===e.type)).map((e=>({id:e.value,type:"boundary",sheetId:e.sheetId}))),r=e.filter((e=>"relationship"===e.type)).map((e=>({id:e.value,type:"relationship",sheetId:e.sheetId})));L({topics:n,notes:l,labels:i,links:o,boundaries:s,relationships:r,rgx:t,text:a})};return(0,n.YP)((()=>O.value),(e=>{C.value=C.value.filter((t=>e.find((e=>{let a=!0;return"topicId"in t&&"topicId"in e&&(a=t.topicId===e.topicId),a&&t.type===e.type&&t.value===e.value}))))}),{immediate:!0}),{mode:_,searchContent:b,replaceContent:T,options:I,searchResult:O,workbookData:E,workbookNotesData:M,workbookTagsData:P,selectedItems:C,selectedItem:w,selectItem:e=>C.value=[e],openSearchResultItem:e=>{const t=k(e),a=e.type,n=t?e.topicId:e.value;switch(a){case"topic":r({name:"mutate:selectTopics",payload:{topics:[n],centerOn:!0}});break;case"note":r({name:"mutate:selectTopics",payload:{topics:[n],centerOn:!0}}),setTimeout((()=>{(0,i.$)().setPopoverEditorVisible("notes")}),100);break;case"label":"item"===e.slotType?s({name:"mutateEditor:setHighlightLabels",payload:C.value.filter((e=>"label"===e.type)).map((e=>e.value))}):(r({name:"mutate:selectTopics",payload:{topics:[n],centerOn:!0}}),setTimeout((()=>{(0,i.$)().setPopoverEditorVisible("label")}),100));break;case"link":r({name:"mutate:selectTopics",payload:{topics:[n],centerOn:!0}}),setTimeout((()=>{(0,p.H)()}),100);break;case"boundary":s({name:"mutateEditor:unfoldTopicAncestors",payload:{topicId:n}}),r({name:"mutate:selectBoundaries",payload:{boundaries:[e.value],centerOn:!0}});break;case"relationship":s({name:"mutateEditor:unfoldTopicAncestors",payload:{topicId:n}}),r({name:"mutate:selectRelationships",payload:{relationships:[e.value],centerOn:!0}});break;case"marker":s({name:"mutateEditor:setHighlightMarkers",payload:C.value.filter((e=>"marker"===e.type)).map((e=>e.value))});break;case"task":s({name:"mutateEditor:setHighlightTasks",payload:C.value.filter((e=>"task"===e.type)).map((e=>JSON.parse(e.value)))})}},replaceText:L,onReplace:()=>{if(!w.value||!R.value)return;const e=w.value,t=k(e),a=t?e.type:"topic",n=t?["boundary","relationship"].includes(a)?e.value:e.topicId:e.value,l=w.value.sheetId,{rgx:i}=R.value,o=T.value;L({rgx:i,text:o,topics:"topic"===a?[{id:n,type:"topic",sheetId:l}]:[],notes:"note"===a?[{id:n,type:"note",sheetId:l}]:[],labels:"label"===a?[{id:`${n}-${e.value}`,type:"label",sheetId:l,topicId:n,value:e.value}]:[],links:"link"===a?[{id:n,type:"link",sheetId:l}]:[],boundaries:"boundary"===a?[{id:n,type:"boundary",sheetId:l}]:[],relationships:"relationship"===a?[{id:n,type:"relationship",sheetId:l}]:[]})},onReplaceAll:async(e=O.value)=>{const{isCurrentMapMode:t}=I.value;t?$(e):e.reduce((async(e,t)=>(await e,new Promise((e=>{setTimeout((()=>{e($(t.items||[]))}))})))),Promise.resolve())}}},T={menuOptions:{isReplaceMode:!1,isCurrentMapMode:!0,filters:{topic:!0,label:!0,note:!0,link:!0,boundary:!0,relationship:!0}}},I=(e=T)=>(0,r.FU)().source.startsWith("cloud://")?b(e):d(e);var _=a(3004),C=a(86673),w=a(67657),S=a(60746);const R=(0,n.aZ)({__name:"toolbar",props:{searchContent:{default:""},replaceContent:{default:""},showFiltersOptions:{type:Boolean,default:!0},showReplaceOptions:{type:Boolean,default:!0},menuOptions:null,searchText:null,replaceText:null,disabledSearch:{type:Boolean,default:!1},disabledReplace:{type:Boolean,default:!0},disabledReplaceAll:{type:Boolean,default:!0},disabledItems:{default:()=>[]}},emits:["update:searchContent","update:replaceContent","update:menuOptions","replace","replaceAll"],setup(e,{emit:t}){const a=e,{T:i}=(0,l.JE)(),{Menu:o}=w,s=(0,n.iH)(null),r=e=>!a.disabledItems.includes(e),c=(e,n)=>{let l={...a.menuOptions};["isReplaceMode","isCurrentMapMode"].includes(e)?l[e]=n:(l=Object.assign({},a.menuOptions),l.filters=Object.assign({},a.menuOptions.filters),l.filters[e]=n),t("update:menuOptions",l)},u=(e,t)=>{const{filters:n}=a.menuOptions;return{label:t,id:e,click:t=>{c(e,!n[e]),t.checked=!n[e]},type:"checkbox",enabled:r(e),checked:n[e]}};return(0,n.bv)((()=>{var e,t;null===(t=null===(e=s.value)||void 0===e?void 0:e.$el)||void 0===t||t.querySelector("input").focus()})),{__sfc:!0,$T:i,Menu:o,props:a,emit:t,searchInput:s,onUpdateSearchContent:e=>t("update:searchContent",e),onUpdateReplaceContent:e=>t("update:replaceContent",e),onReplace:()=>t("replace",a.replaceContent),onReplaceAll:()=>{t("replaceAll",a.replaceContent)},getMenuOptionEnabled:r,updateMenuOptions:c,getCheckboxMenuOption:u,onToggleConfig:()=>{const{isReplaceMode:e,isCurrentMapMode:t}=a.menuOptions;let n=[{type:"separator"},{label:i("Current Map"),id:"currentMap",click:e=>{c("isCurrentMapMode",!0),e.checked=!0},type:"radio",enabled:r("currentMap"),checked:t},{label:i("Current File"),id:"wholeWorkbook",click:e=>{c("isCurrentMapMode",!1),e.checked=!0},type:"radio",enabled:r("wholeWorkbook"),checked:!t},{type:"separator"},u("wholeWords",i("Whole Words")),u("matchCase",i("Match Case"))];a.showReplaceOptions&&(n=[{label:i("Find"),id:"find",click:e=>{c("isReplaceMode",!1),e.checked=!0},type:"radio",enabled:r("find"),checked:!e},{label:i("Find & Replace").replace(/(&)/g,"$1$1"),id:"replace",click:e=>{c("isReplaceMode",!0),e.checked=!0},type:"radio",enabled:r("replace"),checked:e}].concat(n)),a.showFiltersOptions&&(n=n.concat([{type:"separator"},u("topic",i("Topic")),u("note",i("Note")),u("relationship",i("Relationship")),u("boundary",i("Boundary")),u("label",i("Label")),u("link",i("Link(noun)"))])),o.buildFromTemplate(n).popup({window:w.getCurrentWindow()})},showInputMenu:S.Sr}}});var O=a(51900);const E=(0,O.Z)(R,(function(){var e=this,t=e._self._c,a=e._self._setupProxy;return t("div",{staticClass:"uk-flex uk-flex-middle uk-flex-between",staticStyle:{margin:"0 20px"}},[t("div",{staticStyle:{width:"306px"}},[t("vk-input",{directives:[{name:"focus-contexts",rawName:"v-focus-contexts",value:["focus.input"],expression:"['focus.input']"}],ref:"searchInput",attrs:{prefix:"search",placeholder:e.searchText||a.$T("Find"),disabled:e.disabledSearch,value:e.searchContent},on:{input:a.onUpdateSearchContent,contextmenu:a.showInputMenu}}),e._v(" "),t("vk-input",{directives:[{name:"show",rawName:"v-show",value:e.menuOptions.isReplaceMode,expression:"menuOptions.isReplaceMode"},{name:"focus-contexts",rawName:"v-focus-contexts",value:["focus.input"],expression:"['focus.input']"}],staticClass:"uk-margin-small-top",attrs:{prefix:"eyedrop",placeholder:e.replaceText||a.$T("Replace"),value:e.replaceContent},on:{input:a.onUpdateReplaceContent}}),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.menuOptions.isReplaceMode,expression:"menuOptions.isReplaceMode"}],staticClass:"uk-margin-small-top uk-flex uk-flex-row uk-flex-right"},[t("button",{directives:[{name:"focus-contexts",rawName:"v-focus-contexts:no",arg:"no"}],staticClass:"vk-button-default vk-size-small uk-margin-small-right",attrs:{disabled:e.disabledReplace},on:{click:a.onReplace}},[e._v("\n        "+e._s(a.$T("Replace"))+"\n      ")]),e._v(" "),t("button",{directives:[{name:"focus-contexts",rawName:"v-focus-contexts:no",arg:"no"}],staticClass:"vk-button-default vk-size-small",attrs:{disabled:e.disabledReplaceAll},on:{click:a.onReplaceAll}},[e._v("\n        "+e._s(a.$T("Replace All"))+"\n      ")])])],1),e._v(" "),t("button",{staticClass:"vk-button-link-secondary",on:{click:a.onToggleConfig}},[t("span",{attrs:{"uk-icon":"setting"}})])])}),[],!1,null,null,null).exports;var M=a(53775);const P=(0,n.aZ)({__name:"topic-panel",props:{panelWidth:null,sheetRendering:{type:Boolean}},setup(e){const{searchContent:t,replaceContent:a,options:l,searchResult:o,workbookData:s,selectedItem:r,selectItem:c,openSearchResultItem:u,onReplace:p,onReplaceAll:d}=I(),h=(0,n.iH)(),v=(0,n.Fl)((()=>t.value.length>0)),m=(0,n.Fl)((()=>(0,i.$)().isOutlinerMode)),f=(0,n.Fl)((()=>!t.value||(!r.value||!("isSearchResult"in r.value)))),y=(0,n.Fl)((()=>{const{isCurrentMapMode:e}=l.value;if(!t.value)return!0;if(e){if(!o.value||!o.value.length)return!0}else if(o.value.every((e=>{var t;return 0===(null===(t=e.items)||void 0===t?void 0:t.length)})))return!0;return!1})),k=(0,n.Fl)((()=>v.value&&o.value&&o.value[0]&&"sheetTitle"!==o.value[0].slotType?"margin: 24px 0 20px":"margin: 24px 0 0")),g=(0,M.Ds)((e=>{t.value=e}),300);return(0,n.YP)((()=>m.value),(e=>{l.value.filters.relationship=!e,l.value.filters.boundary=!e}),{immediate:!1}),{__sfc:!0,searchContent:t,replaceContent:a,options:l,searchResult:o,workbookData:s,selectedItem:r,selectItem:c,openSearchResultItem:u,onReplace:p,onReplaceAll:d,containerEl:h,isSearchMode:v,isOutlinerMode:m,computedDisabledReplace:f,computedDisabledReplaceALL:y,dividerStyle:k,handleSelect:e=>{c(e),u(e)},handleSearchContentUpdate:g,CommonNonePanel:_.Z,TreeListV2:C.Z,Toolbar:E}}});a(80108);const L=(0,O.Z)(P,(function(){var e=this,t=e._self._c,a=e._self._setupProxy;return t("div",{staticClass:"uk-flex uk-flex-column uk-height-expand uk-panel uk-flex-column",staticStyle:{"padding-right":"1px"}},[t(a.Toolbar,{attrs:{"search-content":a.searchContent,"replace-content":a.replaceContent,"menu-options":a.options,"disabled-search":e.sheetRendering,"disabled-replace":a.computedDisabledReplace,"disabled-replace-all":a.computedDisabledReplaceALL,"disabled-items":a.isOutlinerMode?["relationship","boundary"]:[]},on:{"update:searchContent":a.handleSearchContentUpdate,"update:replaceContent":e=>a.replaceContent=e,"update:menuOptions":e=>a.options=e,replace:function(e){return a.onReplace()},replaceAll:function(e){return a.onReplaceAll()}}}),e._v(" "),t("hr",{staticClass:"vk-divider-on-surface",style:a.dividerStyle}),e._v(" "),a.isSearchMode&&0===a.searchResult.length?t(a.CommonNonePanel,{attrs:{type:"NO_RESULT","section-style":"margin-top: -30px;"}}):t("div",{ref:"containerEl",staticClass:"uk-height-expand uk-panel uk-overflow-auto uk-flex uk-flex-column",class:{"uk-disabled":!1},staticStyle:{width:"100%",padding:"0 20px"},style:{zIndex:0,opacity:1}},[t("keep-alive",[t(a.TreeListV2,{attrs:{items:a.isSearchMode?a.searchResult:a.workbookData,"high-performance-mode":!0,container:a.containerEl,"model-value":a.selectedItem?[a.selectedItem.value]:[],width:e.panelWidth,"is-line-dash-visible":!a.isSearchMode,"allow-direction-key":"",type:"radio"},on:{click:a.handleSelect},scopedSlots:e._u([{key:"sheetTitle",fn:function({data:a}){return[t("div",{staticClass:"search-panel-sheet-title"},[e._v("\n            "+e._s(a.text)+"\n          ")])]}},{key:"searchItem",fn:function({data:a,onClick:n,checked:l}){return[t("button",{staticClass:"uk-tree-list-item uk-width-1-1 uk-position-relative",class:{"uk-checked":l,"uk-focus":l},style:{"padding-left":16+("topic"!==a.type?18:0)+"px"},on:{click:n}},["topic"!==a.type?t("img",{staticClass:"uk-icon uk-position-absolute",class:{"uk-checked":l},staticStyle:{top:"7px",left:"16px",opacity:"0.7"},attrs:{"uk-svg":"","data-src":e.$toResourceURL(`static/images/search-panel-icon/${a.type}.svg`),draggable:"false"}}):e._e(),e._v(" "),a.highlight?t("p",{staticClass:"uk-margin-remove",staticStyle:{"line-height":"1.4em"}},e._l(a.highlight,(function({text:a,isHighlight:n},l){return t("span",{key:l,class:{"uk-tree-list-highlight":n}},[e._v(e._s(a))])})),0):t("p",{staticClass:"uk-margin-remove"},[e._v(e._s(a.text))])])]}}])})],1)],1)],1)}),[],!1,null,"0fb2d3e2",null).exports;const $=(0,n.aZ)({__name:"note-panel",props:{highlightParam:{default:null},sheetRendering:{type:Boolean}},setup(e){const t=e,{T:a}=(0,l.JE)(),{searchContent:i,searchResult:o,replaceContent:s,workbookNotesData:r,options:c,selectedItem:u,selectItem:p,onReplace:d,onReplaceAll:h,openSearchResultItem:v}=I({menuOptions:{filters:{note:!0}}});(0,n.YP)((()=>t.highlightParam),(e=>{(0,n.Y3)((()=>{p({value:e.topicId,text:void 0,sheetId:void 0,type:void 0})}))}),{immediate:!0});const m=(0,n.Fl)((()=>a("<Empty Text>"))),f=(0,n.Fl)((()=>{const{isCurrentMapMode:e}=c.value,t=[];return e?t.push(...o.value):o.value.forEach((e=>{t.push(...e.items)})),t.filter((e=>"note"===e.type)).map((e=>({...e,type:"note",slotType:"noteItem"})))})),y=(0,n.Fl)((()=>i.value.length>0)),k=(0,n.Fl)((()=>!i.value||(!u.value||!("isSearchResult"in u.value)))),g=(0,n.Fl)((()=>{const{isCurrentMapMode:e}=c.value;if(!i.value)return!0;if(e){if(!o.value||!o.value.length)return!0}else if(o.value.every((e=>{var t;return 0===(null===(t=e.items)||void 0===t?void 0:t.length)})))return!0;return!1}));return{__sfc:!0,$T:a,props:t,searchContent:i,searchResult:o,replaceContent:s,workbookNotesData:r,options:c,selectedItem:u,selectItem:p,onReplace:d,onReplaceAll:h,openSearchResultItem:v,emptyText:m,noteSearchResult:f,isSearchMode:y,handleSelect:e=>{p(e),v(e)},computedDisabledReplace:k,computedDisabledReplaceALL:g,CommonNonePanel:_.Z,TreeListV2:C.Z,Toolbar:E}}});a(98085);const N=(0,O.Z)($,(function(){var e=this,t=e._self._c,a=e._self._setupProxy;return t("div",{staticClass:"uk-height-expand uk-panel uk-flex uk-flex-column"},[t(a.Toolbar,{attrs:{"search-content":a.searchContent,"replace-content":a.replaceContent,"menu-options":a.options,"disabled-search":e.sheetRendering,"disabled-replace":a.computedDisabledReplace,"disabled-replace-all":a.computedDisabledReplaceALL,"search-text":a.$T("Search notes"),"show-filters-options":!1},on:{"update:searchContent":e=>a.searchContent=e,"update:replaceContent":e=>a.replaceContent=e,"update:menuOptions":e=>a.options=e,replace:function(e){return a.onReplace()},replaceAll:function(e){return a.onReplaceAll()}}}),e._v(" "),t("hr",{staticClass:"vk-divider-on-surface",staticStyle:{margin:"var(--spacing-margin-l) 0 var(--spacing-margin-m)"}}),e._v(" "),(a.isSearchMode?0===a.noteSearchResult.length:0===a.workbookNotesData.length)?t(a.CommonNonePanel,{attrs:{type:a.isSearchMode?"NO_RESULT":"NO_NOTE","section-style":"margin-top: -30px;"}}):t("div",{staticClass:"uk-height-expand uk-panel uk-overflow-auto uk-flex uk-flex-column",class:{"uk-disabled":e.sheetRendering},staticStyle:{width:"100%"},style:{zIndex:0,opacity:e.sheetRendering?.3:1}},[t(a.TreeListV2,{attrs:{items:a.isSearchMode?a.noteSearchResult:a.workbookNotesData,"is-line-dash-visible":!1,"model-value":a.selectedItem?[a.selectedItem.value]:[]},on:{"!click":function(e){return a.handleSelect.apply(null,arguments)}},scopedSlots:e._u([{key:"sheetTitle",fn:function({data:a,offset:n}){return[t("hr",{staticClass:"uk-separator"}),e._v(" "),t("button",{staticClass:"uk-tree-list-item uk-tree-list-solid-background",style:{"padding-left":n+"px"}},[e._v("\n          "+e._s(a.text)+"\n        ")]),e._v(" "),t("hr",{staticClass:"uk-separator"})]}},{key:"noteItem",fn:function({data:n,checked:l,onClick:i}){return[t("button",{staticClass:"uk-tree-list-item",class:{"uk-checked":l,"uk-focus":l},staticStyle:{padding:"16px","overflow-wrap":"break-word"},attrs:{name:n.value},on:{click:i}},[t("div",{staticClass:"typography-subhead-small"},[e._v("\n            "+e._s(n.title||a.emptyText)+"\n          ")]),e._v(" "),t("div",{staticClass:"note-panel-note-text typography-body-large uk-text-line-clamp"},[a.isSearchMode&&n.highlight?t("p",{staticClass:"uk-margin-remove"},e._l(n.highlight,(function({text:a,isHighlight:n},l){return t("span",{key:l,class:{"uk-tree-list-highlight":n}},[e._v(e._s(a))])})),0):t("p",{staticClass:"uk-margin-remove"},[e._v("\n              "+e._s(n.text||a.emptyText)+"\n            ")])])]),e._v(" "),t("hr",{staticClass:"uk-separator",staticStyle:{padding:"0 16px"}})]}}])})],1)],1)}),[],!1,null,"f08e9528",null).exports;var A=a(45578),F=a.n(A),H=a(90435),D=a(54856),B=a(20993);const W=(0,n.aZ)({__name:"tag-panel",props:{highlightParam:{default:null},sheetRendering:{type:Boolean}},setup(e){const t=e,{workbookTagsData:a,selectedItem:l,selectedItems:i,openSearchResultItem:o,selectItem:s}=I();(0,n.YP)((()=>t.highlightParam),(e=>{(0,n.Y3)((()=>{const t={value:void 0,text:void 0,sheetId:void 0,type:void 0};e.selectedLabel?(t.value=e.selectedLabel,t.type="label"):e.markerId?(t.value=e.markerId,t.type="marker"):e.taskInfo&&(t.value=JSON.stringify(e.taskInfo),t.type="task"),s(t)}))}),{immediate:!0});const r=e=>i.value.find((t=>t.value===e.value)),c=e=>{const t=a.value.find((t=>t.type===e));return!!t&&i.value.filter((t=>t.type===e)).length===t.items.length};return{__sfc:!0,props:t,workbookTagsData:a,selectedItem:l,selectedItems:i,openSearchResultItem:o,selectItem:s,handleSelect:async e=>{if(await H.ZP.fetch(D.Gy,{name:"action.topicFilter",channel:(0,D.gk)(window.editorId)})){if("task"===e.type)try{const t=JSON.parse(e.value);(0,B.kI)("done"===t.status?"highlightCheckedTask":"highlightUncheckedTask")}catch(e){}e.isTitle?c(e.type)?i.value=i.value.filter((t=>t.type!==e.type)):i.value=F()([...i.value,...e.items],"value"):r(e)?i.value=i.value.filter((t=>t.value!==e.value)):i.value=F()([...i.value,e],"value"),o(e)}},isItemChecked:r,isTitleChecked:c,CommonNonePanel:_.Z,TreeListV2:C.Z}}});a(71887);const U=(0,O.Z)(W,(function(){var e=this,t=e._self._c,a=e._self._setupProxy;return t("div",{staticClass:"uk-height-expand uk-panel uk-flex uk-flex-column"},[t("hr",{staticClass:"vk-divider-on-surface",staticStyle:{margin:"12px 0 var(--spacing-margin-m)"}}),e._v(" "),0===a.workbookTagsData.length?t(a.CommonNonePanel,{attrs:{type:"NO_TAG","section-style":"margin-top: -30px;"}}):t("div",{staticClass:"uk-height-expand uk-panel uk-overflow-auto uk-flex uk-flex-column",class:{"uk-disabled":e.sheetRendering},staticStyle:{width:"100%",padding:"0 20px"},style:{zIndex:0,opacity:e.sheetRendering?.3:1}},[t(a.TreeListV2,{attrs:{items:a.workbookTagsData,"model-value":a.selectedItem?[a.selectedItem.value]:[],"is-line-dash-visible":!1},scopedSlots:e._u([{key:"item",fn:function({data:n}){return[t("button",{staticClass:"uk-tree-list-item lm-view-item",class:{"is-title":n.isTitle},attrs:{"lm-checked":!0,name:n.value,"data-indent":n.indent},on:{click:()=>a.handleSelect(n)}},["marker"!==n.type||n.isTitle?e._e():t("img",{staticStyle:{width:"16px",height:"16px","vertical-align":"middle"},attrs:{draggable:"false","uk-img":"",src:n.icon}}),e._v(" "),t("span",{staticClass:"uk-tree-list-item-text"},[e._v(e._s(n.text))]),e._v(" "),t("div",{staticClass:"lm-select-icon uk-float-right",style:(n.isTitle?a.isTitleChecked(n.type):a.isItemChecked(n))?"visibility: visible !important;":""},[t("div",{directives:[{name:"focus-contexts",rawName:"v-focus-contexts:no",arg:"no"}],staticClass:"uk-filter uk-display-inline-block",class:{"uk-checked":n.isTitle?a.isTitleChecked(n.type):a.isItemChecked(n)},attrs:{src:(n.isTitle?a.isTitleChecked(n.type):a.isItemChecked(n))?e.$toResourceURL("/static/images/navigation-panel/sun-fill.svg"):e.$toResourceURL("/static/images/navigation-panel/sun.svg"),"uk-svg":""}})])])]}}])})],1)],1)}),[],!1,null,"72789004",null).exports,Z=(0,n.aZ)({__name:"index",props:{panelWidth:{default:378}},setup(e){const t=(e,...t)=>(0,l.JE)().T(e,...t),{updateSearchPanel:a,updateSearchPanelHighlightItem:r}=(0,i.$)(),u=(0,n.Fl)((()=>(0,l.S)().appearance)),p=(0,n.Fl)((()=>"dark"===u.value?(0,s.ju)("static/assets/images/close-btn-dark.svg"):(0,s.ju)("static/assets/images/close-btn-light.svg"))),d=(0,n.Fl)((()=>(0,i.$)().searchPanelTab)),h=(0,n.Fl)((()=>(0,i.$)().searchPanelHighlightParam)),v=(0,n.Fl)((()=>(0,i.$)().isOutlinerMode)),m=(0,n.Fl)((()=>o.JK.map((e=>({...e,label:t("$$",e.label),tooltip:t("$$",e.tooltip)}))))),f=(0,n.Fl)((()=>{switch(d.value){case o.It.TOPIC:return L;case o.It.NOTE:return N;case o.It.TAG:return U}})),y=e=>{a({tab:e})},k=()=>{r({});const{executeEditorAction:e}=(0,c.nZ)();e({name:"mutateEditor:setHighlightLabels",payload:[]}),e({name:"mutateEditor:setHighlightMarkers",payload:[]}),e({name:"mutateEditor:setHighlightTasks",payload:[]})};(0,n.YP)((()=>(0,i.$)().searchPanelTab),((e,t)=>{t===o.It.TAG&&e!==o.It.TAG&&k()}));return(0,n.YP)((()=>(0,i.$)().isOutlinerMode),(e=>{e&&y(o.It.TOPIC)})),{__sfc:!0,$T:t,updateSearchPanel:a,updateSearchPanelHighlightItem:r,appearance:u,closeIcon:p,searchPanelTab:d,searchPanelHighlightParam:h,isOutlinerMode:v,searchPanelTabs:m,searchPanelTabComponent:f,switchSearchPanelTab:y,handleLeaveTagPanel:k,handleSearchPanelClose:()=>{a({visible:!1}),k()}}}});const V=(0,O.Z)(Z,(function(){var e=this,t=e._self._c,a=e._self._setupProxy;return t("div",{directives:[{name:"focus-contexts",rawName:"v-focus-contexts:group",value:["focus.searchPanel"],expression:"['focus.searchPanel']",arg:"group"}],staticClass:"uk-flex uk-flex-column uk-height-1-1 uk-panel uk-position-left uk-format-panel vk-scrollbar",style:`width: ${e.panelWidth}px`},[t("div",{staticClass:"uk-flex uk-flex-between uk-flex-middle",staticStyle:{margin:"0 20px 12px"}},[t("div",{staticStyle:{height:"40px"}},[a.isOutlinerMode?e._e():t("ul",{staticClass:"uk-tab vk-tab-indicator",attrs:{"uk-tab":""}},e._l(a.searchPanelTabs,(function(n){return t("li",{key:n.key,class:{"uk-active":n.key===a.searchPanelTab},on:{click:function(e){return a.switchSearchPanelTab(n.key)}}},[t("a",{attrs:{href:"#",title:n.tooltip,draggable:"false"}},[e._v("\n            "+e._s(n.label)+"\n          ")])])})),0)]),e._v(" "),t("img",{staticStyle:{position:"absolute",right:"16px",top:"16px"},attrs:{draggable:"false",src:a.closeIcon},on:{click:a.handleSearchPanelClose}})]),e._v(" "),t("keep-alive",[t(a.searchPanelTabComponent,{tag:"component",attrs:{"panel-width":e.panelWidth,"highlight-param":a.searchPanelHighlightParam}})],1)],1)}),[],!1,null,"6d5b14ba",null).exports},98085:(e,t,a)=>{var n=a(4143);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,a(45346).Z)("8e95c344",n,!0,{})},71887:(e,t,a)=>{var n=a(47063);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,a(45346).Z)("d7dc4abc",n,!0,{})},80108:(e,t,a)=>{var n=a(35278);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,a(45346).Z)("588e7da6",n,!0,{})}}]);