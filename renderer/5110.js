"use strict";(global.webpackChunkxmind_vana=global.webpackChunkxmind_vana||[]).push([[5110],{59042:(e,t,n)=>{n.d(t,{Z:()=>ve});var a=n(47311),i=n(23352),o=n(90435);const r=window.location.pathname.match(/\/([a-zA-Z0-9-]+)\.html$/)[1]||"default",s=(0,i.ZP)(`error:${r}`),l=new a.q(s,{ipc:o.ZP});window.addEventListener("error",(function(e){const t=e.error;t&&l.handle(t)})),window.addEventListener("unhandledrejection",(function(e){const t=e.reason;t&&l.handle(t)}));const c=l;var d=n(2954),u=n(63477),p=n.n(u),m=n(72298),f=n(67657),h=n(13780),v=n.n(h),w=n(30266),y=n(86396),g=n(31945),b=n(54856),I=n(73884),S=n(28914),T=n(56222),E=n(79409),F=n(65114),P=n(77412);const A={install(e){const t="vana-ref";e.directive(t,{bind:function(e,t,n){t.value(n.componentInstance||e,n.key)},update:function(e,n,a,i){if(i.data&&i.data.directives){var o=i.data.directives.find((function(e){return e.name===t}));if(o&&o.value!==n.value)return o&&o.value(null,i.key),void n.value(a.componentInstance||e,a.key)}a.componentInstance===i.componentInstance&&a.elm===i.elm||n.value(a.componentInstance||e,a.key)},unbind:function(e,t,n){t.value(null,n.key)}})}};var C=n(87141);const Z={install(e){e.prototype.$T=function(e,...t){return(0,C.JE)().T(e,...t)}}};var k=n(96829);const M=(0,i.ZP)("safe-runner");const x=class{constructor(e){this.errorHandler=e}_handleError(e){"function"==typeof this.errorHandler?this.errorHandler(e):M.error((0,k.SC)(e))}install(e){const t=this;e.prototype.$safeRun=function(e){try{let n=e();return n&&n.then&&n.catch?n.then((e=>e)).catch((e=>t._handleError(e))):n}catch(e){t._handleError(e)}}}};var L=n(69931);const R={install(e){e.prototype.$toResourceURL=(...e)=>(0,L.ju)(...e).replace("(","%28").replace(")","%29"),e.prototype.$loadResource=L.zD}};var O=n(53775),N=n(59474);var D=n(30247),_=n(2563),H=n(65428);const B=(0,i.ZP)("font");var $=n(22037),j=n.n($),U=n(38629);const W=(0,i.ZP)("performance");function z(e){e?document.body.style.setProperty("--uk-system-accent-color",e):document.body.style.removeProperty("--uk-system-accent-color")}var V=n(63111),X=n(18621),J=n(69297),Y=n(20993);const q={start:()=>{const e=(0,N.i)();e.startJob();const t=(0,d.YP)((()=>e.pendingJobs),(n=>{n>0||(t(),e.markReady())}));setTimeout((()=>e.endJob()),0)}},G=(()=>{const e=[],t=new Map;return{start:()=>{const e=(0,N.i)();e.startJob(),o.ZP.fetch(b.de).then((t=>{Object.keys(t).forEach((e=>{var n;const a=(0,C.F_)(e);null===(n=null==a?void 0:a())||void 0===n||n.$patch(t[e])})),I.Z.on(F.Md,(e=>{e.forEach((({id:e,state:t})=>{var n;const a=(0,C.F_)(e);null===(n=null==a?void 0:a())||void 0===n||n.$patch((0,d.qj)(t))}))})),e.endJob()}))},plugin:n=>{(0,C.W$)(n.store.$id)&&n.store.$subscribe(((a,i)=>{if(n.store.$id!==a.storeId)return;const r=t.get(a.storeId);t.set(a.storeId,!0),(null===window||void 0===window?void 0:window.isEditorFrame)||r&&a.type!==P.x1.patchObject&&(0,C.W$)(a.storeId)&&(e.push({id:a.storeId,state:JSON.parse(JSON.stringify(i))}),Promise.resolve().then((()=>{o.ZP.fetch(b.w6,{states:e}),e.length=0})))}))}}})(),K={start:()=>{(0,H.r)();const e=(0,L.ju)("/static/snowbird/resource/"),t=function(){const e={};return D.Fy(((t,n)=>{e[t]=n.map((e=>({...e,family:t})))})),e}(),n=Object.values(t).flat().map((t=>function({family:e,src:t,italic:n,weight:a,"unicode-range":i},o){const r=new URL(t,o).href;let s={family:e,source:`url("${r}")`,url:r};return void 0!==n&&(s={...s,style:n?"italic":"normal"}),void 0!==a&&(s={...s,weight:a.toString()}),void 0!==i&&(s={...s,unicodeRange:i}),s}(t,e)));!function(e){Promise.all(e.map((({family:e,source:t,...n})=>{const a=new FontFace(e,t,n);return a.load().then((()=>{document.fonts.add(a)})).catch((()=>{B.error("Failed to load css font from",t)}))})))}(n),function(){const e=document.createElement("style"),t=D.Hn();e.innerHTML=t,document.head.appendChild(e),document.body.style.setProperty("--info-button-font",D.o6)}(),(0,_.O)().updateBuiltinFontFamilies(Array.from(new Set(Object.keys(t))))}},Q={start:()=>{const e=(0,N.i)(),{_apr:t,_acc:n}=p().parse(location.search.slice(1));t&&(e.startJob(),W.debug("About to load CSS using _apr query parameter:",t),(0,U.Z)(t,(()=>{W.debug("Loaded CSS using _apr query parameter:",t),setTimeout((()=>{e.endJob()}),10)}))),n&&z(n),"darwin"===j().platform()&&parseFloat(j().release())>=20&&document.body.classList.add("uk-darwin-bigsur"),(0,d.YP)((()=>(0,C.S)().language),((e,t)=>{t&&document.body.classList.remove(`uk-lang-${t}`),e&&document.body.classList.add(`uk-lang-${e}`)}));const a=(0,d.YP)((()=>(0,N.i)().ready),(e=>{e&&(a(),(0,d.YP)((()=>[(0,C.S)().appearance,(0,_.O)().ignoreAppearanceChanged]),(([e,t])=>{t||(0,U.Z)(e)})),(0,d.YP)((()=>(0,C.qr)().systemAccentColor),(e=>z(e))),(0,d.YP)((()=>(0,C.S)().systemScrollbarSetting),(e=>function(e){const t="vk-scrollbar";document.body.classList.forEach((e=>{e.startsWith(t)&&document.body.classList.remove(e)})),document.body.classList.add(`${t}-${(e||"always").toLowerCase()}`)}(e)),{immediate:!0}))}))}},ee={start:()=>{V.nd&&V.qu.forEach((e=>{(0,C.JX)().appendBeforeHandler(e,(()=>(async()=>(await o.ZP.fetch(b.QN),"interruption"))()))})),Object.keys(V.JN).concat(Object.keys(V.oF)).forEach((e=>{(0,C.JX)().appendBeforeHandler(e,(()=>{const t=(0,C.JX)().commandById(e);return(null==t?void 0:t.provider)?(async(e,t)=>{if(!await o.ZP.fetch(b.Gy,{name:e,channel:(0,b.gk)(t)}))return"interruption"})(e,t.provider):"interruption"}))})),V.ZK.forEach((e=>{(0,C.JX)().appendAfterHandler(e,(()=>{const t=e.split(".")[1];(0,X.L9)({eventCategory:"Edit",eventAction:t,eventValue:1})}))})),V.ff.forEach((e=>{(0,C.JX)().appendAfterHandler(e,(()=>{(0,X.L9)({eventCategory:"Share",eventAction:e,eventValue:1})}))})),V.y_.forEach((e=>{(0,C.JX)().appendBeforeHandler(e,(()=>{(0,J.Kl)()}))})),V.xk.forEach((e=>{(0,C.JX)().appendBeforeHandler(e,(()=>{(0,J.fv)()}))})),V.wp.forEach((e=>{(0,C.JX)().appendBeforeHandler(e,(()=>{(0,J.nz)()}))})),(0,C.JX)().appendAfterHandler("editor.addTodo",Y.l5),(0,C.JX)().appendAfterHandler("editor.cancelTask",Y.DY),(0,C.JX)().appendAfterHandler("editor.checkTodo",(()=>{(0,Y.fR)("checkTask")})),(0,C.JX)().appendAfterHandler("editor.uncheckTodo",(()=>{(0,Y.fR)("uncheckTask")})),V.QL.forEach((e=>{(0,C.JX)().appendBeforeHandler(e,(()=>{if((0,C.si)().contexts["collaboration.isReadOnly"])return"interruption"}))})),V.gY.forEach((e=>{(0,C.JX)().appendBeforeHandler(e,(()=>{if((0,C.si)().contexts["collaboration.isFromCloud"])return"interruption"}))}))}},te={start:()=>{const e=(0,N.i)();e.startJob(),(0,C.JX)().injectDoHandleCommand((async(e,t)=>o.ZP.fetch(b.hR,{commandId:e,handlerArgs:t}))),e.endJob()}},ne=[G.plugin];var ae=n(7710);const ie=p().parse(window.location.search.slice(1)),oe=!0,re=!!ie.isBrowserView,se=!!ie.isEditorFrame;let le=f.getCurrentWindow;re&&(le=function(){const e=S.Z.sendSync("get-current-window-id");return f.BrowserWindow.fromId(parseInt(e))});const ce=window.location.pathname.match(/\/([a-zA-Z0-9-]+)\.html$/)[1]||"default",de=(0,i.ZP)("performance"),ue=(0,i.ZP)("sentry");de.debug("Initializing page:",ce),m.webFrame.setVisualZoomLevelLimits(1,1),document.body.classList.add("uk-win32"),Object.defineProperty(window,"id",{get:()=>le().id}),window.getWindowIdAsync=async()=>await(0,T.A)("get-current-window-id");window.getCurrentWindowAsync=async()=>{const e=await window.getWindowIdAsync();return f.BrowserWindow.fromId(parseInt(e))},window.isEditorFrame=se;const pe=d.ZP.observable({isBeingDestroyed:!1,isDestroyed:!1,isShown:!1});["isBeingDestroyed","isDestroyed","isShown"].forEach((e=>{Object.defineProperty(window,e,{get:()=>pe[e],set(t){pe[e]=t}})})),window.show=()=>{le().show()},window.hide=()=>{le().hide()},window.close=()=>{le().close()},window.minimize=()=>{le().minimize()},window.maximize=()=>{le().maximize()},window.restore=()=>{le().unmaximize()},window.isMinimized=()=>le().isMinimized(),window.isMaximized=()=>le().isMaximized(),window.isFullScreen=()=>le().isFullScreen(),window.resizeTo=(e,t)=>{le().setContentSize(e,t)},window.resizeBy=(e,t)=>{let[n,a]=le().getContentSize();le().setContentSize(n+e,a+t)},window.moveTo=(e,t)=>{le().setPosition(e,t)},window.moveBy=(e,t)=>{let[n,a]=le().getPosition();le().setPosition(n+e,a+t)},I.Z.on("window-maximize",(()=>{document.body.classList.add("uk-window-maximized"),window.dispatchEvent(new Event("maximize"))})),I.Z.on("window-unmaximize",(()=>{document.body.classList.remove("uk-window-maximized"),window.dispatchEvent(new Event("restore"))})),I.Z.on("window-minimize",(()=>{window.dispatchEvent(new Event("minimize"))})),I.Z.on("window-unminimize",(()=>{window.dispatchEvent(new Event("unminimize"))})),I.Z.on("window-focus",(()=>{document.body.classList.remove("uk-window-inactive")})),I.Z.on("window-blur",(()=>{document.body.classList.add("uk-window-inactive")})),I.Z.on("window-enter-full-screen",(()=>{document.body.classList.add("uk-window-full-screen"),window.dispatchEvent(new Event("enter-full-screen"))})),I.Z.on("window-leave-full-screen",(()=>{document.body.classList.remove("uk-window-full-screen"),window.dispatchEvent(new Event("leave-full-screen"))})),I.Z.on("window-sheet-begin",(()=>{document.body.classList.add("uk-disabled"),window.dispatchEvent(new Event("sheet-begin"))})),I.Z.on("window-sheet-end",(()=>{document.body.classList.remove("uk-disabled"),window.dispatchEvent(new Event("sheet-end"))})),I.Z.on("window-show",(()=>{window.dispatchEvent(new Event("window-show"))})),I.Z.on(F.$r,(e=>{(0,ae.l)().setQuery(e)}));const me=le&&le();if(me&&me.isMaximized()&&document.body.classList.add("uk-window-maximized"),me&&me.isFullScreen()&&document.body.classList.add("uk-window-full-screen"),me&&!me.isFocused()&&document.body.classList.add("uk-window-inactive"),document.addEventListener("keydown",(e=>{27===e.keyCode&&document.body.querySelector(".uk-window-dialog")&&setTimeout((()=>{if(e.defaultPrevented)return;const t=new Event("close");window.dispatchEvent(t)&&window.close()}),0)})),me&&me.isMaximizable&&me.isMaximizable()){const e=["a","button","select","input"];document.addEventListener("dblclick",(t=>{const{target:n,defaultPrevented:a}=t;if(a)return;let i=n;for(;i&&"function"==typeof i.matches;){if(e.some((e=>i.matches(e))))return;i=i.parentNode}let o=document.querySelector(".vk-window-title-bar-expanded")||document.querySelector(".vk-window-title-bar");o&&o.contains(n)&&(window.isMaximized()?window.restore():window.maximize())}))}d.ZP.use(P.og),d.ZP.use(new x((e=>c.handle(e)))),d.ZP.use(v()),d.ZP.use(Z),d.ZP.use(R),d.ZP.use(A),d.ZP.use(w.ZP.Plugin),de.debug("Initialized page:",ce);const fe=(0,P.WB)();(0,P.uX)(fe),ne.forEach((e=>fe.use(e))),Object.values(C.rx).forEach((e=>e())),q.start(),G.start(),K.start(),Q.start(),ee.start(),te.start();const he=(0,E.Z)("version").includes("beta");if(process.env.SENTRY_DSN_OF_BROWSER&&he){const e=(0,d.YP)((()=>(0,C.qr)().sentryConfig),(t=>{e();try{const e=t[process.env.SENTRY_PROJECT_OF_BROWSER]||{};y.S({Vue:d.ZP,dsn:process.env.SENTRY_DSN_OF_BROWSER,environment:"production",...e}),ue.info("init",e)}catch(e){ue.error("Failed to init sentry",e)}}),{immediate:!1})}async function ve(e,{mountTarget:t="#app",name:n=null,plugins:a=[],runAfterPiniaPlugin:i,editorId:r=null,autoShow:s=!0}={}){de.debug("Bootstrapping:",ce);for(let e of a)d.ZP.use(e);let l;return(0,C._t)((0,g.b3)(window.id)),"dialog-err"===n&&(0,C.VE)((0,g.zN)("dialog-err",window.id)),"dialog-problem"===n&&(0,C.ym)((0,g.zN)("dialog-problem",window.id)),r&&(0,C.OD)((0,g.aJ)(r)),await new Promise((n=>{let a=(0,d.YP)((()=>(0,N.i)().ready),(r=>{r&&(a(),document.body.classList.add(`uk-lang-${(0,C.S)().language}`),i?.(fe),de.debug("About to create Vue instance:",ce),l=new d.ZP({...e,pinia:fe}),de.debug("Created Vue instance:",ce),window.addEventListener("unload",(()=>{window.isBeingDestroyed=!0,l.$destroy(),window.isDestroyed=!0})),de.debug("About to mount Vue instance:",ce),l.$mount(t||"#app"),de.debug("Mounted Vue instance:",ce),(0,O.qJ)().then((async()=>{if(!s)return;const e=await window.getWindowIdAsync();!oe&&await o.ZP.fetch((0,b.EV)(e),"show"),oe&&await o.ZP.fetch((0,b.EV)(e),"moveToShow"),window.isShown=!0})),n(l))}))})),l}},13382:(e,t,n)=>{n.d(t,{G$:()=>T,N0:()=>v,Pg:()=>F,R2:()=>S,W5:()=>I,ZZ:()=>y,am:()=>b,eq:()=>g,yr:()=>E});var a=n(71017),i=n.n(a),o=n(67657),r=n(7104),s=n(23352),l=n(33394),c=n(94593),d=n(90435),u=n(54856),p=n(5893),m=n(87141),f=n(63111);const h=(0,s.ZP)("dialog");async function v(e){(e=Object.assign({},e||{})).icon&&"string"==typeof e.icon&&(e.icon=i().join((0,r.bY)(),e.icon));const t=o.BrowserWindow.fromId(window.id);return[o.dialog.showMessageBoxSync(t,e)]}async function w(e){(e=Object.assign({},e||{})).icon&&"string"==typeof e.icon&&(e.icon=i().join((0,r.bY)(),e.icon));const t=o.BrowserWindow.fromId(window.id),{response:n,checkboxChecked:a}=await o.dialog.showMessageBox(t,e);return[n,a]}async function y(e){(e=Object.assign({securityScopedBookmarks:!0},e||{})).suggestPath&&!e.defaultPath&&(e.defaultPath=b(e.suggestPath,e.filters),delete e.suggestPath);const{canceled:t,filePath:n,bookmark:a}=await o.dialog.showSaveDialog(o.getCurrentWindow(),e);return t?null:(n&&a&&await l.Z.bindBookmark({fp:n,bookmark:a}),n&&(0,m.km)().setLastSaveDirectory(i().dirname(n)),n)}async function g({folderName:e,dialogOptions:t}){let n="";(t=Object.assign({securityScopedBookmarks:!0},t||{})).defaultPath||(t.defaultPath=b({}));const{canceled:a,filePaths:r,bookmark:s}=await o.dialog.showOpenDialog(o.getCurrentWindow(),t);if(a)return null;if(n=r[0],r.length>0&&s&&await l.Z.bindBookmark({fp:n,bookmark:s}),"string"==typeof e){let t=e.replace(/[\\/]/g,"");t=(0,p.N6)(t).replace(/\.+$/g,"").trim(),n=i().join(n,t)}return c.Z.existsSync(n)||c.Z.ensureDir(n),n&&(0,m.km)().setLastSaveDirectory(n),n}function b({doc:e=null,oldDoc:t=null,suggestedName:n=null},a=null){let r,s;if(!r&&n&&(r=(0,p.N6)(n.toString())),!r&&e&&e.title&&e.source&&!e.source.startsWith("new://")&&(r=(0,p.N6)(e.title.toString())),!r&&t&&t.title&&t.source&&!t.source.startsWith("new://")&&(r=(0,p.N6)(t.title.toString())),r&&Array.isArray(a)){const e=a[0]&&a[0].extensions;Array.isArray(e)&&e.length>0&&(r=`${r}.${e[0]}`)}if(!s&&t&&t.source&&t.source.startsWith("file://")){let e=t.source.slice(7);e=e.substring(1),s=i().dirname(e)}if(!s&&(0,m.km)().lastSaveDirectory&&(s=(0,m.km)().lastSaveDirectory),!s)try{s=o.app.getPath("documents")}catch(e){h.info(e)}return s&&r?i().join(s,r):s||r}async function I(e){e.$withUIKit((t=>{const n=`\n        <button\n        class="vk-button-text vk-size-small uk-text-nowrap"\n        style="word-break: keep-all;"\n        focustrigger="cannotGetFocusByMouse">\n          ${e.$T("OK")}\n        </button>\n        </div>`;t.toast({message:e.$T("The map style has been updated for your current version of Xmind."),pos:"bottom-center",timeout:5e3,btn:n,style:{width:"500px",height:"auto",padding:"10px 20px"},btnClick:t.toast.clearAll()})}))}async function S(e){const t=(e="function"!=typeof e?e=>e:e)("OK"),n=e("Get Latest Version"),a=[t,n],[i]=await w({title:"Xmind",message:e("The map style in this file might vary since it was created in a newer version of Xmind."),detail:e("You can continue to open the file or update to the latest version for better compatibility."),buttons:a,defaultId:a.indexOf(n),cancelId:a.indexOf(t),noLink:!0});i===a.indexOf(n)&&d.ZP.fetch(u.lf.GO_DOWNLOAD)}async function T(e){if(e="function"!=typeof e?e=>e:e,f.zr)return await w({title:"Xmind",message:e("Failed to Open File"),detail:e("The file was created with a newer version of Xmind. Please contact your corporate administrator for the latest update."),buttons:[e("Done")],defaultId:0,noLink:!0});const t=e("Cancel"),n=e("Get Latest Version"),a=[n,t],[i]=await w({title:"Xmind",message:e("Failed to Open File"),detail:e("The file was created by a newer version of Xmind. Please update Xmind and try to open it again."),buttons:a,defaultId:a.indexOf(n),cancelId:a.indexOf(t),noLink:!0});i===a.indexOf(n)&&d.ZP.fetch(u.lf.GO_DOWNLOAD)}async function E(e){const t=(e="function"!=typeof e?e=>e:e)("Save"),n=e("Save as"),a=e("Cancel"),i=[];i.push(n,t,a);let[o]=await w({type:"none",title:"Xmind",message:e("Saving file from Xmind"),detail:e("Once you save the file, it cannot be opened normally in older versions like $1.","Xmind 22.11"),buttons:i,defaultId:i.indexOf(n),cancelId:i.indexOf(a),noLink:!0});const r=o===i.indexOf(t),s=o===i.indexOf(n);return{toSave:r,toSaveAs:s,toCancel:!r&&!s}}async function F(e){const t=(e="function"!=typeof e?e=>e:e)("Fix ï¼† Open"),n=e("Cancel"),a=[t,n],[i]=await w({title:"Xmind",message:e("Failed to Open File"),detail:e("The file may contain invalid data structure or have become corrupted. Xmind can try to fix the data structure to help you open it."),buttons:a,defaultId:a.indexOf(t),cancelId:a.indexOf(n),noLink:!0});return{toFix:i===a.indexOf(t),toCancel:i===a.indexOf(n)}}},33394:(e,t,n)=>{n.d(t,{Z:()=>f});var a=n(57147),i=n.n(a),o=n(71017),r=n.n(o),s=n(73837),l=n(23352),c=n(96829),d=n(56222);const u=(0,l.ZP)("renderer:fs");async function p(e){return(0,d.A)("OBTAIN_READ_WRITE_ACCESS",e)}async function m(e){return(0,d.A)("RELEASE_READ_WRITE_ACCESS",e)}const f={read:async function(e){if(!r().isAbsolute(e))throw new Error("Must be an absolute path.");const t=await async function(e){return(0,d.A)("OBTAIN_READ_LOCK",e)}(e);try{return await(0,s.promisify)(i().readFile)(e)}catch(t){u.error(`path(${e}) read error: ${(0,c.SC)(t)}`);try{if(!await p(e))throw new Error(`No access to '${e}'`);return await(0,s.promisify)(i().readFile)(e)}catch(e){throw e}finally{await m(e)}}finally{await async function(e){return(0,d.A)("RELEASE_READ_LOCK",e)}(t)}},write:async function(e,t){if(!r().isAbsolute(e))throw new Error("Must be an absolute path.");const n=await async function(e){return(0,d.A)("OBTAIN_WRITE_LOCK",e)}(e);try{return await(0,s.promisify)(i().writeFile)(e,t)}catch(n){u.error(`path(${e}) write error: ${(0,c.SC)(n)}`);try{if(!await p(e))throw new Error(`No access to '${e}'`);return await(0,s.promisify)(i().writeFile)(e,t)}catch(e){throw e}finally{await m(e)}}finally{await async function(e){return(0,d.A)("RELEASE_WRITE_LOCK",e)}(n)}},bindBookmark:async function({fp:e,bookmark:t}={}){return(0,d.A)("BIND_BOOKMARK",{fp:e,bookmark:t})},hasRWAccess:async function(e){return(0,d.A)("HAS_READ_WRITE_ACCESS",e)},obtainRWAccessFromOS:p,releaseRWAccessFromOS:m}},94593:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(81296),i=n.n(a);const o=(0,n(23352).ZP)("ipc:proxy:"),r=new Proxy(i(),{get(e,t){let n=Reflect.get(e,t);return"function"==typeof n?(...a)=>{if(!window.isDestroyed)return n.apply(e,a);o.error(`window has been destroyed, we should not invoke fsp.${t})`)}:n}})},56222:(e,t,n)=>{n.d(t,{A:()=>o});var a=n(72298);let i=0;function o(e,t){return new Promise((n=>{const o=i++;a.ipcRenderer.once(`internal-ipc-api-reply:${e}:${o}`,((e,{data:t=null})=>{n(t)})),a.ipcRenderer.send(`internal-ipc-api:${e}`,{payload:t,seq:o})}))}},28914:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(72298);const i=(0,n(23352).ZP)("ipc:proxy:"),o=new Proxy(a.ipcRenderer,{get(e,t){let n=Reflect.get(e,t);return"function"==typeof n?(...a)=>{if(!window.isDestroyed)return n.apply(e,a);i.error(`window has been destroyed, we should not invoke ipcRenderer.${t} with args (${JSON.stringify(a)})`)}:n}})},90435:(e,t,n)=>{n.d(t,{ZP:()=>l,he:()=>s});var a=n(96829),i=n(28914);const o=new Map;let r=0;function s(e,t){const n=o.get(e);return n?Promise.resolve().then((()=>n(t))):new Promise(((n,o)=>{const s=r++;i.Z.once(`ipc-api-reply:${e}:${s}`,((e,{error:t=null,data:i=null})=>{t?o((0,a.aq)(t)):n(i)})),i.Z.send(`ipc-api:${e}`,{payload:t,seq:s})}))}const l={fetch:s,route:function(e,t){if("function"!=typeof t)throw new Error(`IPC API "${e}" is routed to invalid handler: ${typeof t}`);if(o.has(e))throw new Error(`IPC API "${e}" is routed twice`);const n=`ipc-api:${e}`;if(i.Z.eventNames().includes(n))throw new Error(`IPC API "${e}" is routed twice`);const r=(n,{payload:o=null,seq:r=0}={})=>{const s=`ipc-api-reply:${e}:${r}`;Promise.resolve().then((()=>t(o))).then((e=>{i.Z.send(s,{data:e})})).catch((e=>{i.Z.send(s,{error:(0,a.SC)(e)})}))};return o.set(e,t),i.Z.on(n,r),i.Z.send("ipc-api-register",{apiName:e}),()=>{i.Z.send("ipc-api-unregister",{apiName:e}),i.Z.removeListener(n,r),o.delete(e)}}}},23352:(e,t,n)=>{n.d(t,{ZP:()=>c});var a=n(82134),i=n(96829),o=n(79409),r=n(72298);const s=new a.Jq(global.console,{colorful:!1}),l=new a.Yd({isDebugging:(0,o.Z)("version").indexOf("-alpha")>=0||(0,o.Z)("version").indexOf("-dev")>=0||i.x,handle(e){s.handle(e),function(e){r.ipcRenderer.send("logger:handleLogEvent",e)}(e)}}),c=(e=null)=>l.logger(e)},79409:(e,t,n)=>{n.d(t,{Z:()=>c});var a=n(71017),i=n.n(a),o=n(57147),r=n.n(o),s=n(7104);let l=null;function c(e=null){return l||(l=JSON.parse(r().readFileSync(i().join((0,s.bY)(),"package.json")))),e?l[e]:l}},69931:(e,t,n)=>{n.d(t,{Al:()=>u,ju:()=>l,pP:()=>c,zD:()=>d});var a=n(71017),i=n.n(a),o=n(94593),r=n(7104),s=n(5893);function l(e){return(0,s.u3)(i().join((0,r.bY)(),e))}function c(e){return(0,s.u3)(i().join((0,r.D8)(),e))}function d(e){return o.Z.readFile(i().join((0,r.bY)(),e))}const u=(...e)=>l(...e).replace("(","%28").replace(")","%29")},73884:(e,t,n)=>{n.d(t,{Z:()=>d});var a=n(82361),i=n.n(a),o=n(28914);const r=new(i()),s=r.emit;r.emit=function(e,...t){s.call(r,e,...t),c(e)&&o.Z.send("revents:broadcast",[e,...t])},r.on("newListener",(e=>{if(c(e)){0===r.eventNames().filter(c).length&&o.Z.send("revents:register")}})),r.on("removeListener",(e=>{if(c(e)){0===r.eventNames().filter(c).length&&o.Z.send("revents:unregister")}}));const l=r.removeAllListeners;function c(e){return"newListener"!==e&&"removeListener"!==e}r.removeAllListeners=function(e){if(!e)throw new Error("revents's removeAllListeners is forbidden!");if("newListener"===e||"removeListener"===e)throw new Error('revents\'s "newListener" and "removeListener" handler should not be removed');l.call(r,e)},o.Z.on("revents:broadcast",((e,t)=>{let n=JSON.parse(t);s.apply(r,n)})),window.addEventListener("unload",(()=>{o.Z.send("revents:unregister")}));const d=r},69297:(e,t,n)=>{n.d(t,{Do:()=>o,Kl:()=>r,N1:()=>i,fv:()=>s,nz:()=>l});var a=n(28914);function i(){return a.Z.sendSync("usage-stats:data")}function o(){a.Z.send("usage-stats:increase",{type:"dwellTimeInZenMode",value:1e3})}function r(e=1){a.Z.send("usage-stats:increase",{type:"topicsAdded",value:e})}function s(e=1){a.Z.send("usage-stats:increase",{type:"sheetsAdded",value:e})}function l(e=1){a.Z.send("usage-stats:increase",{type:"eventsTriggered",value:e})}},18621:(e,t,n)=>{n.d(t,{Fk:()=>o,L9:()=>i});var a=n(28914);function i(e){a.Z.send("usage-tracker:track-event",{event:e})}function o(e){a.Z.send("usage-tracker:track-view",{view:e})}},7104:(e,t,n)=>{n.d(t,{D8:()=>d,Im:()=>f,L2:()=>p,N8:()=>u,O1:()=>h,Xl:()=>y,bY:()=>c,d6:()=>w,tM:()=>v,tY:()=>m});var a=n(71017),i=n.n(a),o=n(72298),r=n(56222);let s=null;let l=null;function c(){return l||(l=o.ipcRenderer.sendSync("workspace:appPath")),l}function d(){return i().join((s||(s=o.ipcRenderer.sendSync("workspace:userData")),s),"vana")}function u(){return i().join(d(),"workbooks")}function p(){return i().join(d(),"file-cache")}function m(){return i().join(d(),"theme")}function f(){return i().join(d(),"smart-color")}function h(){return i().join(d(),"illustrations")}function v(){return i().join(d(),"templates")}function w(){return i().join(c(),"static/snowbird/resource/")}async function y(){return s||(s=await(0,r.A)("workspace:userData")),i().join(s,"vana","workbooks")}},38629:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(69931);function i(e,t=null){document.documentElement.setAttribute("color-scheme","default"===e?"light":"dark");if(document.querySelector("#appearance_link"))return void("function"==typeof t&&t());const n=(0,a.ju)("static/vanakit/themes/vana.css"),i=document.createElement("link");i.type="text/css",i.id="appearance_link",i.rel="stylesheet",i.href=n,i.setAttribute("data-appearance",e),"function"==typeof t&&(i.onload=()=>t()),document.head.appendChild(i)}},60746:(e,t,n)=>{n.d(t,{GI:()=>f,JX:()=>p,Ni:()=>h,QC:()=>y,RL:()=>w,RS:()=>u,SX:()=>b,Sr:()=>g,gP:()=>v,lF:()=>m,mi:()=>S,sF:()=>d,yB:()=>I});n(13382),n(81296),n(90435),n(54856),n(71017);var a=n(72298),i=n(67657),o=(n(63111),n(41809)),r=(n(30053),n(97234)),s=n(26601),l=n(87141);const c={cache:!1},d=e=>{const t=e=>parseInt(e,16);if("string"==typeof(e=(0,r.Z)(e).toHexString())&&/^#[A-Z0-9]{6}$/.test(e.toUpperCase())){return.2126*t(e.slice(1,3))+.7152*t(e.slice(3,5))+.0722*t(e.slice(5))}return 0},u=(e={})=>{const t=Object.assign({},c,e);let n=null;const a={};return function(e="",i=""){if(t.cache&&a[e])return a[e];n||(n=document.createElement("canvas"));const o=n.getContext("2d");o.font=i;const r=o.measureText(e);return t.cache&&(a[e]=r.width),r.width}};function p(){const e=i.screen.getAllDisplays().map((e=>e.scaleFactor));return Math.max.apply(null,e)}const m=(e,t=1)=>{const n=p(),a=(0,o.Hv)(e,72*n*t);return Buffer.from(a.slice(22),"base64")};function f(e){let t=parseInt(e);return Number.isInteger(t)?t:100}function h(e){return`${parseInt(e)}%`}const v=function(){let e=null;return function(){if(!e)if(window.screen.deviceXDPI&&window.screen.deviceYDPI)e={x:window.screen.deviceXDPI,y:window.screen.deviceYDPI};else{const t=document.createElement("div");t.style.cssText="width:1in;height:1in;position:absolute;left:0px;top:0px;z-index:99;visibility:hidden",document.body.appendChild(t),e={x:parseInt(t.offsetWidth),y:parseInt(t.offsetHeight)},t.parentNode.removeChild(t)}return e}}();function w(e,t){let n=(0,l.f7)().keybindingByCommandIdAndGroup(t);const a=[];return"string"==typeof n&&n.split("+").forEach((e=>{let t=e;"="===t&&(t="+"),t&&a.push(t)})),a.length>0?`${e} ${a.join(" ")}`:e}const y=({width:e,height:t,animate:n=!1})=>{i.getCurrentWindow().setSize(e,t,n)},g=e=>{const t=(e,...t)=>(0,l.JE)().T(e,...t),n=i.Menu,o=i.MenuItem,r=new n;setTimeout((()=>{const n=document.getSelection().toString(),s=a.clipboard.readText();r.append(new o({label:t("Cut"),enabled:Boolean(n),click:()=>document.execCommand("cut")})),r.append(new o({label:t("Copy"),enabled:Boolean(n),click:()=>document.execCommand("copy")})),r.append(new o({label:t("Paste"),enabled:Boolean(s),click:()=>document.execCommand("paste")})),r.append(new o({type:"separator"})),r.append(new o({label:t("Select All"),enabled:Boolean(e),click:()=>document.execCommand("selectAll")})),r.popup({window:i.getCurrentWindow()})}),50)};async function b(){await new Promise((e=>requestAnimationFrame((()=>{requestAnimationFrame((()=>{requestIdleCallback(e)}))}))))}const I=(e,t)=>0===e||0===t||s.Z.test({width:e,height:t,sizes:[e,t]}),S=async(e,t,n=1)=>{if(I(e*n,t*n))return n;const a=await s.Z.maxWidth({usePromise:!0}),i=await s.Z.maxHeight({usePromise:!0}),o=await s.Z.maxArea({usePromise:!0}),r=a.width,l=i.height,c=o.width*o.height;let d=n;if(e*n>r){const t=r/e;d=Math.min(d,t)}if(t*n>l){const e=l/t;d=Math.min(d,e)}if(e*n*t*n>c){const n=Math.sqrt(c/(e*t));d=Math.min(d,n)}return d}},10042:(e,t,n)=>{n.d(t,{Ec:()=>m,Hz:()=>f,Li:()=>u.Li,XO:()=>u.XO,aR:()=>y,fR:()=>p,jp:()=>h,qE:()=>w,s9:()=>v,v1:()=>g,zo:()=>I});var a=n(7104),i=n(94593),o=n(71017),r=n.n(o),s=n(96829),l=n(6851),c=n.n(l),d=n(19805),u=n(44862);async function p(e,t){const n=r().join((0,a.tY)(),e);i.Z.existsSync(n)&&await i.Z.remove(n),"function"==typeof t&&await t()}async function m(e,t){const n="CUSTOM-"+(0,s.hb)(),o=r().join((0,a.tY)(),e),l=r().join((0,a.tY)(),n);await new Promise(((e,t)=>c()(o,l,(n=>{if(n)return t(n);e()}))));const d=await h(n);d.id=n,await i.Z.writeFile(r().join(l,"content.json"),JSON.stringify(d)),await t(n)}async function f(e,t,n,o){const s=(0,a.tY)(),l=r().join(s,e);await i.Z.ensureDir(l);const c=r().join(l,"content.json"),d=r().join(l,"previews");await i.Z.ensureDir(d),await t(c),await n(d),await o()}function h(e){const t=(0,a.tY)(),n=r().join(t,e),o=r().join(n,"content.json");return JSON.parse(i.Z.readFileSync(o))}const v=d.DEFAULT_SKELETON_THEME_ID,w=d.DEFAULT_COLOR_THEME_ID;const y=e=>{let t=e.slice();for(;t.length<6;)t=t.concat(e);return t.slice(0,6)},g=e=>{if(!Array.isArray(e)||0===e.length)return{};const t=360/e.length;return{background:`conic-gradient(${e.map(((e,n)=>`${e} ${n*t}deg ${(n+1)*t}deg`)).join(", ")})`,borderRadius:"50%"}},b=e=>{const t=[0,1,2,3,5,8];for(let n of t)if(e<=n)return n;return e},I=e=>(["map","centralTopic","subTopic","mainTopic","summaryTopic","calloutTopic","boundary","floatingTopic","relationship","importantTopic","minorTopic","expiredTopic"].forEach((t=>{const n=e[t]&&e[t].properties;if(!n)return;const a=parseInt(n["line-width"]);Number.isNaN(a)||(n["line-width"]=`${b(a)}pt`);const i=parseInt(n["border-line-width"]);Number.isNaN(i)||(n["border-line-width"]=`${b(i)}pt`)})),e)},20993:(e,t,n)=>{n.d(t,{AZ:()=>H,Ao:()=>O,Bv:()=>w,C3:()=>E,CI:()=>B,CN:()=>P,DY:()=>s,I1:()=>h,JC:()=>i,NK:()=>d,Pr:()=>p,TJ:()=>g,Vs:()=>A,Wr:()=>N,Xz:()=>x,Yj:()=>I,Zk:()=>u,_5:()=>M,_6:()=>F,cZ:()=>b,cx:()=>L,dx:()=>f,fR:()=>r,jB:()=>m,kI:()=>l,l5:()=>o,p3:()=>c,sF:()=>Z,sG:()=>T,t0:()=>_,wH:()=>D,wp:()=>y,xG:()=>C,xg:()=>S,xy:()=>v,yo:()=>R,zH:()=>k});var a=n(18621);const i=e=>(0,a.L9)({eventName:"Gallery",eventAction:e}),o=()=>(0,a.L9)({eventAction:"insertTask",eventName:"insertTask"}),r=e=>(0,a.L9)({eventAction:"editTask",eventName:e}),s=()=>(0,a.L9)({eventAction:"cancelTask",eventName:"cancelTask"}),l=e=>(0,a.L9)({eventAction:"highlightTask",eventName:e}),c=e=>(0,a.L9)({eventAction:"insertIllustration",eventName:e}),d=e=>(0,a.L9)({eventAction:"searchIllustration",eventName:e}),u=e=>(0,a.L9)({eventAction:"insertIllustrationPro",eventName:e}),p=(e,t,n)=>(0,a.L9)({eventAction:"openTemplateType",eventName:`${e}_${t}_${n}`}),m=e=>(0,a.L9)({eventAction:"popPW",eventName:e}),f=e=>(0,a.L9)({eventAction:"clickPW",eventName:e}),h=()=>{(0,a.L9)({eventAction:"cancelOverlap"})},v=()=>(0,a.L9)({eventAction:"paymentPage"}),w=()=>(0,a.L9)({eventAction:"paymentPageCN"}),y=()=>(0,a.L9)({eventAction:"paymentSuccessful"}),g=()=>(0,a.L9)({eventAction:"paymentSuccessfulCN"}),b=e=>(0,a.L9)({eventName:"PWD-sp35-240515",eventAction:e}),I=()=>(0,a.L9)({eventAction:"sharetoCollaboration"}),S=()=>(0,a.L9)({eventAction:"sharetoEvernote"}),T=e=>(0,a.L9)({eventAction:"pweDisplay",eventName:e}),E=e=>(0,a.L9)({eventAction:"pweContinue",eventName:e}),F=e=>(0,a.L9)({eventAction:"closePwe",eventName:e}),P=e=>(0,a.L9)({eventAction:"pweOrder",eventName:e}),A=e=>(0,a.L9)({eventAction:"purchaseSource",eventName:e}),C=e=>(0,a.L9)({eventAction:"purchaseWindow",eventName:e}),Z=({region:e,productId:t})=>(0,a.L9)({eventCategory:"Activate",eventAction:"clickSubscriptButton"+e.toLowerCase(),eventName:t}),k=({region:e,productId:t})=>(0,a.L9)({eventCategory:"Activate",eventAction:"clickSubscriptButtonMAS"+e.toLowerCase(),eventName:t}),M=()=>(0,a.L9)({eventAction:"autoDisconnect"}),x=()=>(0,a.L9)({eventAction:"disableSmartGuideline",eventName:"disableSmartGuideline"}),L=()=>(0,a.L9)({eventAction:"enableSmartGuideline",eventName:"enableSmartGuideline"}),R=()=>(0,a.L9)({eventAction:"clickSearchMaps",eventName:"clickSearchMaps"}),O=()=>(0,a.L9)({eventAction:"insertTaskInfo",eventName:"insertTaskInfo"}),N=()=>(0,a.L9)({eventAction:"removeTaskInfo",eventName:"removeTaskInfo"}),D=()=>(0,a.L9)({eventAction:"enableAutoCalculate",eventName:"enableAutoCalculate"}),_=()=>(0,a.L9)({eventAction:"disableAutoCalculate",eventName:"disableAutoCalculate"}),H=()=>(0,a.L9)({eventAction:"disableDisplayinTopic",eventName:"disableDisplayinTopic"}),B=()=>(0,a.L9)({eventAction:"enableDisplayinTopic",eventName:"enableDisplayinTopic"})},80356:(e,t,n)=>{n.d(t,{C:()=>be});var a=n(87141),i=n(23352),o=n(84374),r=n(89019),s=n(45064),l=n(62004);const c=(0,i.ZP)("collaboration"),d=()=>({connect:async({type:e,fileId:t,password:n})=>{const i=`${e}.${t}`;return await new Promise(((o,r)=>{const d=new s.Ui({url:(0,l.Y)().getHocuspocusServerURL({type:e,fileId:t}),name:i,connect:!1,broadcast:!1,token:(0,a.c7)().fireflyToken,parameters:{strategy:"force",...n&&{password:n}}}),u=async()=>{c.info("synced",i),h(),o(d)},p=()=>{c.info("authenticated",i)},m=e=>{c.error("authenticationFailed",i,e),h(),d.destroy(),r(e)},f=e=>{var t,n;c.info("close",i,null===(t=e.event)||void 0===t?void 0:t.code,null===(n=e.event)||void 0===n?void 0:n.reason)},h=()=>{d.off("synced",u),d.off("authenticated",p),d.off("authenticationFailed",m),d.off("close",f)};d.on("synced",u),d.on("authenticated",p),d.on("authenticationFailed",m),d.on("close",f),d.connect()}))}});var u=n(2954),p=n(23279),m=n.n(p),f=n(73884),h=n(20993);const v=(0,i.ZP)("collaboration"),w=(()=>{const e=m()((()=>{v.info("auto disconnect"),(0,h._5)(),be().offConnect(),be().openAutoDisconnectToast()}),18e5);return t=>{const n=(0,u.iH)(!0),a=()=>{n.value||e()},i=()=>{n.value=!0,e.cancel()},o=()=>{n.value=!1,e()};return t.document.on("update",a),f.Z.on("window-focus",i),f.Z.on("window-blur",o),()=>{e.cancel(),t.document.off("update",a),f.Z.off("window-focus",i),f.Z.off("window-blur",o)}}})();var y=n(71922),g=n(23493),b=n.n(g),I=n(34218),S=n(96829),T=n(89411);const E=(0,i.ZP)("collaboration"),F=()=>{let e=null;return{initUndoManager:t=>{e=new I.H6(t.getArray(y.pz),{captureTimeout:0,ignoreRemoteMapChanges:!0,trackedOrigins:new Set([P])})},undo:()=>null==e?void 0:e.undo(),redo:()=>null==e?void 0:e.redo(),canUndo:()=>null==e?void 0:e.canUndo(),canRedo:()=>null==e?void 0:e.canRedo(),clearUndoManager:()=>null==e?void 0:e.clear()}};class P{constructor(e){this.doc=e}}var A=n(54856),C=n(90435);const Z=(0,i.ZP)("collaboration"),k=()=>{const e=(0,u.iH)(!1),t=e=>e.titleUnedited;return{checkAutoRenameAvailable:n=>{if("new"===(0,T.FU)().protocolFrom){const a=n.sheets[0].rootTopic;e.value=t(a)}else e.value=!1},autoRenameFromCentralTopic:m()((async n=>{if(!e.value)return;const a=n.sheets[0].rootTopic;t(a)||(await(async({fileId:e,fileName:t})=>{try{await C.ZP.fetch(A.rM.RENAME_FILE,{fileId:e,fileName:t}),Z.info("auto rename",t)}catch(e){Z.error("Failed to auto rename",e)}})({fileId:(0,T.FU)().fileId,fileName:a.title}),e.value=!1)}),300)}};const M=(e,t)=>{const{checkAutoRenameAvailable:n,autoRenameFromCentralTopic:a}=k(),i=new Map;let s=null;const c=(e,t)=>{const n=t||`local-${(0,S.hb)()}`,a=t?e:e.asMutable().metadataFor("familyId",n).commit();return i.set(n,a),a},d=async e=>{const{content:t,metadata:n}=y.ju.fromYdoc(e);if(t&&n){const{doc:a,fixedContent:i}=await o.HG.deserializeDocumentWithFix({content:t,metadata:n});if(i){const n=(0,y.hg)(t,i);n&&(0,y.Ct)(e,{content:n,metadata:void 0},{fixedContentDoc:a})}return a}return null},p=m()((e=>{let t=!1;return async()=>{try{const{sheets:n,activeSheetId:a}=(0,o.nZ)(),i=n.value[0].id===a.value;if("readwrite"!==(0,r.c)().connectionMode||t||!i)return;t=!0,await new Promise((e=>setTimeout(e,200)));const s=await(0,T.FU)().thumbnailGenerator.generateThumbnail(a.value);await(0,l.Y)().uploadThumbnail({fileId:e,file:s}),t=!1}catch(e){E.error("upload thumbnail failed",e)}}})(t),1e4),f=new Set,h=async()=>{const t=function(e,t,n){const a=e.getArray(y.pz),i=a.map((e=>e.get("id")));0===t.size&&(t=new Set(i));const r=n.sheets.map((e=>e.id)),s=[];return i.forEach(((e,n)=>{if(!r.includes(e)){const e=a.get(n).toJSON(),t=o.aX.deserializeSheetFromJSON(e);s.push({type:"addSheet",sheet:t,options:{at:n}})}if(t.has(e)){const e=a.get(n).toJSON(),t=o.aX.deserializeSheetFromJSON(e);s.push({type:"updateSheet",patch:t})}})),r.forEach((e=>{i.includes(e)||s.push({type:"removeSheet",sheetId:e})})),i.forEach(((e,t)=>{s.push({type:"moveSheet",sheetId:e,options:{at:t}})})),function(e,t){const n=e.asMutable();return t.forEach((e=>{switch(e.type){case"removeSheet":n.removeSheets([e.sheetId]);break;case"moveSheet":n.moveSheet(e.sheetId,e.options);break;case"addSheet":n.addSheets([n.Sheet(e.sheet)]);break;case"updateSheet":n.updateSheets([n.Sheet(e.patch)])}})),n.commit()}(n,s)}(e.document,f,s);if(!t)return;f.clear();const n=c(t);var a;s=n,(0,o.nZ)().changeDoc(n),null===(a=(0,o.nZ)().activeSheetViewer.value)||void 0===a||a.restoreViewportState()},v=b()(h,300),w=async(t,n,i,r)=>{var l;if(n instanceof I.H6)x(r).forEach((e=>f.add(e))),h();else if(n===e)x(r).forEach((e=>f.add(e))),v();else if(null==n?void 0:n.fixedContentDoc)s=c(n.fixedContentDoc),(0,o.nZ)().changeDoc(s),be().clearUndoManager();else if(n instanceof P){const t=n.doc.local,i=null===(l=t.metadataFor)||void 0===l?void 0:l.call(t,"familyId");if(i!==(null==s?void 0:s.metadataFor("familyId"))){const t=await d(e.document);if(!t)return;s=c(t),(0,o.nZ)().changeDoc(s)}else s=c(t,i);a(t)}},g=(0,u.YP)((()=>(0,o.nZ)().document.value),(async t=>{const n=t.metadataFor("familyId"),a=i.get(n);if(!n||!a||a===(0,u.IU)(t))return;const r=function(e,t){const n=e=>{const t={items:e.sheets.map(((e,t)=>({id:e.id,revisionId:e.revisionId,sheetIndex:t}))),getId:e=>e.id,getRevisionId:e=>e.revisionId,getSheetIndex:e=>e.sheetIndex,transform:t=>{const n=e.query({id:t.id}).asSheet(),{revisionId:a,...i}=o.aX.serializeSheetToJSON(n);return i},findItem:e=>t.items.find((t=>t.id===e))};return t};return function(e,t){const n=[],a=[];for(const a of e.items){const i=e.getId(a),o=t.findItem(i);!o||e.getRevisionId(a)===t.getRevisionId(o)&&e.getSheetIndex(a)===t.getSheetIndex(o)?n.push({id:i}):n.push(e.transform(a))}for(const n of t.items){const i=t.getId(n),o=e.findItem(i);o?e.getRevisionId(o)!==t.getRevisionId(n)||e.getSheetIndex(o)!==t.getSheetIndex(n)?a.push(t.transform(n)):a.push({id:i}):a.push(t.transform(n))}return(0,y.hg)(n,a)}(n(e),n(t))}(a,t),s=o.aX.serializeMetadata(a),l=o.aX.serializeMetadata(t),c=(0,y.hg)(s,l);(r||c)&&((0,y.Ct)(e.document,{content:r,metadata:c},new P({local:t})),p())}),{immediate:!1});return{start:async()=>{const t=await d(e.document);if(!t)return null;const a=c(t);return s=a,be().initUndoManager(e.document),e.document.on("update",w),n(a),a},offSync:()=>{e.document.off("update",w),g()}}};function x(e){const t=Array.from(e.changed.keys()),n=new Set,a=e=>null===e||null===e.parent?null:e instanceof I.D5&&e.parent instanceof I.mJ&&null===e.parent.parent?e:a(e.parent);for(const e of t){const t=a(e);t&&n.add(t.get("id"))}return n}var L=n(18446),R=n.n(L),O=n(46016),N=n(53775);const D=["#CA483C","#EDA155","#EED346","#54B980","#4F69F6","#4C49B7","#8A38DC"],_={edit:0,preedit:1,select:2},H=e=>{const t=(0,a.JE)().T,{viewportState:n,startUpdateViewport:i,stopUpdateViewport:s}=(()=>{const e=(0,u.iH)(null),t=[],n=(0,N.P2)((t=>{if(!t)return;const{x:n,y:a}=function(e){const{layerSize:t,viewportLocation:n,zoomScale:a,viewportSize:i}=e;return{x:n.x+i.width/2/a-t.width/2,y:n.y+i.height/2/a-t.height/2}}(t);e.value={...e.value,sheetId:(0,o.nZ)().activeSheetId.value,sheetScale:t.zoomScale,viewportX:n,viewportY:a,viewportWidth:t.viewportSize.width,viewportHeight:t.viewportSize.height}}),100),a=(0,N.P2)((t=>{t&&(e.value={...e.value,cursorX:t.x,cursorY:t.y})}),100),i=(0,N.P2)((t=>{var n;t&&t!==(null===(n=e.value)||void 0===n?void 0:n.sheetId)&&(e.value={...e.value,sheetId:t})}),100);return{viewportState:e,startUpdateViewport:()=>{t.push((0,u.YP)((()=>(0,o.nZ)().activeSheetViewportMetrics.value),n,{immediate:!0}),(0,u.YP)((()=>(0,o.nZ)().activeCursorPoint.value),a,{immediate:!0}),(0,u.YP)((()=>(0,o.nZ)().activeSheetId.value),i,{immediate:!0}))},stopUpdateViewport:()=>{t.forEach((e=>e())),e.value=null}}})(),l=(0,u.iH)([]),c=(0,u.iH)([]),d=(0,u.iH)([]),p=(0,u.XI)(),m=(0,u.iH)(!1),f=(0,u.Fl)((()=>c.value.map((e=>{const t=l.value.find((t=>t.clientId===e.clientId));return t?{...e,...t,isFollowing:!1}:null})).filter((t=>!!t&&t.clientId!==e.clientID)).sort(((e,t)=>_[e.action]-_[t.action])))),h=(0,u.Fl)((()=>c.value.filter((t=>t.clientId!==e.clientID&&("preedit"===t.action||"edit"===t.action))).flatMap((e=>e.topics)).map((e=>"legend"===e.type?{kind:e.type,unselectable:!0}:{kind:"summary"===e.type?"topic":e.type,id:e.id,unselectable:!0})))),v=(0,u.Fl)((()=>f.value.filter((e=>"preedit"===e.action||"edit"===e.action)).flatMap((e=>e.topics)))),w=(0,u.Fl)((()=>{var e;return(0,O.$)().isTopicContentEditing&&(null===(e=(0,o.nZ)().selection.value)||void 0===e?void 0:e.modelIds.length)>0?[{type:"topic",id:(0,o.nZ)().selection.value.modelIds[0]}]:null})),y=e=>e.isMe?0:1,g=[(0,u.YP)((()=>f.value),(e=>{d.value=e}),{immediate:!1}),(0,u.YP)((()=>[d.value,(0,o.nZ)().isInBranchOnly.value]),(([e,t])=>{(0,o.nZ)().setCollaborativeStatus(t?[]:e)}),{immediate:!1}),(0,u.YP)((()=>l.value),(t=>{const n=t.map((t=>({...t,isMe:t.clientId===e.clientID}))).sort(((e,t)=>y(e)-y(t)));(0,r.c)().setOnlineCollaborators(n)}),{immediate:!1}),(0,u.YP)([(0,o.nZ)().activeSheetViewerState,(0,o.nZ)().activeSheetId],(([e,t])=>{p.value=$(e,t)}),{immediate:!1}),(0,u.YP)((()=>p.value),(e=>{if(f.value){const t=[];for(const n of f.value){const a=n.topics.filter((t=>("select"===n.action||"preedit"===n.action)&&e.some((e=>e.type===t.type&&e.id===t.id))));t.push({...n,topicsForceHideInformation:a})}d.value=t,setTimeout((()=>{if(f.value){const t=f.value.map((t=>({...t,topicsForceShowInformation:e})));d.value=t}}),10)}}),{immediate:!1}),(0,u.YP)((()=>h.value),((e,t)=>{R()(e,t)||(0,o.pk)().setLockedObjects(e)}),{immediate:!1}),(0,u.YP)((()=>[(0,o.nZ)().topicsSelecting.value,(0,o.nZ)().topicsEditing.value,(0,o.nZ)().textInputOngoing.value,w.value]),(([t,n,a,i])=>{n&&n.length>0?e.setLocalStateField("editor",{action:a?"edit":"preedit",topics:n}):i?e.setLocalStateField("editor",{action:"preedit",topics:i}):t?e.setLocalStateField("editor",{action:"select",topics:t}):e.setLocalStateField("editor",{topics:[]})}),{immediate:!1}),(0,u.YP)((()=>v.value),(e=>{(0,r.c)().setEditingCollaborationTopics(e)}),{immediate:!1}),(0,u.YP)((()=>m.value),(e=>{e?i():s()}),{immediate:!1}),(0,u.YP)((()=>[m.value,n.value]),(([t,n])=>{t&&n?e.setLocalStateField("viewport",n):e.setLocalStateField("viewport",void 0)}),{immediate:!1}),(0,u.YP)((()=>(0,r.c)().isConnected),(e=>{e||(l.value=[],c.value=[],d.value=[],p.value=[],m.value=!1,(0,o.nZ)().setCollaborativeStatus([]),s())}),{immediate:!1})],b=()=>{const t=[],n=[],a=[],i=[];for(const[o,r]of e.getStates()){const{user:e,editor:s,follow:l,viewport:c}=r;e&&t.push({...e,clientId:o}),s&&n.push({...s,clientId:o}),l&&a.push({...l,clientId:o}),c&&i.push({...c,clientId:o})}l.value=t,c.value=n,m.value=a.some((t=>t.followClientId===e.clientID))};return e.on("change",b),C.ZP.fetch(A.rM.GET_SESSION_USER_PROFILE).then((({profile:n})=>{var a;const{fullName:i,user:o,avatarUrl:r}=n,s=Array.from(e.getStates().values()).filter((e=>!!e.user)).map((e=>e.user)),l=s.map((e=>e.color)),c=null===(a=s.find((t=>t.clientId===e.clientID)))||void 0===a?void 0:a.color;e.setLocalStateField("user",{name:i||t("Anonymous"),xmindId:o,avatarUrl:r,color:c||B(l)})})),()=>{(0,o.nZ)().setCollaborativeStatus([]),s(),e.off("change",b),g.forEach((e=>e()))}},B=e=>{const t=D.filter((t=>!e.includes(t))),n=t.length>0?t:D;return n[Math.floor(Math.random()*n.length)]},$=(e,t)=>{var n,a,i;const{pointerTarget:o,selection:r,editSession:s}=e||{};return("topic"!==(null==o?void 0:o.kind)||"topics"===(null==r?void 0:r.kind)&&(null===(n=null==r?void 0:r.topics)||void 0===n?void 0:n.includes(null==o?void 0:o.id)))&&("relationship"!==(null==o?void 0:o.kind)||"relationships"===(null==r?void 0:r.kind)&&(null===(a=null==r?void 0:r.relationships)||void 0===a?void 0:a.includes(null==o?void 0:o.id)))&&("boundary"!==(null==o?void 0:o.kind)||"boundaries"===(null==r?void 0:r.kind)&&(null===(i=null==r?void 0:r.boundaries)||void 0===i?void 0:i.includes(null==o?void 0:o.id)))?"legend"!==(null==o?void 0:o.kind)&&"legend-item"!==(null==o?void 0:o.kind)||"text-edit"===(null==s?void 0:s.kind)&&"legend-item"===(null==s?void 0:s.source)?[]:[{type:"legend",sheetId:t}]:[{type:null==o?void 0:o.kind,id:null==o?void 0:o.id}]};var j=n(12455);function U(){const e=(0,O.$)();e.isRightbarVisible&&e.updateRightBarPanel({visible:!1}),e.isIconPanelVisible&&e.updateIconPanel({visible:!1}),e.isSearchPanelVisible&&e.updateSearchPanel({visible:!1})}async function W(){const e=(0,T.FU)();await e.reload().then((()=>{(0,o.pk)().changeFile({id:e.fileId,stage:e.stage})})).catch((t=>e.handleOpenError(t)))}const z=(0,i.ZP)("collaboration"),V=e=>{const t=async e=>{const t=JSON.parse(e.payload);switch(z.info(t),t.action){case"invitee-role-changed":!async function(e){var t;if((0,r.c)().isFileOwner)return;if(e.xmindId!==(0,a.c7)().user)return;const n=e.role;if("editor"!==n&&(0,r.c)().isTeamMember&&"editor"===(null===(t=(0,r.c)().cloudFileMeta)||void 0===t?void 0:t.teammateRole))return;if(K({role:n}))return;await Y(n)}(t);break;case"teammate-role-changed":!async function(e){if(!(0,a.c7)().user)return;if((0,r.c)().isFileOwner)return;if(!(0,r.c)().isTeamMember)return;let t=e.role;const n=await G();n&&"editor"!==t&&(t=n);if(K({role:t}))return;await Y(t)}(t);break;case"invitee-removed":!async function(e){if((0,r.c)().isFileOwner)return;if(e.xmindId!==(0,a.c7)().user)return;if((0,r.c)().isTeamMember)return;await J({xmindId:e.xmindId}),await q()}(t);break;case"file-move-to-trash":!async function(e){await X({type:"file-move-to-trash"}),await q()}();break;case"file-metadata-changed":!async function(e){var t,n;if(e.metadata.name)(0,T.FU)().changeTitle(e.metadata.name);else if(e.metadata.accessMode){if((0,r.c)().isFileOwner)return;if((0,r.c)().isTeamMember)return;"private"===e.metadata.accessMode&&(await J({xmindId:null===(t=(0,r.c)().cloudFileMeta)||void 0===t?void 0:t.fileOwner}),await q())}else if(e.metadata.accessRole){if((0,r.c)().isFileOwner)return;let t=e.metadata.accessRole;if("editor"!==t&&(0,r.c)().isTeamMember&&"editor"===(null===(n=(0,r.c)().cloudFileMeta)||void 0===n?void 0:n.teammateRole))return;if((0,a.c7)().user){const e=await G();e&&"editor"!==t&&(t=e)}if(K({role:t}))return;await Y(t)}}(t);break;case"wait-restore-snapshot":!async function(e){(0,r.c)().setIsRestoring(!0),(0,r.c)().setIsConnected(!1),await be().openWaitRestoreSnapshotToast(),await W()}()}};return e.on("stateless",t),()=>{e.off("stateless",t)}};async function X(e){await C.ZP.fetch(A.Fx,{name:"dialog-confirm",parentId:window.id,wait:!0,query:e})}async function J({xmindId:e}){var t,n,a;const i=null===(t=(0,r.c)().cloudFileMeta)||void 0===t?void 0:t.teamId,{isTeammateExists:o}=await C.ZP.fetch(A.rM.HAS_TEAMMATE,{teamId:i,xmindId:e}),s=o?e:null===(a=null===(n=(0,r.c)().cloudFileMeta)||void 0===n?void 0:n.teamMeta)||void 0===a?void 0:a.creator;let l="",c="",d="";if(s){const e=await C.ZP.fetch(A.lf.GET_PROFILE,{xmindId:s});l=e.primaryEmail,c=e.phone}c&&(d=c.slice(0,3)+"****"+c.slice(7)),await X({type:o?"no-longer-available-for-team-owner":"no-longer-available-for-file-owner",fileOwner:l||d})}async function Y(e){var t;if("none"===e)await J({xmindId:null===(t=(0,r.c)().cloudFileMeta)||void 0===t?void 0:t.fileOwner}),await q();else{const t={editor:"role-changed-to-editor",viewer:"role-changed-to-viewer"}[e];await X({type:t}),await W()}}async function q(){var e;await C.ZP.fetch(A.s2,{editors:[null===(e=(0,j.r)())||void 0===e?void 0:e.activeEditorId],forceQuit:!0})}async function G(){try{const{role:e}=await C.ZP.fetch(A.rM.GET_INVITEE_ROLE,{fileId:(0,T.FU)().fileId});return e}catch(e){return null}}function K({role:e}){return e===("readwrite"===(0,r.c)().connectionMode?"editor":"viewer")}const Q=(0,i.ZP)("collaboration"),ee=()=>{const e=(0,u.Fl)((()=>(0,r.c)().editingCollaborationTopics)),t=(0,u.Fl)((()=>(0,o.nZ)().document.value)),n=(0,u.Fl)((()=>[...new Set(e.value.map((e=>{var n,a;const{id:i,type:o}=e;return"topic"===o?null===(n=t.value.query({id:i}))||void 0===n?void 0:n.asTopic().ownerSheet.id:"relationship"===o?null===(a=t.value.query({id:i}))||void 0===a?void 0:a.asRelationship().ownerSheet.id:void 0})).filter(Boolean))].includes((0,o.nZ)().activeSheetId.value))),a=(0,u.Fl)((()=>e.value.some((e=>"legend"===e.type)))),i=(0,u.Fl)((()=>e.value.flatMap((e=>{var n,a,i,o,r,s,l,c,d,u,p,m;const{id:f,type:h}=e;if("topic"===h)return ne(null===(n=t.value.query({id:f}))||void 0===n?void 0:n.asTopic());if("relationship"===h){const e=null===(a=t.value.query({id:f}))||void 0===a?void 0:a.asRelationship(),n=null!==(r=null===(o=null===(i=null==e?void 0:e.source)||void 0===i?void 0:i.asBoundary())||void 0===o?void 0:o.parentTopic)&&void 0!==r?r:null===(s=null==e?void 0:e.source)||void 0===s?void 0:s.asTopic(),p=null!==(d=null===(c=null===(l=null==e?void 0:e.target)||void 0===l?void 0:l.asBoundary())||void 0===c?void 0:c.parentTopic)&&void 0!==d?d:null===(u=null==e?void 0:e.target)||void 0===u?void 0:u.asTopic();return[...ne(n),...ne(p)]}return"boundary"===h?ne(null===(m=null===(p=t.value.query({id:f}))||void 0===p?void 0:p.asBoundary())||void 0===m?void 0:m.parentTopic):void 0})).some((e=>{var t;return null===(t=(0,o.nZ)().selection.value)||void 0===t?void 0:t.modelIds.includes(e)})))),s=(0,u.Fl)((()=>e.value.map((e=>{var n,a,i,o,r,s,l,c,d,u,p,m,f,h;const{id:v,type:w}=e;if("relationship"===w){const e=null===(n=t.value.query({id:v}))||void 0===n?void 0:n.asRelationship();if(!e)return null;return{relatedTopicIds:[null!==(o=null===(i=null===(a=null==e?void 0:e.source)||void 0===a?void 0:a.asBoundary())||void 0===i?void 0:i.id)&&void 0!==o?o:null===(s=null===(r=null==e?void 0:e.source)||void 0===r?void 0:r.asTopic())||void 0===s?void 0:s.id,null!==(d=null===(c=null===(l=null==e?void 0:e.target)||void 0===l?void 0:l.asBoundary())||void 0===c?void 0:c.id)&&void 0!==d?d:null===(p=null===(u=null==e?void 0:e.target)||void 0===u?void 0:u.asTopic())||void 0===p?void 0:p.id],relatedTopicType:"Relationship"}}if("boundary"===w){const e=[],n=null===(m=t.value.query({id:v}))||void 0===m?void 0:m.asBoundary();if(!n)return null;for(let a=n.rangeStart;a<=n.rangeEnd;a++){const i=n.parentTopic.children[a].id;i&&e.push(i,...ae(t.value,i))}return e.push(...ie(n)),{relatedTopicIds:e,relatedTopicType:"Boundary"}}if("topic"===w){const e=[],n=null===(f=t.value.query({id:v}))||void 0===f?void 0:f.asTopic();if("callout"===(null==n?void 0:n.topicType))return{relatedTopicIds:[n.parentTopic.id],relatedTopicType:"Callout"};const a=null===(h=t.value.query({id:v}))||void 0===h?void 0:h.asSummary();if(!a)return null;for(let n=a.rangeStart;n<=a.rangeEnd;n++){const i=a.parentTopic.children[n].id;i&&e.push(i,...ae(t.value,i))}return e.push(...ie(a)),{relatedTopicIds:e,relatedTopicType:"Summary"}}return null})).filter(Boolean).find((e=>e.relatedTopicIds.some((e=>{var t;return null===(t=(0,o.nZ)().selection.value)||void 0===t?void 0:t.modelIds.includes(e)})))))),l=(0,u.Fl)((()=>!!s.value)),c=(0,u.Fl)((()=>{var e;return(null===(e=s.value)||void 0===e?void 0:e.relatedTopicType)||""}));return{checkLocked:(e,{withNotification:t}={withNotification:!0})=>{if(!(0,T.FU)().source.startsWith("cloud://"))return!1;let o=!1,r="",s="";switch(e){case"mutateProperty:globalFontFamily":case"mutateProperty:autoBalancedMapEnabled":case"mutateProperty:compactLayoutEnabled":case"mutateProperty:justifyTopicAlignmentEnabled":case"mutateProperty:mainBranchFreePositioningEnabled":case"mutateProperty:floatingTopicFreePositioningEnabled":case"mutateProperty:topicOverlappingEnabled":case"mutate:changeSkeletonTheme":case"mutate:updateStyle":case"mutate:updateStyleToSameLevel":case"mutateEditor:deleteSheet":o=n.value;break;case"mutate:removeMarker":o=a.value;break;case"mutateProperty:majorStructureClass":case"mutateProperty:minorStructureClass":case"mutate:foldBranch":case"mutate:foldAllDescendantBranches":o=i.value;break;case"mutate:delete":case"mutate:deleteTopicNodeOnly":case"cut":i.value&&(o=!0),l.value&&(o=!0,r=te(),s=c.value)}return o&&t&&be().openLockedActionToast({actionName:e,targetTopicType:r,relatedTopicType:s}),o}}},te=()=>{var e;const t=null===(e=(0,o.nZ)().selection.value)||void 0===e?void 0:e.type;return t&&{topic:"Topic",boundary:"Boundary"}[t]},ne=e=>{const t=[];let n=e;for(;n;)t.push(n.id),n=n.parentTopic;return t},ae=(e,t)=>{var n;const a=[],i=null===(n=e.query({id:t}))||void 0===n?void 0:n.asTopic();return i?(a.push(...i.children.map((e=>e.id))),a.push(...i.boundaries.map((e=>e.id))),a.push(...i.children.map((e=>e.id)).flatMap((t=>ae(e,t)))),a):a},ie=e=>e.parentTopic.boundaries.filter((t=>t.rangeStart>=e.rangeStart&&t.rangeEnd<=e.rangeEnd)).map((e=>e.id)),oe=()=>{let e=null,t=(e,...t)=>e;const n=t=>{const n=Object.assign({pos:"bottom-center",timeout:3e3},t);null==e||e.$withUIKit((e=>e.toast(n)))},a=()=>null==e?void 0:e.$withUIKit((e=>e.toast.closeAll()));return{initNotification:(n,a)=>{e=n,t=a},openUploadAttachmentFailedToast:()=>{n({type:"error",message:t("Failed to upload attachment. Please try again later."),timeout:1e4})},openConnectionRestoredToast:()=>{a(),n({type:"success",message:t("Connection restored.")})},openConnectionOfflineToast:()=>n({type:"loading",message:t("You're offline. Reconnecting..."),timeout:null}),openUploadSuccessToast:()=>n({type:"success",message:t("Upload Complete")}),openUploadFailedToast:()=>n({type:"error",message:t("Failed to upload. Please check your network settings and try again later.")}),openUploadFailedStorageLimitToast:()=>n({type:"error",message:t("Your storage limit has been reached.")}),openUploadFailedNoPermissionToast:()=>n({type:"error",message:t("You have left/been removed from the team.")}),openSendInvitationByEmailToast:()=>n({type:"success",message:t("Invitation sent")}),openSendInvitationByEmailOfCNToast:()=>n({type:"success",message:t("Invitation sent, and the link has been copied. Share it to start collaborating!")}),openFetchStaticShareFileSuccessToast:()=>n({type:"info",message:t("This is a static shared map. Refresh to see updates.")}),openFetchStaticShareFileFailedToast:()=>n({type:"error",message:t("Failed to refresh. Please try again later.")}),openRefreshStaticShareFileSuccessToast:()=>n({type:"success",message:t("Map updated successfully."),timeout:1500}),openLockedActionToast:({actionName:e,targetTopicType:a,relatedTopicType:i})=>{let o=t("$$",re[e]);if(a&&i)switch(e){case"mutate:delete":case"mutate:deleteTopicNodeOnly":o=t("$1 can't be deleted while related $2 is being edited by other people.",t("$$",a),t("$$",i));break;case"cut":o=t("$1 can't be cut while related $2 is being edited by other people.",t("$$",a),t("$$",i))}o&&n({type:"warning",message:o,timeout:5e3})},openWaitRestoreSnapshotToast:async()=>{const n=new Promise((n=>{const a="wait-restore-snapshot";null==e||e.$withUIKit((async e=>{e.toast({group:a,type:"loading",pos:"bottom-center",message:t("The map will change in $1 s...","5")});for(let n=4;n>=1;n--)await(0,S._v)(1e3),e.toast.updateMessage({group:a,message:t("The map will change in $1 s...",String(n))});e.toast.closeAll({group:a}),n(null)}))}));await Promise.all([n,(0,S._v)(5e3)])},openRestoredSnapshotToast:()=>{n({type:"success",message:t("The previous version has been restored.")})},openAutoDisconnectToast:()=>{a(),n({type:"warning",message:t("Youâ€™re temporarily disconnected due to inactivity."),timeout:null,btn:`<button class="vk-button-link" style="margin-left: 16px;" focustrigger="cannotGetFocusByMouse">${t("Reconnect")}</button>`,btnClick:()=>{a(),W()}})},openInviteLinkCopiedToast:()=>{n({type:"success",message:t("Invite link copied.")})},openReportSuccessToast:()=>{n({type:"success",message:t("Your report has been submitted. We will review it as soon as possible.")})},openReportRepeatedlyToast:()=>{n({type:"error",message:t("Your report has been successfully submitted. We will review it as soon as possible. Please avoid submitting duplicates.")})},openFileDuplicatedToast:()=>{n({type:"success",message:t("File Duplicated.")})},openRequestExceptionToast:()=>n({type:"error",message:t("Request exception. Please try again later.")})}},re={"mutateProperty:globalFontFamily":(0,S.WZ)("Global font can't be changed while child topic is being edited by other people."),"mutateProperty:autoBalancedMapEnabled":(0,S.WZ)("Map style can't be changed while child topic is being edited by other people."),"mutateProperty:compactLayoutEnabled":(0,S.WZ)("Map style can't be changed while child topic is being edited by other people."),"mutateProperty:justifyTopicAlignmentEnabled":(0,S.WZ)("Map style can't be changed while child topic is being edited by other people."),"mutateProperty:mainBranchFreePositioningEnabled":(0,S.WZ)("Advanced layout can't be changed while child topic is being edited by other people."),"mutateProperty:floatingTopicFreePositioningEnabled":(0,S.WZ)("Advanced layout can't be changed while child topic is being edited by other people."),"mutateProperty:topicOverlappingEnabled":(0,S.WZ)("Advanced layout can't be changed while child topic is being edited by other people."),"mutate:changeSkeletonTheme":(0,S.WZ)("Skeleton can't be changed while child topic is being edited by other people."),"mutate:updateStyle":(0,S.WZ)("The map can't be updated while topics are being edited by other people."),"mutate:updateStyleToSameLevel":(0,S.WZ)("The map can't be updated while topics are being edited by other people."),"mutateEditor:deleteSheet":(0,S.WZ)("Sheets can't be deleted while any of their child topics are being edited by other people."),"mutate:removeMarker":(0,S.WZ)("Markers can't be deleted while the legend is being edited by other people."),"mutateProperty:majorStructureClass":(0,S.WZ)("Structure can't be changed while child topic is being edited by other people."),"mutateProperty:minorStructureClass":(0,S.WZ)("Structure can't be changed while child topic is being edited by other people."),"mutate:foldBranch":(0,S.WZ)("Subtopics can't be folded while child topics are being edited by other people."),"mutate:foldAllDescendantBranches":(0,S.WZ)("All sub-branches can't be folded while child topics are being edited by other people."),"mutate:delete":(0,S.WZ)("Parent topics can't be deleted while any of their child topics are being edited by other people."),"mutate:deleteTopicNodeOnly":(0,S.WZ)("Parent topics can't be deleted while any of their child topics are being edited by other people."),cut:(0,S.WZ)("Parent topics can't be cut while any of their child topics are being edited by other people.")},se=(0,i.ZP)("collaboration"),le=()=>{let e=[];return{fetchStaticShareFile:async({fileId:e,password:t})=>{const n=await C.ZP.fetch(A.rM.GET_SHARED_CONTENTJSON,{fileId:e,password:t}),a=await C.ZP.fetch(A.rM.GET_SHARED_METADATAJSON,{fileId:e});return(0,r.c)().setConnectionMode("readonly"),(0,o.nZ)().changeEditorMode("collaborative-viewer-with-fold"),await o.HG.deserializeDocument({content:JSON.parse(n),metadata:JSON.parse(a)})},...F(),...ee(),...oe(),connect:async({fileId:t,password:n})=>{const a=await d().connect({type:"doc",fileId:t,password:n});(0,r.c)().setIsConnected(!0);const i=M(a,t),l=await i.start(),c=H(a.awareness),p=V(a),m=((e,t)=>{const n="read-write"===e.authorizedScope?"readwrite":"readonly",a="readwrite"===n?"collaborative-editor":"collaborative-viewer";Q.info("connection",n,`doc.${t}`),(0,r.c)().setConnectionMode(n),(0,o.nZ)().changeEditorMode(a);const i=()=>{Q.info("network online",t);const n=e.status===s.X0.Connected;(0,r.c)().setIsConnected(n)},l=()=>{Q.info("network offline",t),(0,r.c)().setIsConnected(!1)},c=({status:e})=>{(0,r.c)().isRestoring||(e!==s.X0.Disconnected&&navigator.onLine?e===s.X0.Connected&&navigator.onLine&&(Q.info("connection status connected",t),(0,r.c)().setIsConnected(!0)):(Q.info("connection status disconnected",t),(0,r.c)().setIsConnected(!1)))},d=(0,u.YP)((()=>(0,r.c)().isConnected),(e=>{e?((0,r.c)().isRestoring||be().openConnectionRestoredToast(),(0,o.nZ)().changeEditorMode(a)):(U(),(0,r.c)().isRestoring||be().openConnectionOfflineToast(),(0,o.nZ)().changeEditorMode("collaborative-viewer"))}),{immediate:!1});return window.addEventListener("online",i),window.addEventListener("offline",l),e.on("status",c),()=>{window.removeEventListener("online",i),window.removeEventListener("offline",l),e.off("status",c),d()}})(a,t),f=w(a);return e.push((()=>{se.info("off connect",`doc.${t}`),m(),f(),i.offSync(),c(),p(),a.destroy()})),{content:l}},offConnect:()=>{e.forEach((e=>e())),e=[]}}},ce=(()=>{const e=Symbol("default-doc-client"),t=new Map;return()=>{if(t.has(e))return t.get(e);const n=le();return t.set(e,n),n}})(),de={width:35,height:28};function ue(e){var t;const n=null!==(t=null==e?void 0:e.highResolution)&&void 0!==t&&t,a=`<svg width="${n?88:44}" height="${n?80:40}" viewBox="0 0 44 40" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <g filter="url(#filter0_dd_8872_9349)">\n    <path d="M17.3333 9C13.8355 9 11 11.8355 11 15.3333V24.6667C11 25.9553 12.0447 27 13.3333 27H26.6667C30.1645 27 33 24.1645 33 20.6667V15.3333C33 11.8355 30.1645 9 26.6667 9H17.3333Z" fill="#8F4EF3" stroke="white" stroke-width="2"/>\n    </g>\n    <defs>\n    <filter id="filter0_dd_8872_9349" x="0" y="0" width="44" height="40" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">\n    <feFlood flood-opacity="0" result="BackgroundImageFix"/>\n    <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>\n    <feOffset/>\n    <feGaussianBlur stdDeviation="1"/>\n    <feComposite in2="hardAlpha" operator="out"/>\n    <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.09 0"/>\n    <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_8872_9349"/>\n    <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>\n    <feOffset dy="2"/>\n    <feGaussianBlur stdDeviation="5"/>\n    <feComposite in2="hardAlpha" operator="out"/>\n    <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.2 0"/>\n    <feBlend mode="normal" in2="effect1_dropShadow_8872_9349" result="effect2_dropShadow_8872_9349"/>\n    <feBlend mode="normal" in="SourceGraphic" in2="effect2_dropShadow_8872_9349" result="shape"/>\n    </filter>\n    </defs>\n    </svg>`,i=window.btoa(a);return n?`-webkit-image-set(url('data:image/svg+xml;base64,${i}') 2x) 15 26, auto`:`url('data:image/svg+xml;base64,${i}') 15 26, auto`}function pe(){return`data:image/svg+xml;base64,${window.btoa('<svg width="40" height="32" viewBox="0 0 40 32" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M26 5H10C5.02944 5 1 9.02944 1 14V28C1 29.6569 2.34315 31 4 31H26C30.9706 31 35 26.9706 35 22V14C35 9.02944 30.9706 5 26 5Z" fill="#8F4EF3" stroke="white" stroke-width="2"/>\n    </svg>')}`}const me=(e,t)=>t&&!e.status.resolved&&!e.comments.every((e=>e.readed.map((e=>e.xmindId)).includes(t))),fe=(e,t,{onlyShowCurrSheet:n,showResolvedThreads:a})=>{let i=[...e];return n&&t&&(i=i.filter((e=>e.anchor.sheetId===t))),a||(i=i.filter((e=>!e.status.resolved))),i},he=e=>{let t=null,n=[];const i=async({doc:n})=>{const a=t;if(!a)return;const i={commentThreads:a.commentThreads.filter((e=>e.comments.length>0)).filter((e=>!!n.sheets.some((t=>t.id===e.anchor.sheetId)))).filter((e=>!e.anchor.topicId||!!n.query({id:e.anchor.topicId}))).filter(((e,t,n)=>n.findIndex((t=>t.id===e.id))===t)),settings:a.settings},o=await(0,y.Ih)(a,i,(async e=>({shared:(0,y.PY)(e)})));o&&(0,y.JT)(e.document,o,{fixedSharedDoc:i})},s=b()((()=>{const{shared:n}=y.Hd.fromYdoc(e.document),a=(0,y.gK)(n);t=a,(0,r.c)().setSharedDoc(a)}),300),l=(n,a)=>{a===e?s():(null==a?void 0:a.fixedSharedDoc)?(t=a.fixedSharedDoc,(0,r.c)().setSharedDoc(a.fixedSharedDoc)):null==a||a.local},c=(0,u.YP)((()=>(0,r.c)().sharedDoc),(async n=>{const a=await(0,y.Ih)(t,n,(async e=>({shared:(0,y.PY)(e)})));a&&(0,y.JT)(e.document,a,{local:n})}),{immediate:!1});return{start:async()=>{e.document.on("update",l);const s=await(async e=>{const{shared:t}=y.Hd.fromYdoc(e);return(0,y.gK)(t)})(e.document);t=s,(0,r.c)().setSharedDoc(s);const c=(()=>{(0,o.pk)().setCollborativeCommentThreads([]);const e=(0,u.Fl)((()=>{var e;return(null===(e=(0,r.c)().sharedDoc)||void 0===e?void 0:e.commentThreads)||[]}));(0,o.pk)().setCommentsViewsStyle({creationCursor:{default:ue(),highResolution:ue({highResolution:!0})},commentViewSize:de,newCommentThreadBackgroundImage:pe(),commentThreadBackgroundImage:pe(),unreadCommentThreadBackgroundImage:`data:image/svg+xml;base64,${window.btoa('<svg width="40" height="32" viewBox="0 0 40 32" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M26 5H10C5.02944 5 1 9.02944 1 14V28C1 29.6569 2.34315 31 4 31H26C30.9706 31 35 26.9706 35 22V14C35 9.02944 30.9706 5 26 5Z" fill="#8F4EF3" stroke="white" stroke-width="2"/>\n    <circle cx="34" cy="6" r="5" fill="#F44336" stroke="white" stroke-width="2"/>\n    </svg>')}`,resolvedCommentThreadBackgroundImage:`data:image/svg+xml;base64,${window.btoa('<svg width="40" height="32" viewBox="0 0 40 32" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M26 5H10C5.02944 5 1 9.02944 1 14V28C1 29.6569 2.34315 31 4 31H26C30.9706 31 35 26.9706 35 22V14C35 9.02944 30.9706 5 26 5Z" fill="#8F4EF3" stroke="white" stroke-width="2"/>\n    <path d="M13 18.2105L17.0909 22L23 14" stroke="white" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>\n    </svg>')}`,unreadResolvedCommentThreadBackgroundImage:`data:image/svg+xml;base64,${window.btoa('<svg width="40" height="32" viewBox="0 0 40 32" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M26 5H10C5.02944 5 1 9.02944 1 14V28C1 29.6569 2.34315 31 4 31H26C30.9706 31 35 26.9706 35 22V14C35 9.02944 30.9706 5 26 5Z" fill="#8F4EF3" stroke="white" stroke-width="2"/>\n    <path d="M13 18.2105L17.0909 22L23 14" stroke="white" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>\n    <circle cx="34" cy="6" r="5" fill="#F44336" stroke="white" stroke-width="2"/>\n  </svg>')}`});const t=[(0,u.YP)((()=>[e.value,(0,o.nZ)().activeSheetId.value,(0,o.nZ)().isInBranchOnly.value]),(([e,t,n])=>{if(n)return void(0,o.pk)().setCollborativeCommentThreads([]);const i=fe(e,t,{onlyShowCurrSheet:!0,showResolvedThreads:!1}).map((e=>({id:e.id,parentTopicId:e.anchor.topicId,position:e.anchor.position,unread:me(e,(0,a.c7)().user),resolved:!!e.status.resolved,commentsCount:e.comments.length}))).filter((e=>e.commentsCount>0));(0,o.pk)().setCollborativeCommentThreads(i)}),{immediate:!0}),(0,u.YP)((()=>(0,o.nZ)().activeCommentThreadId.value),(e=>{e&&(0,r.c)().setLastActiveCommentThreadId(e)}),{immediate:!1})];return()=>{t.forEach((e=>e()))}})();return n.push((()=>{c()})),{fixSharedDoc:i}},offSync:()=>{e.document.off("update",l),c(),n.forEach((e=>e())),n=[]}}},ve=(0,i.ZP)("collaboration"),we=(()=>{const e=Symbol("default-shared-client"),t=new Map;return()=>{if(t.has(e))return t.get(e);const n=(()=>{let e=[];return{connect:async({fileId:t,password:n})=>{const a=await d().connect({type:"shared",fileId:t,password:n}),i=he(a),{fixSharedDoc:o}=await i.start(),r=w(a);return e.push((()=>{ve.info("off connect",`shared.${t}`),r(),i.offSync(),a.destroy()})),{fixSharedDoc:o}},offConnect:()=>{e.forEach((e=>e())),e=[]}}})();return t.set(e,n),n}})(),ye=(0,i.ZP)("collaboration"),ge=()=>({...ce(),connect:async({fileId:e,password:t})=>{ye.info("connect",e);const n="cn"===(0,a.qr)().serviceRegion,{content:i}=await ce().connect({fileId:e,password:t});if(!n){const{fixSharedDoc:n}=await we().connect({fileId:e,password:t});await n({doc:i})}return{content:i}},offConnect:()=>{const e="cn"===(0,a.qr)().serviceRegion;U(),ce().offConnect(),e||we().offConnect(),(0,r.c)().cleanCollaboration(),(0,o.nZ)().changeEditorMode("collaborative-viewer")}}),be=(()=>{const e=Symbol("default-collaboration"),t=new Map;return()=>{if(t.has(e))return t.get(e);const n=ge();return t.set(e,n),n}})()},64805:(e,t,n)=>{n.d(t,{fQ:()=>p,zZ:()=>l,M$:()=>m,ll:()=>d,QN:()=>s,ML:()=>u,JK:()=>r,qz:()=>i,It:()=>a,x9:()=>c});var a,i,o=n(96829);!function(e){e.TOPIC="TOPIC",e.NOTE="NOTE",e.TAG="TAG"}(a||(a={})),function(e){e.NOTE="note",e.LABEL="label",e.MARKER="marker",e.TASK="task"}(i||(i={}));const r=[{key:a.TOPIC,label:(0,o.WZ)("Outline"),tooltip:(0,o.WZ)("View topic outline and search the map.")},{key:a.NOTE,label:(0,o.WZ)("Notes"),tooltip:(0,o.WZ)("View and search all the notes.")},{key:a.TAG,label:(0,o.WZ)("Tags"),tooltip:(0,o.WZ)("Highlight topics by marker, label and task.")}];var s,l,c,d,u;!function(e){e.FORMAT="FORMAT",e.THEME="THEME",e.IMAGE="IMAGE"}(s||(s={})),function(e){e.TOPIC="TOPIC",e.SLIDE="SLIDE"}(l||(l={})),function(e){e.MAP="MAP"}(c||(c={})),function(e){e.MARKER="MARKER",e.STICKER="STICKER",e.ILLUSTRATION="ILLUSTRATION"}(d||(d={})),function(e){e.CUSTOM_THEME="CUSTOM_THEME",e.DEFAULT="NONE"}(u||(u={}));const p=[{key:l.TOPIC,category:s.FORMAT,label:(0,o.WZ)("Style")},{key:l.SLIDE,category:s.FORMAT,label:(0,o.WZ)("Pitch")},{key:c.MAP,category:s.THEME,label:(0,o.WZ)("Map")},{key:d.MARKER,category:s.IMAGE,icon:"marker",tooltip:(0,o.WZ)("Marker")},{key:d.STICKER,category:s.IMAGE,icon:"sticker",tooltip:(0,o.WZ)("Sticker")},{key:d.ILLUSTRATION,category:s.IMAGE,icon:"illustration",tooltip:(0,o.WZ)("Illustration")}],m=[{key:d.MARKER,label:(0,o.WZ)("Marker"),icon:"marker"},{key:d.STICKER,label:(0,o.WZ)("Sticker"),icon:"sticker"},{key:d.ILLUSTRATION,label:(0,o.WZ)("Illustration"),icon:"illustration"}]},84374:(e,t,n)=>{n.d(t,{CX:()=>b.CX,HG:()=>b.HG,KR:()=>b.KR,OE:()=>b.OE,QS:()=>b.QS,ZQ:()=>b.ZQ,aX:()=>b.aX,h0:()=>b.h0,nZ:()=>b.nZ,o9:()=>b.o9,pk:()=>b.pk,sp:()=>b.sp,viewerKit:()=>b.q_});var a=n(52517),i=n(71017),o=n.n(i),r=n(72298),s=n(94593),l=n(13893),c=n.n(l),d=n(7104),u=n(5893),p=n(90435),m=n(54856),f=n(87141),h=n(63111),v=n(89019),w=n(46016),y=n(12455),g=n(69931),b=n(18653);const{getGlobalConfig:I,globalConfigSetup:S}=a.i;async function T(e){if((0,y.A)().contexts["collaboration.isFromCloud"]&&"dndLargeFile"===e)return await p.ZP.fetch(m.Fx,{name:"dialog-confirm",parentId:window.id,wait:!0,query:{type:"upload-limit-exceeded-of-attachment"}}),!0;return!await p.ZP.fetch(m.Gy,{name:e,channel:(0,m.gk)(window.editorId)})}!function(){const e={translatesCtrlClickAsContextMenu:!1,translatesCtrlEnterAsInsertingLineBreak:!0,translatesCtrlZAsUndo:!0,translatesPointerTypePenAsPointerTypeMouse:!1,shouldShiftKeyFlipScrollDirection:!0},t=(0,u.u3)(o().join((0,d.bY)(),"/static/snowbird/resource/"));a.i.globalConfigSetup({pathToUrl:u.u3,platformMapper:t=>e[t],guidedPayment:T,featureIsCurrentlyRestricted:e=>!(0,y.A)().contexts["activation.isValid"]&&!h.nd&&(p.ZP.fetch(m.Gy,{name:e,channel:(0,m.gk)(window.editorId)}),!0),assetsBaseURL:t,clipboard:{read:async function(){const e=(0,y.A)().contexts["collaboration.isFromCloud"],t=await r.clipboard.readText("clipboard"),n=await r.clipboard.readHTML("clipboard"),a=await async function(){let e=[];if(r.clipboard.has("CF_HDROP")){const t=r.clipboard.readBuffer("CF_HDROP").toString("ucs2")||"";let n=[...t].filter(((e,n)=>0!==t.charCodeAt(n))).join("").replace(/\\/g,"\\");const a=n.match(/[a-zA-Z]:\\/);if(a){const t=n.indexOf(a[0]);0!==t&&(n=n.substring(t)),e=n.split(a[0]).filter((e=>e)).map((e=>a+e))}}else e=[r.clipboard.readBuffer("FileNameW").toString("ucs2").replace(RegExp(String.fromCharCode(0),"g"),"")].filter((e=>e));const t=[];for(const n of e){const e=o().basename(n),a=c().getType(o().extname(n).substring(1));try{const i=await s.Z.readFile(n);t.push(new File([new Blob([i.buffer],{type:a})],e,{type:a}))}catch(e){}}if(0===t.length){const e=r.clipboard.readImage();e.isEmpty()||t.push(new File([new Blob([e.toPNG().buffer],{type:"image/png"})],"Untitled.png",{type:"image/png"}))}return t}();if(a.some((e=>!e.type.startsWith("image")))){const t=a.some((e=>!e.type.startsWith("image")&&e.size>h.jX));if(e&&t)return await p.ZP.fetch(m.Fx,{name:"dialog-confirm",parentId:window.id,wait:!0,query:{type:"upload-limit-exceeded-of-attachment"}}),{text:null,html:null};if(await T("insertAttachment"))return{text:null,html:null}}if(a.some((e=>e.type.startsWith("image")))){const t=a.some((e=>e.type.startsWith("image")&&e.size>h.i3));if(e&&t)return await p.ZP.fetch(m.Fx,{name:"dialog-confirm",parentId:window.id,wait:!0,query:{type:"upload-limit-exceeded-of-image"}}),{text:null,html:null}}return{text:t,html:n,files:a}},write:async e=>{var t;const n=await(null===(t=e.image)||void 0===t?void 0:t.arrayBuffer()),a=n?r.nativeImage.createFromBuffer(Buffer.from(n)):null;return r.clipboard.write({text:e.text,html:e.html,image:a},"clipboard")}},collaborativeActionHandler:{handleInsertCommentThreadAction:e=>{if(!("cn"===(0,f.qr)().serviceRegion))return{commentThreadId:""}},handleOpenCommentThreadAction:({threadId:e})=>{"cn"===(0,f.qr)().serviceRegion||((0,v.c)().setLastActiveCommentThreadId(e),(0,w.$)().setPopoverEditorVisible("comment"))},handleMoveCommentThreadAction:e=>{(0,f.qr)().serviceRegion}},builtinImageUrls:{[a.v.BuiltinImageSource.ImageLoadingPlaceholder]:(0,g.ju)("/static/assets/images/loading.svg")}})}()},89019:(e,t,n)=>{n.d(t,{c:()=>r});var a=n(2954),i=n(77412),o=n(87141);const r=(0,i.Q_)("collaboration",(()=>{const e=(0,a.iH)(!1),t=(0,a.iH)(!1),n=(0,a.iH)(null),i=(0,a.iH)(null),r=(0,a.Fl)((()=>{var e,t;return!(!(null===(e=i.value)||void 0===e?void 0:e.teamId)||(null===(t=i.value)||void 0===t?void 0:t.teamId)!==(0,o.c7)().user)})),s=(0,a.Fl)((()=>{var e;return!(!(null===(e=i.value)||void 0===e?void 0:e.fileOwner)||i.value.fileOwner!==(0,o.c7)().user)})),l=(0,a.Fl)((()=>{var e;return!!(null===(e=i.value)||void 0===e?void 0:e.teammatePayload)})),c=(0,a.Fl)((()=>{var e,t;return"owner"===(null===(t=null===(e=i.value)||void 0===e?void 0:e.teammatePayload)||void 0===t?void 0:t.role)})),d=(0,a.iH)([]),u=(0,a.iH)([]),p=(0,a.iH)(""),m=(0,a.iH)(null),f=(0,a.iH)(""),h=(0,a.iH)(null);return{isConnected:e,setIsConnected:t=>{e.value=t},isRestoring:t,setIsRestoring:e=>{t.value=e},cloudFileMeta:i,changeCloudFileMeta:e=>{i.value=e},isMyWorks:r,isFileOwner:s,isTeamMember:l,isTeamOwner:c,connectionMode:n,setConnectionMode:e=>{n.value=e},onlineCollaborators:d,setOnlineCollaborators:e=>{d.value=e},editingCollaborationTopics:u,setEditingCollaborationTopics:e=>{u.value=e},staticShareFilePassword:p,changeStaticShareFilePassword:e=>{p.value=e},sharedDoc:m,setSharedDoc:e=>{m.value=e},lastActiveCommentThreadId:f,setLastActiveCommentThreadId:e=>{f.value=e},sourceFrom:h,changeSourceFrom:e=>{h.value=e},cleanCollaboration:()=>{e.value=!1,t.value=!1,i.value=null,n.value="readonly",d.value=[],u.value=[],p.value="",m.value=null,f.value="",h.value=null}}}))},27049:(e,t,n)=>{n.d(t,{E:()=>o});var a=n(77412),i=n(2954);const o=(0,a.Q_)("editor",(()=>{const e=(0,i.iH)(!1),t=(0,i.iH)(!1),n=(0,i.iH)(!1),a=(0,i.iH)(),o=(0,i.iH)("snowbrush"),r=(0,i.iH)(!0),s=(0,i.iH)(!1),l=(0,i.iH)(!1),c=(0,i.iH)(!1),d=(0,i.iH)(!1),u=(0,i.iH)(!1),p=(0,i.iH)({}),m=(0,i.iH)({}),f=(0,i.iH)(),h=(0,i.iH)(!0),v=(0,i.iH)(""),w=(0,i.iH)(!1),y=(0,i.iH)(!1),g=(0,i.iH)(""),b=(0,i.iH)(""),I=(0,i.iH)(!0),S=(0,i.iH)(!1);return{mindmapCreated:t,updateMindMapCreated:e=>t.value=e,audioBarMode:v,audioAutoplay:w,audioTopicId:g,audioRecording:y,sheetRendering:n,sheetRenderingStartAt:a,isEditorVisible:e,isAllowInsertHyperLink:h,sheetStatuses:p,outlinerSheetStatuses:m,suggestedDefaultZoomScale:f,isSheetBarVisible:r,changeSheetBarVisible:e=>r.value=e,isTopicCountLabelVisible:s,changeTopicCountVisible:e=>{s.value=e},isBeginnerDialogVisible:c,isTopicLinkDialogShowing:d,changeIsTopicLinkDialogShowing:e=>{d.value=e},changeBeginnerDialogVisible:e=>c.value=e,isBeginnerModeVisible:l,changeBeginnerModeVisible:e=>l.value=e,isTooltipsVisible:u,changeTooltipsVisible:e=>u.value=e,selectedMarkerId:b,updateSelectedMarkerId:e=>{b.value=e},getZoomScaleForSheet:e=>{const t=p.value[e];return t?t.suggestedZoomScale||f.value||t.zoomScale:null},getOutlinerZoomScaleForSheet:e=>{const t=m.value[e];return t?t.suggestedZoomScale||f.value||t.zoomScale:100},updateAudioBarMode:e=>{void 0!==e.audioBarMode&&(v.value=e.audioBarMode),void 0!==e.audioAutoplay&&(w.value=e.audioAutoplay),void 0!==e.audioTopicId&&(g.value=e.audioTopicId)},updateEditorVisible:t=>{e.value=t},updateAudioRecording:e=>{y.value=e},updateSheetRendering:({sheetRendering:e,sheetRenderingStartAt:t})=>{n.value=e,a.value=t},updateSheetRenderingInMode:({sheetRenderingInMode:e})=>{o.value=e},updateSheetStatus:({id:e,inited:t,suggestedZoomScale:n,zoomScale:a=null})=>{if(void 0===e)return;const i={};t&&(i.inited=t),null!==a&&(f.value?i.suggestedZoomScale=a:i.zoomScale=a),void 0!==n&&(i.suggestedZoomScale=n,f.value=n),p.value={...p.value,[e]:i}},updateOutlinerSheetStatus:({id:e,zoomScale:t=null})=>{if(void 0===e)return;const n={};e in m.value||(n.zoomScale=100),null!==t&&(n.zoomScale=t),m.value={...m.value,[e]:n}},updateAllowInsertHyperLink:e=>{h.value=e},isShapeShowMoreBtnVisible:I,updateShapeShowMoreBtnVisible:e=>{I.value=e},isResizeEditorSync:S,updateIsResizeEditorSync:e=>{S.value=e}}}))},89411:(e,t,n)=>{n.d(t,{zw:()=>P.zw,FU:()=>ve});var a=n(77412),i=n(2954),o=n(71017),r=n.n(o),s=n(57310),l=n.n(s),c=n(7104),d=n(69931),u=n(96829),p=n(5893),m=n(54856),f=n(63111),h=n(90435),v=n(94593),w=n(23352),y=n(84374),g=n(87141),b=n(63477),I=n.n(b),S=n(55733),T=n.n(S),E=n(13382),F=n(18621),P=n(87244);const A=(0,w.ZP)("from-temp:"),C={protocol:"file",async open(e,t){const n=(0,p.iZ)(e);return{...await(0,P.vP)(n,t.stage,t.passwordHelper),fileId:t.editorId}},getSaveAsHandler:e=>({name:"Save on Computer",type:"local",prompt:async()=>{const t=await(0,E.ZZ)({suggestPath:{suggestedName:e.document.sheets[0].rootTopic.title},filters:[{name:e.$T("Xmind Workbook"),extensions:["xmind"]}]});return t?(0,p.u3)(t):null}}),async save(e){const{password:t,passwordHint:n,thumbnailGenerator:a,makeDocumentCache:i}=e,o=(0,p.iZ)(e.source),r=await a.generateThumbnail(e.document.sheets[0].id);return await(0,P.gv)(e.document,o,e.stage,{password:t,passwordHint:n,thumbnail:r}),async function(e){if(!v.Z.existsSync(e))throw new Error("ensureFileFine: File not exist after saved file!");const t=await v.Z.readFile(e),n=await T().loadAsync(t);if(!n||!n.files)throw new Error("ensureFileFine: zip content is empty.")}(o).then((()=>{i()})).catch((e=>{A.error("Ensure file fine error: ",(0,u.SC)(e))})),{thumbnail:r,fileId:e.editorId}},canSave(e){const t=(0,p.iZ)(e.source);if(v.Z.existsSync(t))try{v.Z.accessSync(t,v.Z.constants.R_OK|v.Z.constants.W_OK)}catch(e){return!1}return!!t},async handleOpenError(e,t){const{$T:n,source:a,editorId:i}=e;if("ENOENT"===t.code)return await(0,E.N0)({type:"warning",title:"Xmind",message:n("The file doesn't exist."),buttons:[n("OK")],defaultId:0,cancelId:0,noLink:!0}),{recovered:!1,prompted:!0};if("TO_CLOSE_DOCUMENT"===t.code)return h.ZP.fetch(m.s2,{editors:[i],forceQuit:!0}),{recovered:!0,prompted:!1};const o=(0,g.yj)().fileCacheItem((0,p.iZ)(a));if(o){const[e]=await(0,E.N0)({type:"info",message:n("Failed to Open"),detail:n("Your xmind file is corrupted, or you lack the necessary permissions to open it. You can try to open the previous version of this file."),buttons:[n("Open"),n("Cancel")],defaultId:0,cancelId:1});if(0===e){const e=o.fileCacheId,t=o.filename;let n=o.firstSnapshotId;if(o.snapshots.length>0){n=o.snapshots.pop().id}(0,F.L9)({eventCategory:"FileCache",eventAction:"messageBoxRestoreSnapshot"});const a=r().join((0,c.L2)(),e,n+".xmind");return h.ZP.fetch(m.NF,{source:l().format({protocol:"file-cache",slashes:!0,search:I().stringify({originalName:t,source:a})})}),{recovered:!0,prompted:!0}}return{recovered:!1,prompted:!0}}return{recovered:!1,prompted:!1}},async heartbeatTest(e){const{source:t,title:n,saveAs:a,changeDirty:i,$T:o}=e,r=(0,p.iZ)(t);try{return await v.Z.access(r,v.Z.constants.R_OK),{shouldClose:!1}}catch(e){const r=await(0,E.N0)({type:"warning",title:"Xmind",message:o("This mind map has been deleted from disk. You can delete it now or save as a new xmind file."),buttons:[o("Save As"),o("Delete")],defaultId:0,cancelId:0,noLink:!0});if(Array.isArray(r)&&r.length>0&&0===r[0]){const e=await(0,E.ZZ)({suggestPath:{doc:{source:t,title:n}},filters:[{name:o("Xmind Workbook"),extensions:["xmind"]}]});if(e)return await a((0,p.u3)(e)),{shouldClose:!1}}return i(!1),{shouldClose:!0}}}};var Z=n(67657),k=n(33394),M=n(88495),x=n(86982),L=n(81296),R=n.n(L),O=n(62004),N=n(68769);const D=(0,w.ZP)("from-template"),_={protocol:"new",async open(e,t){var n,a;const i=l().parse(e),{$T:o,editorId:s}=t,d=I().parse(i.query),u=d.template||"default",p=d.title||function(e){const t=e("Untitled"),n=Z.BrowserWindow.getAllWindows().filter((e=>{var t;return e.id!==(null===(t=Z.getCurrentWindow())||void 0===t?void 0:t.id)})),a=new Set;for(const e of n)a.add(e.getTitle());const i=Array.from(a).filter((e=>e===t||e.includes(t)&&2==e.split(" ").length&&Number.isInteger(Number(e.split(" ")[1]))));let o=0;for(const e of i)o=e==t?Math.max(o,1):Math.max(o,Number(e.split(" ")[1]));return 0==o?t:`${t} ${o+1}`}(o),f=d.id,v=d.host,w=d.hash,b=d.groupId,S=d.path,E=d.teamId,F=d.parentFolderId,{language:A}=(0,g.S)();if("default"===u){const e=function({$T:e}={}){return H({$T:e})}({$T:o});let t=await(0,y.OE)(JSON.stringify([e]));return t=(0,P.Jb)(t),t=(0,P.zw)(t),{fileId:s,content:t,fileName:p,isEncrypted:!1}}{let e;if("local"===v)e=r().join((0,c.d6)(),S);else{const t=r().join((0,c.tM)(),`files/${A}/${w}.xmind`);if(R().existsSync(t))e=t;else{if(!window.navigator.onLine)return{fileId:null,needToClose:!0,networkFailure:!0};let n=!1,a=!1;const i=await h.ZP.fetch(m.lf.DOWNLOAD_TEMPLATE_FILE,{id:f,groupId:b,teamId:E&&"undefined"!==E?E:(0,g.Yh)().findUpgradeTeamId(),snowbirdLang:B(A)}).catch((e=>{D.error("Failed to download template file",e),400===e.code?n=!0:a=!0}));if(!i&&a)return{fileId:null,needToClose:!0,networkFailure:!0};if(!i&&n)return{fileId:null,needToClose:!0,verificationFailed:!0};await R().ensureDir(r().dirname(t)),await R().writeFile(t,i),e=t}}const o=await k.Z.read(e),l=await T().loadAsync(o),d=JSON.parse(await l.file("content.json").async("string"));if("local"===v){const e=(0,M.eq)((0,M.LJ)(),B(A)),t=x.J(d,e),n=JSON.stringify(t);l.file("content.json",n)}const u=r().basename(e,".xmind"),y=await l.generateAsync({type:"arraybuffer"}),I=await(0,P.ee)(y,u,t.stage);"content"in I&&(I.content=(0,P.zw)(I.content)),await h.ZP.fetch(m.Pp,{mutations:[{id:g.i0,type:"appendRecentlyTemplates",payload:[f,A]}]});let C=s;try{if("host.xmind.app"===i.hostname&&E&&F&&"fileName"in I){const{teammatePayload:e}=await h.ZP.fetch(m.rM.TEAMMATE_PAYLOAD,{teamId:E}).catch((e=>({teammatePayload:null}))),t="owner"===(null==e?void 0:e.role),i=new Blob([y],{type:"application/xmind"}),o=await(0,O.Y)().uploadFile({file:i,fileName:null!=p?p:I.fileName,parentFolderId:F,teamId:E,isTeamOwner:t,accessMode:"private"});(null===(n=null==o?void 0:o.metadata)||void 0===n?void 0:n.fileId)&&(C=null===(a=null==o?void 0:o.metadata)||void 0===a?void 0:a.fileId)}}catch(e){switch(null==e?void 0:e.code){case N.R.EXCEED_FILES_LIMIT:return{fileId:null,needToClose:!0,exceedFilesLimitFailure:!0,message:e.message};case N.R.STORAGE_LIMIT_FAILURE:return{fileId:null,needToClose:!0,storageLimitFailure:!0};case N.R.NO_PERMISSION_FAILURE:return{fileId:null,needToClose:!0,noPermissionUploadFailure:!0};default:return{fileId:null,needToClose:!0}}}return{...I,fileId:C,fileName:p}}},async handleOpenError(e,t){const{$T:n}=e;return t.code?("VERIFICATION_FAILED"===t.code?(await(0,E.N0)({message:n("Verification Failed"),detail:n("Unable to detect any valid subscription. Please subscribe Xmind Pro and try again."),buttons:[n("OK")]}),h.ZP.fetch(m.Fx,{name:"new"})):"NETWORK_FAILURE"===t.code?(await(0,E.N0)({type:"warning",message:n("Download Failed"),detail:n("Please check your network connection and try again later."),buttons:[n("OK")]}),h.ZP.fetch(m.Fx,{name:"new"})):"STORAGE_LIMIT_FAILURE"===t.code?await h.ZP.fetch(m.Fx,{name:"dialog-confirm",parentId:window.id,wait:!0,query:{type:"upload-limit-exceeded-of-storage"}}):"NO_PERMISSION_UPLOAD"===t.code?await h.ZP.fetch(m.Fx,{name:"dialog-confirm",parentId:window.id,wait:!0,query:{type:"without-permission-to-create"}}):"EXCEED_FILES_LIMIT"===t.code&&await h.ZP.fetch(m.Gy,{name:"action.createMapOfCloud",payload:JSON.parse(t.message)}),{recovered:!1,prompted:!0}):{recovered:!1,prompted:!1}}},H=({$T:e}={})=>({id:(0,u.hb)(),class:"sheet",title:e("Map 1"),topicOverlapping:y.sp.Overlapping,rootTopic:{id:(0,u.hb)(),class:"topic",title:e("Central Topic"),structureClass:"org.xmind.ui.map.clockwise",titleUnedited:!0,children:{attached:[{id:(0,u.hb)(),title:e("Main Topic 1"),titleUnedited:!0},{id:(0,u.hb)(),title:e("Main Topic 2"),titleUnedited:!0},{id:(0,u.hb)(),title:e("Main Topic 3"),titleUnedited:!0},{id:(0,u.hb)(),title:e("Main Topic 4"),titleUnedited:!0}]}}});function B(e){switch(e){case"zh-CN":return M.SQ.ZH_CN;case"en-US":default:return M.SQ.EN_US;case"zh-HK":return M.SQ.ZH_HK;case"zh-TW":return M.SQ.ZH_TW;case"ja-JP":return M.SQ.JA_JP;case"de-DE":return M.SQ.DE_DE;case"fr-FR":return M.SQ.FR_FR;case"es":return M.SQ.ES_ES;case"id":return M.SQ.ID_ID;case"it-IT":return M.SQ.IT_IT;case"ko":return M.SQ.KR_KR;case"pt-PT":return M.SQ.PT_PT;case"ru-RU":return M.SQ.RU_RU;case"th":return M.SQ.TH_TH}}const $={mindmanager:z((e=>Promise.all([n.e(5760),n.e(4446)]).then(n.bind(n,74446)).then((t=>t.importMindManager(e))))),freemind:z((e=>Promise.all([n.e(5760),n.e(4446)]).then(n.bind(n,74446)).then((t=>t.importFreeMind(e))))),lighten:z((e=>Promise.all([n.e(5760),n.e(4446)]).then(n.bind(n,74446)).then((t=>t.importLighten(e))))),mindnode:z((e=>Promise.all([n.e(5760),n.e(4446)]).then(n.bind(n,74446)).then((t=>t.importMindNode(e))))),mindmaster:z((e=>Promise.all([n.e(5760),n.e(4446)]).then(n.bind(n,74446)).then((t=>t.importMindMaster(e))))),markdown:z((e=>Promise.all([n.e(5760),n.e(4446)]).then(n.bind(n,74446)).then((t=>t.importMarkdown(e))))),opml:z((e=>Promise.all([n.e(5760),n.e(4446)]).then(n.bind(n,74446)).then((t=>t.importOPML(e))))),textbundle:z(((e,t)=>Promise.all([n.e(5760),n.e(4446)]).then(n.bind(n,74446)).then((n=>n.importTextBundle(e,t))))),word:z(((e,t)=>Promise.all([n.e(5760),n.e(4446)]).then(n.bind(n,74446)).then((n=>n.importDocx(e,t))))),ithoughts:z(((e,t)=>Promise.all([n.e(5760),n.e(4446)]).then(n.bind(n,74446)).then((n=>n.importMindMap(t,e)))))},j="assets/",U="text.md",W={protocol:"import",async open(e,t){const{stage:n,editorId:a}=t,i=l().parse(e).hostname,o=$[i],s=function(e){const t=l().parse(e,!0).query;let n=t?t.source:"";if(!n)throw new Error(`Invalid file path URL: "${e}"`);n.startsWith("/")&&(n=n.substring(1));return n}(e),c=r().basename(s,r().extname(s)),d=await o(s),u=await(0,P.ee)(d,c,n);return"content"in u&&(u.content=(0,P.Jb)(u.content),u.content=(0,P.zw)(u.content)),{fileId:a,...u,isDirty:!0}}};function z(e){return async t=>{if(".textbundle"===r().extname(t)){const n=await v.Z.readFile(r().join(t,U)),a={};if(v.Z.existsSync(r().join(t,j))){const e=await v.Z.readdir(r().join(t,j));for(const n of e){const e=await v.Z.readFile(r().join(t,j,n));a[n]=e}}return e(n.buffer,a)}if(".docx"===r().extname(t)){const n=await v.Z.readFile(t),a=r().basename(t,r().extname(t));return e(n.buffer,a)}if(".itmz"===r().extname(t)){const n=r().basename(t),a=await v.Z.readFile(t);return e(a.buffer,n)}{const n=await v.Z.readFile(t);return e(n.buffer)}}}async function V(e,t){const{stage:n,editorId:a,passwordHelper:i}=t,o=new URL(e),s=function(e){const t=r().parse(e);return".xmind"===t.ext?t.base:Math.random().toString(36).slice(2)+".xmind"}(o.pathname),l=o.searchParams.get("editor-title");let c;o.searchParams.delete("editor-title");try{c=await h.ZP.fetch(m.lf.FILE_DOWNLOAD,{downloadUrl:o.href,filename:s,cacheId:s})}catch(e){return Promise.reject(new Error("Download file failure, please retry."))}const d=await(0,P.vP)(c,n,i);return l?{...d,fileId:a,fileName:l}:{...d,fileId:a}}const X={protocol:"http",open:V},J={protocol:"https",open:V};const Y={protocol:"file-cache",async open(e,t){const{stage:n,editorId:a,passwordHelper:i}=t,o=function(e){const t="file-cache://";if(e&&e.startsWith(t)){const t=l().parse(e),n=I().parse(t.query);return{filePath:n.source,fileName:n.originalName}}throw new Error("Document source error")}(e),r=await(0,P.vP)(o.filePath,n,i);return"fileName"in r&&(r.fileName=o.fileName),{...r,fileId:a}}};var q=n(89019),G=n(27049),K=n(12455),Q=n(46016),ee=n(80356);const te=(0,w.ZP)("from-cloud"),ne={protocol:"cloud",async open(e,t){var n;const a=null===(n=l().parse(e).pathname)||void 0===n?void 0:n.slice(1),i=I().parse(l().parse(e).query);i.sourceFrom&&(0,q.c)().changeSourceFrom(i.sourceFrom);try{const e=await oe({fileId:a,passwordHelper:t.passwordHelper});return te.info("open",a),{...e,fileId:a}}catch(e){te.error(`open ${a} failed`,e)}},async handleOpenError(e,t){var n;return"PRIVATE_ACCESS_MODE_FAILURE"===t.code?await async function({xmindId:e}){var t,n,a;const i=null===(t=(0,q.c)().cloudFileMeta)||void 0===t?void 0:t.teamId,{isTeammateExists:o}=await h.ZP.fetch(m.rM.HAS_TEAMMATE,{teamId:i,xmindId:e}),r=o?e:null===(a=null===(n=(0,q.c)().cloudFileMeta)||void 0===n?void 0:n.teamMeta)||void 0===a?void 0:a.creator;let s="",l="",c="";if(r){const e=await h.ZP.fetch(m.lf.GET_PROFILE,{xmindId:r});s=e.primaryEmail,l=e.phone}l&&(c=l.slice(0,3)+"****"+l.slice(7));await h.ZP.fetch(m.Fx,{name:"dialog-confirm",parentId:window.id,wait:!0,query:{type:o?"no-longer-available-for-team-owner":"no-longer-available-for-file-owner",fileOwner:s||c}})}({xmindId:null===(n=(0,q.c)().cloudFileMeta)||void 0===n?void 0:n.fileOwner}):"FILE_NOT_EXISTS_FAILURE"===t.code?await h.ZP.fetch(m.Fx,{name:"dialog-confirm",parentId:window.id,wait:!0,query:{type:"file-move-to-trash"}}):"TO_CLOSE_DOCUMENT"===t.code&&await h.ZP.fetch(m.Fx,{name:"dialog-confirm",parentId:window.id,wait:!0,query:{type:"normal-failure"}}),await h.ZP.fetch(m.s2,{editors:[e.editorId],forceQuit:!0}),{recovered:!1,prompted:!0}},async close(e){(0,ee.C)().offConnect()},async beforeReload(e,t){"file"===(null==t?void 0:t.protocolTo)&&await(0,y.KR)(e.document,(async()=>{}),(async t=>{await e.stage.take(t.path)})),(0,ee.C)().offConnect()},reload:async e=>await re(e),getSaveAsHandler:e=>({name:"Save to Cloud",type:"cloud",prompt:async t=>await async function(e,t){if(!t||!t.fileName||!t.teamId)return;const n=t.teamId===(0,g.c7)().user,{teammatePayload:a}=await h.ZP.fetch(m.rM.TEAMMATE_PAYLOAD,{teamId:t.teamId}).catch((e=>({teammatePayload:null}))),i="owner"===(null==a?void 0:a.role),o=await h.ZP.fetch(m.Gy,{name:"action.uploadMultipleSheet",payload:{planType:n?g.k9.PERSONAL:g.k9.TEAM,teamId:t.teamId,isTeamOwner:i,sheetNum:(0,y.nZ)().sheets.value.length}});if(!o)return;try{const n=await e.thumbnailGenerator.generateThumbnail(e.document.sheets[0].id),a=await(0,P.LW)(e.document,e.stage,n),o=new Blob([a],{type:"application/xmind"}),r=new AbortController,s=r.signal,l=new Promise(((e,n)=>{(0,O.Y)().uploadFile({file:o,fileName:t.fileName,parentFolderId:t.teamId,teamId:t.teamId,isTeamOwner:i,accessMode:"private",signal:s}).then((t=>{var a;if((0,K.A)().setUploading(!1),t&&t.metadata||n(),null===(a=null==t?void 0:t.metadata)||void 0===a?void 0:a.fileId){const n=`cloud://host.xmind.app/${t.metadata.fileId}`;e({source:n})}})).catch((e=>n(e)))})),c=new Promise((e=>{(0,K.A)().setUploading(!0),h.ZP.fetch(m.Fx,{name:"dialog-progress",parentId:window.id,wait:!0,overrideSetting:{height:f.Us["dialog-progress"].height+40},query:{type:"uploading",editorId:window.editorId}}).then((t=>e(t.result)))})),d=await Promise.race([l,c]);return(null==d?void 0:d.source)?(await h.ZP.fetch(m.g_,{name:"dialog-progress"}),function(){const e=(0,Q.$)();e.isRightbarVisible&&e.updateRightBarPanel({visible:!1});e.isIconPanelVisible&&e.updateIconPanel({visible:!1});e.isSearchPanelVisible&&e.updateSearchPanel({visible:!1})}(),d.source):(d&&!d.stopUploading||r.abort(),"")}catch(e){e.code===N.i.IMAGE_TOO_LARGE&&await h.ZP.fetch(m.Fx,{name:"dialog-confirm",parentId:window.id,wait:!0,query:{type:"upload-limit-exceeded-of-image"}}),e.code===N.i.ATTACHMENT_TOO_LARGE&&await h.ZP.fetch(m.Fx,{name:"dialog-confirm",parentId:window.id,wait:!0,query:{type:"upload-limit-exceeded-of-attachment"}}),await h.ZP.fetch(m.g_,{name:"dialog-progress"}),e.code===N.R.STORAGE_LIMIT_FAILURE?(0,ee.C)().openUploadFailedStorageLimitToast():e.code===N.R.NO_PERMISSION_FAILURE?(0,ee.C)().openUploadFailedNoPermissionToast():e.code===N.R.EXCEED_FILES_LIMIT?await h.ZP.fetch(m.Gy,{name:"action.createMapOfCloud",payload:JSON.parse(e.message)}):(0,ee.C)().openUploadFailedToast(),te.error("save as failed",e)}}(e,t)}),canSave:e=>navigator.onLine,save:async e=>await re(e),getNewStage(e,t){var n;const{source:a,tempStorageDir:o}=t,s=null===(n=l().parse(a).pathname)||void 0===n?void 0:n.slice(1),{downloadXapResource:c,uploadXapResource:d,getThumbnail:u,uploadThumbnail:m}=(0,O.Y)(),f=(0,i.iH)([]),h=e=>f.value=f.value.filter((t=>t!==e));e.take=async e=>{try{const t=r().join(o,e);if(v.Z.existsSync(t))return v.Z.readFile(t);let n=null;if("Thumbnails/thumbnail.png"===e&&(n=await u({fileId:s})),e.startsWith("resources/")){await w(e);const t=e.replace(/^resources\//,"");n=await c({fileId:s,fileName:t})}return n&&await se(o,e,n),n}catch(e){}},e.add=async(e,t)=>{if("Thumbnails/thumbnail.png"===e&&m({fileId:s,file:t}).then((()=>{se(o,e,t)})).catch((()=>{})),e.startsWith("resources/")){const n=r().join(o,e);if(v.Z.existsSync(n))return;f.value=[...f.value,e];const a=e.replace(/^resources\//,"");d({fileId:s,fileName:a,file:t}).then((()=>se(o,e,t).then((()=>h(e))))).catch((()=>{h(e),(0,ee.C)().openUploadAttachmentFailedToast()}))}},e.toUrl=async(t,n)=>{const a=r().join(o,t);if(null==n?void 0:n.ensureFile)try{const n=await e.take(t);if(!n)return"";await v.Z.ensureDir(r().dirname(a)),await v.Z.writeFile(a,Buffer.from(n))}catch(e){te.error("stage toUrl failed",e)}return(0,p.u3)(a)};const w=async e=>{if(!f.value.includes(e))return;let t;const n=await Promise.race([new Promise((n=>{t=(0,i.YP)(f,(t=>{t.includes(e)||n(!0)}),{immediate:!0})})),new Promise((e=>setTimeout((()=>e(!1)),18e4)))]);return null==t||t(),n};return e}};async function ae({fileId:e,isStaticShare:t}){var n,a;try{const{metadata:i}=await h.ZP.fetch(m.rM.GET_FILE_METADATA,{fileId:e}),{team:o}=await h.ZP.fetch(m.rM.GET_TEAM_METADATA,{teamId:i.teamId}).catch((()=>({team:null}))),r=(await h.ZP.fetch(m.rM.GET_FOLDER_PATHS,{folderId:i.parentFolderId})).parents.map((e=>({folderName:e.name,folderId:e.folderId}))),{teammatePayload:s}=await h.ZP.fetch(m.rM.TEAMMATE_PAYLOAD,{teamId:i.teamId}).catch((e=>({teammatePayload:null})));return(0,q.c)().changeCloudFileMeta({parentFolderId:i.parentFolderId,fileOwner:i.xmindId,teamId:i.teamId,teammateRole:null!==(n=i.teammateRole)&&void 0!==n?n:"editor",accessMode:i.accessMode,accessRole:null!==(a=i.accessRole)&&void 0!==a?a:"viewer",password:i.password,teamMeta:o,teammatePayload:s,isStaticShare:t,folderPaths:r}),i}catch(e){return te.error("getFileMetadata failed",e),null}}async function ie({fileId:e,fileName:t,passwordHelper:n,password:a,errEncryptCount:i=0}){try{const n=await(0,ee.C)().fetchStaticShareFile({fileId:e,password:a});return a&&(0,q.c)().changeStaticShareFilePassword(a),{content:n,fileName:t,isEncrypted:!1}}catch(a){if(te.error("open static share file failed",a),!n)return{needToClose:!0};const o=await n.askForPassword(i,t);return o?await ie({fileId:e,fileName:t,passwordHelper:n,password:o,errEncryptCount:i+1}):{needToClose:!0}}}async function oe({fileId:e,passwordHelper:t,password:n,errEncryptCount:a=0}){try{const{content:t}=await(0,ee.C)().connect({fileId:e,password:n}),a=await ae({fileId:e,isStaticShare:!1});return a?{content:t,fileName:a.name,isEncrypted:!1}:{needToClose:!0}}catch(i){te.error("open cloud file failed",i);const o=await ae({fileId:e,isStaticShare:!0});if(!o)return{needToClose:!0};if("collaboration_forbidden"===i.reason){return{...await ie({fileId:e,fileName:o.name,passwordHelper:t,password:n}),fileName:o.name,isEncrypted:!1}}if("private_access_mode"===i.reason)return{needToClose:!0,privateAccessModeFailure:!0};if("file_not_exists"===i.reason)return{needToClose:!0,fileNotExistsFailure:!0};if("password_required"===i.reason||"password_incorrect"===i.reason){if(!t)return{needToClose:!0,passwordFailure:!0};const n=await t.askForPassword(a,o.name);return n?await oe({fileId:e,passwordHelper:t,password:n,errEncryptCount:a+1}):{needToClose:!0,passwordFailure:!0}}return{needToClose:!0}}}async function re(e){var t;const n=null===(t=l().parse(e.source).pathname)||void 0===t?void 0:t.slice(1);try{const{updateSheetRendering:e}=(0,G.E)();e({sheetRendering:!0,sheetRenderingStartAt:(new Date).getTime()});const t=await oe({fileId:n,password:(0,q.c)().staticShareFilePassword});return e({sheetRendering:!1,sheetRenderingStartAt:null}),te.info("load",n),{...t,fileId:n}}catch(e){te.error(`load ${n} failed`,e)}}async function se(e,t,n){const a=r().join(e,t);await v.Z.ensureDir(r().dirname(a)),await v.Z.writeFile(a,Buffer.from(n))}var le=n(79409),ce=n(52470);const de=(0,w.ZP)("from-temp:");async function ue(){}const pe={protocol:"temp-storage",async open(e,t){var n,a,i;const o=t.tempStorageDir,s=r().join(o,"manifest.json"),l=r().join(o,"content.json"),c=r().join(o,"metadata.json");if(!(v.Z.existsSync(o)&&v.Z.existsSync(s)&&v.Z.existsSync(l)&&v.Z.existsSync(c)))return void window.close();const d=new(T());d.file("manifest.json",await v.Z.readFile(s)),d.file("content.json",await v.Z.readFile(l)),d.file("metadata.json",await v.Z.readFile(c));const u=await d.generateAsync({type:"nodebuffer",compression:"STORE"}),p=null===(n=null==t?void 0:t.memento)||void 0===n?void 0:n.docId,m=null===(a=null==t?void 0:t.memento)||void 0===a?void 0:a.title,f=null===(i=null==t?void 0:t.memento)||void 0===i?void 0:i.dirty;return{...await(0,P.iw)(u,m,t.stage,t.passwordHelper),fileId:p,isDirty:f}},async save(e){const t=e.tempStorageDir;if(!v.Z.existsSync(t))return;const n=e.document.metadataFor(y.aX.KnownMetaKey.DataStructureVersion),a=y.aX.withArchiveMetadata(e.document,{creatorName:"Vana",creatorVersion:(0,le.Z)("version"),layoutEngineVersion:y.viewerKit.DocumentLayoutEngineVersion}),i=e.password;await(0,y.KR)(a,(async(e,a)=>{if("metadata.json"===e.path&&n){const e=JSON.parse(a);e[y.aX.KnownMetaKey.DataStructureVersion]=n,a=JSON.stringify(e)}if(i){const n=(0,ce.H)(e,(new TextEncoder).encode(a).buffer,{password:i});await v.Z.writeFile(r().join(t,e.path),Buffer.from(n))}else await v.Z.writeFile(r().join(t,e.path),a)}),ue)},async close(e){const t=e.tempStorageDir;de.debug("Start clearing temp storage: ",t);const n=function(e){if(v.Z.statSync(e).isDirectory()){for(const t of v.Z.readdirSync(e))n(r().join(e,t));v.Z.rmdirSync(e)}else v.Z.removeSync(e)};try{n(t)}catch(e){de.warn(`Something wrong when clearing temp storage: ${t}`,e)}},async updateMemento(e,t){if(f.nd)return;const n=e.tempStorageDir;if(!n)return;const a=r().join(n,".memento.json");if(t||v.Z.existsSync(a))try{const t={docId:e.fileId,workbookId:e.fileId,source:e.source,title:e.title,dirty:!!e.dirty,shouldOpenFromTempStorage:!e.source.startsWith("cloud://")&&!e.source.startsWith("new://host.xmind.app"),frameId:(0,K.A)().ownerFrameId};de.debug("Save Memento: ",t),v.Z.writeFileSync(a,JSON.stringify(t))}catch(e){de.error("Error when saving memento.json.",(0,u.SC)(e))}}},me=(0,w.ZP)("fm:"),fe={};function he(e){e.forEach((e=>fe[e.protocol]=e))}f.zr||f.sv?he([_,C,W,X,J,Y]):he([_,C,W,X,J,Y,ne]);const ve=(0,a.Q_)("file-manager",(()=>{const{addFileEventHook:e,emitFileEvent:t}=function(){const e=(0,i.qj)({open:null,save:null,saveAs:null,saveSheet:null,close:null}),t=(t,n)=>(0,i.YP)((()=>e[t]),((e,t)=>n(e,t))),n=(t,n)=>{e[t]=n};return{addFileEventHook:t,emitFileEvent:n}}(),n=(0,g.JE)().T,a=(0,i.qj)({inited:!1,opened:!1,closed:!1,saving:!1,resaving:!1}),o=(0,i.iH)(""),s=(0,i.iH)(n("Untitled")),l=(0,i.iH)(null),w=(0,i.iH)(!1),b=(0,i.iH)(""),I=(0,i.iH)(null),S=(0,i.Fl)((()=>{const e=be(o.value);return e?fe[e]:null}));let T,E,F,A;const C=(0,i.iH)(!1),Z=(0,i.iH)(),k=(0,i.iH)(),M={async askForPassword(e,t,n){await async function(){let e=null;await new Promise((t=>{e=(0,i.YP)((()=>(0,K.r)().activeEditorId),(e=>{e===window.editorId&&t(!0)}),{immediate:!0})})),e&&e()}(),(0,K.A)().setDecryptting(!0);const{result:a}=await h.ZP.fetch(m.Fx,{name:"dialog-enterpassword",parentId:window.id,wait:!0,query:{errEncryptCount:e,hint:n||k.value||"",filename:t}});return(0,K.A)().setDecryptting(!1),null==a?void 0:a.password}},x=(0,i.iH)(),L=(0,i.iH)(),R=(0,i.iH)(!1),O=(0,i.Fl)((()=>{var e,t;const n={take:async e=>{const t=r().join(E,e);return v.Z.existsSync(t)?v.Z.readFile(t):null},add:async(e,t)=>{const n=r().join(E,e);return await v.Z.ensureDir(r().dirname(n)),v.Z.writeFile(n,Buffer.from(t))},delete:async e=>{const t=r().join(E,e);return v.Z.existsSync(t)&&v.Z.remove(t)},toUrl:async e=>(0,p.u3)(r().join(E,e)),getDocument:async()=>A,setDocument:e=>A=e};return(null===(t=null===(e=S.value)||void 0===e?void 0:e.getNewStage)||void 0===t?void 0:t.call(e,n,{tempStorageDir:E,source:o.value}))||n})),N=()=>({memento:F,stage:O.value,tempStorageDir:E,document:A,source:o.value,title:s.value,dirty:w.value,editorId:T,fileId:l.value,password:Z.value,passwordHint:k.value,thumbnailGenerator:L.value,passwordHelper:M,$T:n,saveAs:_,changeDirty:U,makeDocumentCache:X}),D=()=>{var e,t;return S.value&&(null===(t=(e=S.value).canSave)||void 0===t?void 0:t.call(e,{source:o.value}))},_=async e=>{var n,a,i,s;t("saveAs","presaveas"),b.value=be(o.value);const c=be(e);if(await(null===(a=(n=S.value).beforeReload)||void 0===a?void 0:a.call(n,N(),{protocolTo:c})),(0,K.A)().setSaving(!0),V(e),!D())throw new Error(`Cannot save workbook to "${o.value}"`);h.ZP.fetch(m.xr,{editorId:T,source:o.value});const u=await(null===(s=(i=S.value).save)||void 0===s?void 0:s.call(i,N()));if(ge(u),C.value?x.value=(await(0,d.zD)("static/images/xmindfile-lock.png")).buffer:u&&u.thumbnail&&(x.value=u.thumbnail),u){if(u.fileId&&(l.value=u.fileId),u.content){const e=y.viewerKit.validateDocumentForLayoutEngine(u.content);A=e.document,I.value=e.incompatibility}u.fileName&&$(u.fileName)}if(e.startsWith("file://")){const e=(0,p.iZ)(o.value);$(r().basename(e,".xmind"))}"cloud"===b.value&&"file"===c&&((0,y.nZ)().changeEditorMode("editor"),await j()),U(!1),await B(!0),t("saveAs","postsaveas"),(0,K.A)().setSaving(!1),(0,g.Rg)().addRateMasValue(1)},H=(0,i.iH)(0),B=async e=>{var t;return null===(t=pe.updateMemento)||void 0===t?void 0:t.call(pe,N(),e)},$=e=>s.value=e,j=async()=>pe.save(N()),U=e=>w.value=e;let W=null;const z=e=>(...t)=>{if(R.value)return new Promise(u.ZT);if(!a.inited)throw Error("Cannot call this function before inited.");return e(...t)},V=e=>{const t=e.indexOf("?"),n=t>-1?e.slice(0,t):e;o.value=n},X=async()=>{var e;if(!f.nd&&l.value&&"file"===(null===(e=S.value)||void 0===e?void 0:e.protocol))try{const e=(0,g.yj)(),t=l.value,n=o.value.startsWith("file:")?(0,p.iZ)(o.value):void 0,a=e.fileCacheItemById(t)||o.value.startsWith("file:")&&e.fileCacheItem(n),i=a?a.fileCacheId:t,d=(0,u.hb)(),f=r().join((0,c.L2)(),i,d+".xmind");v.Z.ensureDirSync(r().dirname(f)),await(0,P.gv)(A,f,O.value),await h.ZP.fetch(m.Pp,{mutations:[{id:g.g8,type:"addSnapshot",payload:[{filename:s.value,snapshotId:d,fileCacheId:i,srcPath:n}]}]}),await h.ZP.fetch(m.S5,{action:"expiredSnapshot",fileCacheId:i})}catch(e){me.error((0,u.SC)(e))}};return{stage:O,source:o,title:s,isDirty:w,fileId:l,protocolFrom:b,emptyEditorView:R,docCompatibility:I,markEmpty:()=>R.value=!0,init:async(e,t)=>{o.value=e,T=t||(0,u.hb)();const n=await(0,c.Xl)();if(E=r().join(n,T),v.Z.ensureDirSync(E),t)try{const e=r().join(E,".memento.json");F=JSON.parse(v.Z.readFileSync(e).toString())}catch(e){}a.inited=!0},waitInited:async()=>(W&&(W(),W=null),!!a.inited||await new Promise((e=>{W=(0,i.YP)((()=>a.inited),(t=>{t&&e(!0)}),{immediate:!0})}))),open:z((async()=>{var e;t("open","preopen");const n=null==F?void 0:F.shouldOpenFromTempStorage,a=n?pe:S.value;if(!a)throw new Error(`Unspported file source: ${o.value}`);let i=await a.open(o.value,N());i=ge(i);const r=y.viewerKit.validateDocumentForLayoutEngine(i.content);return i.content=r.document,I.value=r.incompatibility,A=i.content,l.value=i.fileId,C.value=i.isEncrypted,Z.value=i.password,k.value=i.passwordHint,$(i.fileName),V(o.value),U(null!==(e=i.isDirty)&&void 0!==e&&e),t("open","opened"),n||o.value.startsWith("cloud://")||o.value.startsWith("new://host.xmind.app")||await j(),C.value?x.value=(await(0,d.zD)("static/images/xmindfile-lock.png")).buffer:x.value=await O.value.take("Thumbnails/thumbnail.png"),t("open","postopen"),(0,g.Rg)().addRateMasValue(1),i.content})),saveTemp:z(j),save:z((async()=>{if(!w.value)return;if(!D())throw new Error(`Cannot save workbook to "${o.value}"`);t("save","presave"),(0,K.A)().setSaving(!0);const e=A,n=await S.value.save(N());C.value?x.value=(await(0,d.zD)("static/images/xmindfile-lock.png")).buffer:x.value=n&&n.thumbnail,e===A&&U(!1),t("save","saved"),t("save","postsave"),(0,K.A)().setSaving(!1),await B(!1)})),saveAs:z(_),saveSheetAs:z((async(e,t)=>(0,P.YO)(A,t,O.value,{sheetIndexes:[e],thumbnail:await L.value.generateThumbnail(A.sheets[e].id)}))),saveAsLocalFile:z((async(e,{toEncrypt:t=!1,sheetIndexes:n,preprocessMetadata:a,thumbnail:i})=>(0,P.YO)(A,e,O.value,{password:t?Z.value:null,sheetIndexes:n,preprocessMetadata:a,thumbnail:i}))),close:z((async()=>{var e,n,a;t("close","preclose"),await(async()=>{let e;const t=new Promise((t=>{e=(0,i.YP)((()=>H.value),(n=>{0===n&&(t(!0),e&&e())}),{immediate:!0})})),n=new Promise((t=>setTimeout((()=>{t(!0),e&&e()}),1e4)));await Promise.race([t,n])})(),U(!1),await(null===(n=(e=S.value).close)||void 0===n?void 0:n.call(e,{tempStorageDir:E,document:A})),await(null===(a=pe.close)||void 0===a?void 0:a.call(pe,N())),t("close","closed"),t("close","postclose")})),reload:z((async()=>{var e,n,a,i;t("open","preopen"),await(null===(n=(e=S.value).beforeReload)||void 0===n?void 0:n.call(e,N()));let o=await(null===(i=(a=S.value).reload)||void 0===i?void 0:i.call(a,N()));o=ge(o);const r=y.viewerKit.validateDocumentForLayoutEngine(o.content);A=r.document,I.value=r.incompatibility,t("open","opened"),t("open","postopen")})),canSave:D,getSaveAsHandlers:()=>{const e=[];return Object.values(fe).forEach((t=>{var n;const a=null===(n=t.getSaveAsHandler)||void 0===n?void 0:n.call(t,N());"function"==typeof(null==a?void 0:a.prompt)&&e.push(a)})),e},updateMemento:B,makeDocumentCache:X,changeDirty:U,changeTitle:$,addFileEventHook:e,passwordHint:k,password:Z,handleOpenError:async e=>{var t,n;return null===(n=null===(t=S.value)||void 0===t?void 0:t.handleOpenError)||void 0===n?void 0:n.call(t,N(),{code:e.code,message:e.message})},heartbeatTest:async()=>{var e,t;return null===(t=null===(e=S.value)||void 0===e?void 0:e.heartbeatTest)||void 0===t?void 0:t.call(e,N())},lastThumbnail:x,thumbnailGenerator:L,passwordHelper:M,changePassword:e=>{C.value=!!e,Z.value=null==e?void 0:e.password,k.value=null==e?void 0:e.passwordHint},injectThumbnailGenerator:e=>L.value=e,startJob:()=>H.value+=1,endJob:()=>H.value-=1}}));class we extends Error{constructor(e,t){super(t),this.code=e}}class ye extends Error{constructor(e,t){super(t),this.code=e}}function ge(e){if(!e)throw new Error("Cannot open this file");if("verificationFailed"in e)throw new ye("VERIFICATION_FAILED","Current user does not have permission to download");if("networkFailure"in e)throw new ye("NETWORK_FAILURE","Unable to download due to network not connected");if("storageLimitFailure"in e)throw new ye("STORAGE_LIMIT_FAILURE","Storage limit reached");if("noPermissionUploadFailure"in e)throw new ye("NO_PERMISSION_UPLOAD","No permission to upload");if("privateAccessModeFailure"in e)throw new we("PRIVATE_ACCESS_MODE_FAILURE","This map is no longer available");if("fileNotExistsFailure"in e)throw new we("FILE_NOT_EXISTS_FAILURE","Map Not Found");if("passwordFailure"in e)throw new we("PASSWORD_FAILURE","password error");if("exceedFilesLimitFailure"in e)throw new we("EXCEED_FILES_LIMIT",e.message);if("needToClose"in e)throw new we("TO_CLOSE_DOCUMENT","Cannot open this file");return e}function be(e){let t=l().parse(e).protocol;return t?(t.endsWith(":")&&(t=t.substr(0,t.length-1)),t):""}},52470:(e,t,n)=>{n.d(t,{H:()=>s,p:()=>l});var a=n(23352),i=n(6113),o=n.n(i);const r=(0,a.ZP)("crypto:");function s(e,t,n){if(!e||!t||!n)return t;if(!e.encryptable)return t;const{password:a}=n;if(!a)return t;const i=o().randomBytes(8),s=o().randomBytes(16),l=function(e,t,n,a){try{const i=o().createCipheriv(t,n,a),r=Buffer.from(e);return Buffer.from(i.update(r,void 0,"hex")+i.final("hex"),"hex")}catch(t){return r.info("Failed to encrypt",t),e}}(t,"aes-128-cbc",o().pbkdf2Sync(a,i,1024,16,"sha512"),s);return e.keyDerivationAlgorithm="AES/CBC/PKCS5Padding",e.keyDerivationSize=128,e.keyDerivationIterationCount=1024,e.keyDerivationSalt=i.toString("base64"),e.keyDerivationIV=s.toString("base64"),e.cipherAlgorithm="PBKDF2WithHmacSHA512",l}function l(e,t,n){if(!e||!t||!n)return t;if(!e.encrypted)return t;const{password:a}=n;if(!a)return t;const{keyDerivationIterationCount:i,keyDerivationSalt:s,keyDerivationSize:l,keyDerivationIV:c}=e;if(!(i&&s&&l&&c))return t;const d=Buffer.from(s,"base64"),u=Buffer.from(c,"base64"),p=i,m=l/8,f=function(e,t,n,a){try{const i=o().createDecipheriv(t,n,a),r=Buffer.from(e);return Buffer.from(i.update(r,void 0,"hex")+i.final("hex"),"hex")}catch(t){return r.info("Failed to decrypt",t),e}}(t,"aes-128-cbc",o().pbkdf2Sync(a,d,p,m,"sha512"),u);return f}},87244:(e,t,n)=>{n.d(t,{Jb:()=>C,LW:()=>k,YO:()=>A,ee:()=>E,gv:()=>P,iw:()=>S,vP:()=>T,zw:()=>Z});var a=n(71017),i=n.n(a),o=n(55733),r=n.n(o),s=n(63902),l=n(47306),c=n(87141),d=n(33394),u=n(13382),p=n(69931),m=n(79409),f=n(84374),h=n(10042),v=n(91878),w=n(52470),y=n(68769),g=n(63111);class b extends Error{constructor(e,t){super(t),this.name="FileError",this.code=e}}const I={creatorName:"Vana",creatorVersion:(0,m.Z)("version"),[f.aX.KnownMetaKey.DataStructureVersion]:f.aX.DocumentDataStructureVersion,[f.aX.KnownMetaKey.LayoutEngineVersion]:f.viewerKit.DocumentLayoutEngineVersion};async function S(e,t,n=null,a){const i=await r().loadAsync(e),{passwordHint:o,encrypted:l}=await(0,s.n4)(i);if(l){let i=0;const r=async()=>{const s=await a.askForPassword(i,t,o);if(null==s)return{needToClose:!0};try{return await E(e,t,n,{password:s,passwordHint:o})}catch(e){return i++,await r()}};return await r()}return await E(e,t,n)}async function T(e,t=null,n){const a=i().basename(e,".xmind"),o=await d.Z.read(e);return await S(o,a,t,n)}async function E(e,t,n=null,a){const i=await(0,l.Zp)(e,{password:null==a?void 0:a.password,decrypt:(e,t,n)=>(0,w.p)(t,e,{password:n.password})}),o=await r().loadAsync(i);try{return await F(o,t,n,a)}catch(e){const{toFix:i}=await(0,u.Pg)((0,c.JE)().T);if(!i)return{needToClose:!0};{const e=await async function(e,t){const n=new(r());e.forEach(((e,t)=>{n.file(e,t.async("blob"))}));try{await f.aX.fixXMindFile((async({path:t})=>await e.file(t).async("string")),(({path:n})=>e.file(n).async("uint8array").then((async e=>{!await t.take(n)&&await t.add(n,e)}))),(async(e,t)=>{n.file(e.path,t)}),(async e=>{const a=await t.take(e.path);n.file(e.path,a)}))}catch(e){return null}return n}(o,n);if(e)return await F(e,t,n,a)}throw e}}async function F(e,t,n=null,a){var i,o;let r=null;try{r=await(0,f.CX)((async({path:t})=>await e.file(t).async("string")),(({path:t})=>e.file(t).async("uint8array").then((e=>{null==n||n.add(t,e)}))))}catch(e){if(e instanceof f.aX.UnsupportedDataStructureError)return await(0,u.G$)((0,c.JE)().T),window.close(),{needToClose:!0};throw e}if(!(null===(i=r.sheets[0])||void 0===i?void 0:i.id))throw new Error("No sheet in this .xmind file");return{fileName:t,content:r,isEncrypted:!(null===(o=null==a?void 0:a.password)||void 0===o||!o),password:null==a?void 0:a.password,passwordHint:null==a?void 0:a.passwordHint}}async function P(e,t,n,a){const i=new(r());e=f.aX.withArchiveMetadata(e,I),(null==a?void 0:a.password)?await(0,f.KR)(e,(async(e,t)=>{(null==a?void 0:a.preStoreString)&&(t=a.preStoreString(e,t));const n=(0,w.H)(e,(new TextEncoder).encode(t).buffer,{password:a.password});i.file(e.path,n)}),(async e=>{if("Thumbnails/thumbnail.png"===e.path){const e=(await(0,p.zD)("static/images/xmindfile-lock.png")).buffer;i.file("Thumbnails/thumbnail.png",e,{createFolders:!0,binary:!0})}else{const t=await n.take(e.path),o=(0,w.H)(e,t,{password:a.password});i.file(e.path,o)}}),{passwordHint:null==a?void 0:a.passwordHint,additionalResources:["Thumbnails/thumbnail.png"]}):await(0,f.KR)(e,(async(e,t)=>{(null==a?void 0:a.preStoreString)&&(t=a.preStoreString(e,t)),i.file(e.path,t)}),(async e=>{"Thumbnails/thumbnail.png"===e.path&&(null==a?void 0:a.thumbnail)?i.file("Thumbnails/thumbnail.png",a.thumbnail,{createFolders:!0,binary:!0}):i.file(e.path,await n.take(e.path))}),{additionalResources:["Thumbnails/thumbnail.png"]});const o=await i.generateAsync({type:"nodebuffer",compression:"STORE"});await d.Z.write(t,o)}async function A(e,t,n,{password:a,sheetIndexes:i,preprocessMetadata:o,thumbnail:r}){const s=i.map((t=>({id:e.sheets[t].id})));if(!s)return;const l=f.aX.DocumentBuilder().sheets(e.queryList(s).clone()).build();await P(l,t,n,{password:a,preStoreString:o?(e,t)=>("metadata.json"===e.path&&o&&(t=JSON.stringify(o(JSON.parse(t)))),t):null,thumbnail:r})}function C(e){var t;const n=(0,c.S)().defaultTheme,a="default"!==n&&(0,c.fl)().lastUsedSkeletonId,i=function(e){var t;let n=null;if(e)if(e.startsWith("Custom")){const a=null===(t=(0,c.fl)().smartColorThemes.find((t=>t.idList.includes(e))))||void 0===t?void 0:t.id;a&&(n=(0,v.B6)(a,e))}else n=f.HG.getColorThemeById(e);n||(n=f.HG.getColorThemeById(h.qE));return n}("default"!==n&&(0,c.fl)().lastUsedColorThemeId),o=null!==(t=f.HG.getSkeletonThemeById(a))&&void 0!==t?t:f.HG.getSkeletonThemeById(h.s9);return f.HG.combineTheme(e.sheets[0],{colorTheme:i,skeletonTheme:o}).ownerDocument}function Z(e){return e.asMutable().metadataFor(f.aX.KnownMetaKey.DataStructureVersion,f.aX.DocumentDataStructureVersion).metadataFor(f.aX.KnownMetaKey.LayoutEngineVersion,f.viewerKit.DocumentLayoutEngineVersion).commit()}async function k(e,t,n){const a=new(r());return await(0,f.KR)(f.aX.withArchiveMetadata(e,I),(async(e,t)=>{a.file(e.path,t)}),(async e=>{if("Thumbnails/thumbnail.png"===e.path)a.file("Thumbnails/thumbnail.png",n,{createFolders:!0,binary:!0});else{const n=function(e){if(null==e)return!1;const t=i().extname(e).toLowerCase();return[".png",".jpg",".jpeg",".gif",".bmp",".svg",".webp"].includes(t)}(e.path),o=await t.take(e.path),r=o.byteLength;if(n&&r>g.i3)throw new b(y.i.IMAGE_TOO_LARGE,"Image is too large");if(r>g.jX)throw new b(y.i.ATTACHMENT_TOO_LARGE,"Attachment is too large");a.file(e.path,o)}}),{additionalResources:["Thumbnails/thumbnail.png"]}),await a.generateAsync({type:"arraybuffer",compression:"STORE"})}},12455:(e,t,n)=>{n.d(t,{A:()=>o,r:()=>i});var a=n(87141);const i=()=>{const e=(0,a.JS)("frame");return null==e?void 0:e()},o=()=>{const e=(0,a.JS)("editor");return null==e?void 0:e()}},46016:(e,t,n)=>{n.d(t,{$:()=>s});var a=n(77412),i=n(2954),o=n(63111),r=n(64805);const s=(0,a.Q_)("workbench",(()=>{const e=(0,i.iH)(!1),t=(0,i.iH)(!1),n=(0,i.iH)(r.It.TOPIC),a=(0,i.iH)({}),s=(0,i.iH)(!1),l=(0,i.iH)(!1),c=(0,i.iH)(!1),d=(0,i.iH)(!1),u=(0,i.iH)(!1),p=(0,i.iH)(o.hO),m=(0,i.Fl)((()=>p.value===o.Pq)),f=(0,i.iH)(!1),h=(0,i.iH)(r.ll.MARKER),v=(0,i.iH)(!1),w=(0,i.iH)(!1),y=(0,i.iH)(r.QN.FORMAT),g=(0,i.iH)({[r.QN.FORMAT]:r.zZ.TOPIC,[r.QN.THEME]:r.x9.MAP,[r.QN.IMAGE]:r.ll.MARKER}),b=(0,i.iH)(null),I=(0,i.iH)({popover:""}),S=(0,i.iH)(""),T=(0,i.iH)(""),E=(0,i.iH)(!1),F=(0,i.Fl)((()=>!!T.value||!!E.value)),P=(0,i.iH)("none");return{isWorkbenchReady:e,updateWorkbenchReady:t=>{e.value=t},zenMode:s,zenModeNightMode:l,setZenMode:e=>s.value=e,setZenModeNightMode:e=>l.value=e,pitchMode:c,pitchPresenterViewMode:d,pitchRehearseMode:u,setPitchMode:({mode:e,isPresenterView:t,isRehearse:n})=>{"boolean"==typeof e&&(c.value=e),"boolean"==typeof t&&(d.value=t),"boolean"==typeof n&&(u.value=n)},editorMode:p,setEditorMode:e=>p.value=e,isOutlinerMode:m,mapshotMode:f,setMapshotMode:e=>f.value=e,iconPanelTab:h,isIconPanelVisible:v,updateIconPanel:({visible:e,tab:t})=>{"boolean"==typeof e&&(v.value=e),t&&(h.value=t)},isRightbarVisible:w,rightBarPanel:y,rightPanelTab:g,rightPanelWin:b,rightPanelTabConfig:I,updateRightBarPanel:({visible:e=null,panel:t=null,tab:n=null,win:a=null,tabConfig:i={popover:""}})=>{"boolean"==typeof e&&(w.value=e),t&&(y.value=t),n&&t&&(g.value[t]=n),a&&(b.value=a),I.value=i},updateRightBarPanelTab:({panel:e,tab:t})=>{t&&e&&(g.value[e]=t)},isSearchPanelVisible:t,searchPanelTab:n,searchPanelHighlightParam:a,updateSearchPanel:({visible:e,tab:a})=>{"boolean"==typeof e&&(t.value=e),a&&(n.value=a)},updateSearchPanelHighlightItem:e=>{a.value=e},userSelectedColorThemeTab:S,updateUserSelectedColorThemeTab:e=>{S.value=e},popoverEditorVisible:T,setPopoverEditorVisible:e=>{T.value=e},dialogEditorVisible:E,setDialogEditorVisible:e=>{E.value=e},isTopicContentEditing:F,hyperLinkAutoFillOpt:P,changeHyperLinkAutoFillOpt:e=>P.value=e}}))},62004:(e,t,n)=>{n.d(t,{Y:()=>c});var a=n(6712),i=n(87141),o=n(68769),r=n(23352);class s extends Error{constructor(e,t){super(t),this.name="FireflyClientError",this.code=e}}const l=(0,r.ZP)("firefly-client"),c=(()=>{const e=Symbol("default-firefly-client"),t=new Map;return()=>{if(t.has(e))return t.get(e);const n=(()=>{const e=[{pre:async({init:e,url:t})=>{l.info(`[STARTED] ${e.method} ${t}`)},post:async({response:e,init:t,url:n})=>{if(e.status>=400){const a=await e.text();throw l.error(`[FAILED] ${t.method} ${n} ${e.status} ${a}`),new s(e.status,a)}l.info(`[DONE] ${t.method} ${n} ${e.status}`)}}],t=()=>{const t="cn"===(0,i.qr)().serviceRegion?"https://ai.xmind.cn":"https://xmind.ai";return new a.VKt({basePath:t,middleware:e,apiKey:()=>(0,i.c7)().fireflyToken})};return{uploadXapResource:({fileId:e,fileName:n,file:i})=>new a.iy8(t()).uploadXapResource({fileId:e,filename:n,file:new Blob([i])}),downloadXapResource:({fileId:e,fileName:n})=>new a.iy8(t()).downloadXapResource({fileId:e,filename:n}).then((e=>e.arrayBuffer())),uploadThumbnail:({fileId:e,file:n})=>new a.iy8(t()).uploadThumbnail({fileId:e,file:new Blob([n])}),getThumbnail:({fileId:e})=>new a.iy8(t()).getThumbnail({fileId:e}).then((e=>e.arrayBuffer())),uploadFile:async({file:e,fileName:n,parentFolderId:r,teamId:l,isTeamOwner:c,accessMode:d,signal:u})=>{try{return await new a.iy8(t()).uploadFile({file:e,parentFolderId:r,teamId:l,accessMode:d},(async e=>{const t=e.init.body;return t.set("file",t.get("file"),n),{...e.init,body:t,signal:u}})).catch((e=>{throw e}))}catch(e){if(402===e.code){const{message:t,limit:n}=JSON.parse(e.message);if(t===a.INE.ExceedFilesLimit){const e=l===(0,i.c7)().user;throw new s(o.R.EXCEED_FILES_LIMIT,JSON.stringify({planType:e?i.k9.PERSONAL:i.k9.TEAM,teamId:l,isTeamOwner:c,limitMapNumOfCloud:n}))}}switch(null==e?void 0:e.message){case a.ikF.InsufficientSpace:throw new s(o.R.STORAGE_LIMIT_FAILURE,"Insufficient space");case a.ikF.UnsupportedAccessMode:throw new s(o.R.NO_PERMISSION_FAILURE,"Unsupported access mode");case a.ikF.FileCorrupted:throw new s(o.R.FILE_CORRUPTED_FAILURE,"File corrupted");case a.ikF.ImageFileTooLarge:throw new s(o.R.FILE_IMAGE_TOO_LARGE,"Image size limit: 10MB");case a.ikF.FileAttachmentTooLarge:throw new s(o.R.FILE_ATTACHMENT_TOO_LARGE,"Attachment size limit: 10MB");case a.ikF.FileMapContentTooLarge:throw new s(o.R.FILE_MAP_CONTENT_TOO_LARGE,"Map content size limit: 20MB");default:throw new s(o.R.NETWORK_FAILURE,"Network failure")}}},getHocuspocusServerURL:({type:e,fileId:t})=>"cn"===(0,i.qr)().serviceRegion?`wss://ai.xmind.cn/api/drive/connection/${e}/${t}`:`wss://xmind.ai/api/drive/connection/${e}/${t}`,getShareLink:({fileId:e,fileName:t})=>"cn"===(0,i.qr)().serviceRegion?`ã€Xmindæ€ç»´å¯¼å›¾ã€‘${t} https://ai.xmind.cn/share/${e}`:`https://xmind.ai/share/${e}`,getThumbnailURL:({fileId:e,version:t})=>"cn"===(0,i.qr)().serviceRegion?`https://ai.xmind.cn/api/drive/file/${e}/Thumbnails/thumbnail.png?version=${t}`:`https://xmind.ai/api/drive/file/${e}/Thumbnails/thumbnail.png?version=${t}`}})();return t.set(e,n),n}})()},59474:(e,t,n)=>{n.d(t,{i:()=>o});var a=n(77412),i=n(2954);const o=(0,a.Q_)("bootstrap",(()=>{const e=(0,i.iH)(!1),t=(0,i.iH)(0);return{ready:e,markReady:()=>e.value=!0,pendingJobs:t,startJob:()=>t.value+=1,endJob:()=>t.value-=1}}))},65428:(e,t,n)=>{n.d(t,{r:()=>s});var a=n(54856),i=n(77412),o=n(2954),r=n(90435);const s=(0,i.Q_)("fonts",(()=>{const e=(0,o.iH)(!1),t=(0,o.iH)({systemFonts:{},vanaFonts:{}});return{loaded:e,markLoaded:()=>e.value=!0,getLoadedFonts:async()=>{if(!t.value||Object.keys(t.value.systemFonts).length<=0&&Object.keys(t.value.vanaFonts).length<=0){const e=await(0,r.he)(a.qz);t.value=e}return t.value}}}))},7710:(e,t,n)=>{n.d(t,{l:()=>o});var a=n(77412),i=n(2954);const o=(0,a.Q_)("query",(()=>{const e=(0,i.iH)({});return{query:e,setQuery:t=>{e.value=t}}}))},2563:(e,t,n)=>{n.d(t,{O:()=>o});var a=n(77412),i=n(2954);const o=(0,a.Q_)("renderer-app",(()=>{const e=(0,i.iH)(!1),t=(0,i.XI)([]),n=(0,i.XI)({}),a=(0,i.XI)([]);return{ignoreAppearanceChanged:e,updateIgnoreAppearance:t=>{e.value=t},builtinFontFamilies:t,updateBuiltinFontFamilies:e=>t.value=e,allFonts:n,updateAllFonts:e=>n.value=e,fontsForMindMap:a,updateFontsForMindMap:e=>a.value=e}}))},91878:(e,t,n)=>{n.d(t,{B6:()=>w,CC:()=>v,Ho:()=>d,LN:()=>m,PV:()=>h,gA:()=>g,jS:()=>y,s9:()=>p,uv:()=>f});var a=n(7104),i=n(94593),o=n(71017),r=n.n(o),s=n(96829),l=n(52517);const{DEFAULT_SKELETON_THEME_ID:c,generateCustomSmartColorThemeInfo:d,deserializeColorTheme:u}=l.s,p=c,m=async(e,t)=>{const n=r().join((0,a.Im)(),`${e}.json`);i.Z.existsSync(n)&&await i.Z.remove(n),t&&await t()},f=async(e,t,n)=>{const o=(0,a.Im)();await i.Z.ensureDir(o);const s=r().join(o,`${e}.json`);await t(s),n&&await n()},h=async({colorList:e,themeName:t},n)=>{const o="SMARTCOLOR-"+(0,s.hb)(),l=d([{colorList:e,themeName:t}])[0],c=(0,a.Im)();await i.Z.ensureDir(c);const u=r().join(c,`${o}.json`);try{const e=JSON.stringify(l);await i.Z.writeFile(u,e),n&&await n({customSCTId:o,...l})}catch(e){return}},v=e=>{const t=(0,a.Im)(),n=r().join(t,`${e}.json`);return JSON.parse(i.Z.readFileSync(n).toString())},w=(e,t)=>{const n=v(e);if(!n)return null;const a=n.colorThemeList.find((e=>e.id===t));return"deserialized"in a?a:u(a)},y=(e,t=p)=>{const n=l.t.getColorThemePreviewById(t,e)||l.t.getColorThemePreviewById(p,e);return n?`data:image/svg+xml,${encodeURIComponent(n)}`:""},g=()=>l.t.initThemePreviewModule()},53775:(e,t,n)=>{async function a(){await new Promise((e=>requestAnimationFrame((()=>{requestAnimationFrame(e)}))))}async function i(e){return Promise.race([new Promise((e=>requestAnimationFrame((()=>{requestAnimationFrame(e)})))),new Promise((t=>setTimeout(t,null!=e?e:200)))])}function o(e,t=300,n=!1){let a;function i(...t){a=void 0,n||e.apply(this,t)}const o=function(...o){void 0!==a&&clearTimeout(a),n&&!a&&e.apply(this,o),a=setTimeout(i.bind(this,...o),t)};return o.cancel=function(){void 0!==a&&(clearTimeout(a),a=void 0)},o}function r(e,t=300,n=!1){let a,i,o,r=!1;function s(){i=Date.now(),e.apply(this,o),void 0!==a&&(clearTimeout(a),a=void 0)}const l=function(...e){if(r)return;if(o=e,n&&!i)return void s.apply(this);const l=Date.now(),c=l-(null!=i?i:l);c>=t?s.apply(this):void 0===a&&(a=setTimeout(s.bind(this),t-c))};return l.cancel=function(e=!0){void 0!==a&&(clearTimeout(a),a=void 0),i=void 0,r=e},l}n.d(t,{Ds:()=>o,P2:()=>r,SX:()=>a,gH:()=>s,qJ:()=>i});const s=(e,t)=>{let n=e,a="";if("object"==typeof t){const e=new URLSearchParams;for(const n in t)e.append(n,t[n]);a=e.toString()}return n=n.includes("?")?n+"&"+a:n+"?"+a,n}}}]);