"use strict";(global.webpackChunkxmind_vana=global.webpackChunkxmind_vana||[]).push([[8595],{48595:(t,e,a)=>{a.r(e),a.d(e,{exportWord:()=>m});var i=a(71017),r=a.n(i),n=a(97769),o=a(69361),g=a(72298),h=a(13382),s=a(18621),c=a(87141),d=a(5893),u=a(52517),w=a(34543),f=a(89411),l=a(67214);async function m(){const{activeSheet:t}=(0,u.h)(),e=Date.now();let a;try{(0,o.Ae)("docx"),a=await(0,w.e)([t.value],x)}catch(t){throw t}finally{await(0,o.Gm)()}if(!a)throw new Error("Word Buffer is null!");(0,c.Rg)().addRateMasValue(10),(0,s.L9)({eventCategory:"export",eventAction:"durationExportWord",eventValue:Date.now()-e});const i=await(0,h.ZZ)({title:"Export",filters:[{name:"DOCX",extensions:["docx"]}],suggestPath:{suggestedName:(0,d.Nw)(t.value.rootTopic.title)}});i&&(0,o.yS)(i,a),g.shell.showItemInFolder(i)}const p=40;async function x(t,e,a,i){if("marker"===t){const{markerModule:t}=(0,u.h)(),r=await new Promise((a=>{t.loadMarkerAsset(e)((t=>{a(t.imageSource)}))}));let n;try{n=await v(r,a,i)}catch(t){return}const{pngBuffer:o,originWidth:g,originHeight:h}=n,s=a?a/p:g/p,c=i?i/p:h/p;return new Promise((t=>{t({width:s,height:c,data:o,extension:".png"})}))}if("xap"===t||e.startsWith("xap:")){const{stage:t}=(0,f.FU)(),o=Buffer.from(await t.take(e.replace("xap:","")));if(!o)return;const g=r().extname(e);if(".svg"===g){const t="data:image/svg+xml;base64,"+o.toString("base64");let e;try{e=await v(t,a,i)}catch(t){return}const{pngBuffer:r,originWidth:n,originHeight:g}=e,{targetWidth:h,targetHeight:s}=W(a?a/p:n/p,i?i/p:g/p);return new Promise((t=>{t({width:h,height:s,data:r,extension:".png"})}))}{const t=`data:${(await(0,n.fromBuffer)(o)).mime};base64,`+o.toString("base64");let e;try{e=await(0,l.N8)(t)}catch(t){return}const{width:r,height:h}=e,{targetWidth:s,targetHeight:c}=W(a?a/p:r/p,i?i/p:h/p);return new Promise((t=>{t({width:s,height:c,data:o,extension:g})}))}}if("base64"===t){let t;try{t=await v(e,a,i)}catch(t){return}const{pngBuffer:r,originWidth:n,originHeight:o}=t,{targetWidth:g,targetHeight:h}=W(a?a/p:n/p,i?i/p:o/p);return new Promise((t=>{t({width:g,height:h,data:r,extension:".png"})}))}}function v(t,e,a){return new Promise(((i,r)=>{const n=document.createElement("canvas"),o=n.getContext("2d"),g=new Image(e||void 0,a||void 0);g.src=t,g.onload=()=>{n.width=2*g.width,n.height=2*g.height,o.setTransform(2,0,0,2,0,0),o.drawImage(g,0,0,g.width,g.height);const t=n.toDataURL("image/png").slice(22);i({pngBuffer:Buffer.from(t,"base64"),originWidth:g.width,originHeight:g.height})},g.onerror=t=>r(t)}))}function W(t,e){const a={MAX:200/p,MIN:64/p},i=e/t;let r=t,n=e;return t<a.MIN?(r=a.MIN,n=r*i):t>a.MAX&&(r=a.MAX,n=r*i),{targetWidth:r,targetHeight:n}}}}]);