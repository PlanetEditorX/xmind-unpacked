(global.webpackChunkxmind_vana=global.webpackChunkxmind_vana||[]).push([[7182],{83388:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>r});var o=n(23645),a=n.n(o)()((function(t){return t[1]}));a.push([t.id,".comment-header[data-v-71eff05e] {\n  height: 48px;\n  padding: 16px 8px;\n  box-sizing: border-box;\n}\n",""]);const r=a},40874:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>r});var o=n(23645),a=n.n(o)()((function(t){return t[1]}));a.push([t.id,".comment-author-avatar[data-v-8f0ccd4c] {\n  width: 24px;\n  height: 24px;\n  border-radius: 50%;\n  overflow: hidden;\n}\n.comment-author-name[data-v-8f0ccd4c] {\n  margin-left: 8px;\n  font-size: 13px;\n  font-weight: 600;\n  line-height: 17px;\n  letter-spacing: 0.26px;\n  color: var(--color-text-primary);\n}\n.comment-create-time[data-v-8f0ccd4c] {\n  margin-left: 12px;\n  font-size: 11px;\n  font-weight: 400;\n  line-height: 15px;\n  letter-spacing: 0.44px;\n  color: var(--color-text-quaternary);\n}\n.comment-item-vertical-line[data-v-8f0ccd4c] {\n  width: 1px;\n  height: calc(100% - 16px);\n  margin: 8px 12px;\n  background: var(--color-divider-on-surface-bright);\n}\n.last-comment-item-vertical-line[data-v-8f0ccd4c] {\n  background: transparent;\n}\n.comment-content[data-v-8f0ccd4c] {\n  width: 100%;\n  padding: 7.5px 28px 24px 8px;\n  font-size: 12px;\n  font-weight: 400;\n  line-height: 16px;\n  letter-spacing: 0.48px;\n}\n.last-comment-content[data-v-8f0ccd4c] {\n  padding-bottom: 0;\n}\n[data-v-8f0ccd4c] .tiptap p {\n  margin: 0;\n}\n",""]);const r=a},3587:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>r});var o=n(23645),a=n.n(o)()((function(t){return t[1]}));a.push([t.id,".comment-list-container[data-v-069226a5] {\n  padding: 16px 24px 32px;\n  height: calc(324px - 48px - 16px - 32px);\n  overflow: scroll;\n}\n",""]);const r=a},843:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>r});var o=n(23645),a=n.n(o)()((function(t){return t[1]}));a.push([t.id,".comment-container[data-v-02298a9a] {\n  width: 340px;\n  height: 324px;\n  margin-top: -12px;\n}\n",""]);const r=a},82937:(t,e,n)=>{"use strict";n.d(e,{_:()=>s,h:()=>i});var o=n(68214),a=n.n(o);const r=["#E65244","#FF9326","#EED346","#4CAF4E","#4F69F6","#4C49B7","#8A38DC"],i=({xmindId:t})=>{const e=parseInt(a()(t).toString(),16)%7;return{foregroundColor:"#fff",backgroundColor:r[e]}},s=({xmindId:t,name:e,style:n={}})=>{const o=i({xmindId:t}),a=((null==e?void 0:e[0])||"A").replace(/&/g,"").replace(/</g,"").replace(/>/g,"").replace(/"/g,"").replace(/'/g,"")||"A",r=(({backgroundColor:t,foregroundColor:e,avatarAbbreviation:n,width:o=24,height:a=24,fontSize:r="11",fontWeight:i="600"})=>{var s,l;const c=/(?<size>\d+)(?<unit>\w+)/.exec(r),d=Number((null===(s=null==c?void 0:c.groups)||void 0===s?void 0:s.size)||"12");return`\n<svg width="${o}" height="${a}" viewBox="0 0 ${o} ${a}" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <rect width="${o}" height="${a}" x="0"  y="0" rx="4" fill="${t}" fill-opacity="1" />\n  <text x="${o/2}" y="${(a-d)/2}" fill="${e}" text-anchor="middle" dominant-baseline="central" font-weight="${i}" font-size="${d}${(null===(l=null==c?void 0:c.groups)||void 0===l?void 0:l.unit)||""}" font-family="system-ui, sans-serif">\n     ${n.toUpperCase()}\n  </text>\n</svg>\n`})({backgroundColor:o.backgroundColor,foregroundColor:o.foregroundColor,avatarAbbreviation:a,width:n.width,height:n.height,fontSize:n.fontSize,fontWeight:n.fontWeight});return`data:image/svg+xml;utf8,${encodeURIComponent(r)}`}},14448:(t,e,n)=>{"use strict";n.d(e,{T:()=>a,V:()=>o});const o=(t,e)=>{const n=new Date(e).getTime()-new Date(t).getTime(),o=n%36e5,a=o%6e4;return{hour:String(Math.floor(n/36e5)).padStart(2,"0"),minute:String(Math.floor(o/6e4)).padStart(2,"0"),second:String(Math.floor(a/1e3)).padStart(2,"0")}},a=(t,e)=>{const n=(Date.now()-new Date(t).getTime())/1e3,o=Math.floor(n/60/60/24);if(isNaN(o))return"";if(0===o)switch(!0){case n<60:return e("Just now");case n<120:return e("1 minute ago");case n<3600:return e("$1 minutes ago",`${Math.floor(n/60)}`);case n<7200:return e("1 hour ago");case n<86400:return e("$1 hours ago",`${Math.floor(n/60/60)}`)}switch(!0){case 1===o:return e("Yesterday");case o<7:return e("$1 days ago",`${o}`);case o<31:return e("$1 weeks ago",`${Math.ceil(o/7)}`);case o<62:return e("1 month ago");case o<372:return e("$1 months ago",`${Math.ceil(o/31)}`);case o<744:return e("1 year ago");default:return e("$1 years ago",`${Math.ceil(o/372)}`)}}},48122:(t,e,n)=>{"use strict";n.d(e,{Z:()=>l});var o=n(2954),a=n(96829),r=n(46016),i=n(89019);const s=(0,o.aZ)({__name:"comment-header",props:{commentThread:null},setup(t){const e=t,n=({threadId:t,resolved:e,author:n})=>{const o=(0,i.c)().sharedDoc;if(!o)return;const r={...o,commentThreads:o.commentThreads.map((o=>o.id===t?{...o,status:{resolved:e},actions:[...o.actions,{id:(0,a.hb)(),author:n,createdDate:Date.now(),type:"resolve",payload:e}],comments:o.comments.map((t=>{if(e){return!t.readed.some((t=>t.xmindId===n.xmindId))?{...t,readed:t.readed.concat({xmindId:n.xmindId})}:t}return t}))}:o))};(0,i.c)().setSharedDoc(r)};return{__sfc:!0,props:e,handleResolve:()=>{const t=(0,i.c)().onlineCollaborators.find((t=>t.isMe));n({threadId:e.commentThread.id,resolved:!0,author:{xmindId:null==t?void 0:t.xmindId,clientId:null==t?void 0:t.clientId,name:null==t?void 0:t.name,avatarUrl:null==t?void 0:t.avatarUrl,color:null==t?void 0:t.color}}),(0,i.c)().setLastActiveCommentThreadId(""),(0,r.$)().setPopoverEditorVisible("")},updateCommentThreadResolved:n}}});n(48068);const l=(0,n(51900).Z)(s,(function(){var t=this._self._c;return t("div",{staticClass:"uk-flex uk-flex-middle uk-flex-right comment-header"},[t("button",{staticClass:"vk-button-link-secondary",staticStyle:{padding:"0 8px"},on:{click:this._self._setupProxy.handleResolve}},[t("span",{attrs:{"uk-icon":"checkmark-circle-outline"}})])])}),[],!1,null,"71eff05e",null).exports},24610:(t,e,n)=>{"use strict";n.d(e,{Z:()=>v});var o=n(2954),a=n(45757),r=n(43756),i=n(87141),s=n(14448),l=n(82937);const c=(0,o.aZ)({__name:"comment-item",props:{comment:null,isLast:{type:Boolean,default:!1}},setup(t){const e=t,n=(0,i.JE)().T,c=(0,o.iH)(null),d=(0,o.Fl)((()=>{const{xmindId:t,name:n,avatarUrl:o}=e.comment.author;return null!=o?o:(0,l._)({xmindId:t,name:n})})),m=(0,o.Fl)((()=>(0,s.T)(e.comment.createdDate,n)));return(0,o.bv)((()=>{c.value=new a.ML({content:e.comment.content,extensions:[r.Z],editable:!1})})),(0,o.Jd)((()=>{c.value&&c.value.destroy()})),{__sfc:!0,props:e,$T:n,editor:c,commentAuthorAvatar:d,commentCreateTime:m,EditorContent:a.kg}}});n(41048);var d=n(51900);const m=(0,d.Z)(c,(function(){var t=this,e=t._self._c,n=t._self._setupProxy;return e("div",[e("div",{staticClass:"uk-flex uk-flex-middle"},[e("div",{staticClass:"comment-author-avatar"},[e("img",{attrs:{draggable:"false",src:n.commentAuthorAvatar}})]),t._v(" "),e("div",{staticClass:"comment-author-name"},[t._v(t._s(t.comment.author.name))]),t._v(" "),e("div",{staticClass:"comment-create-time"},[t._v(t._s(n.commentCreateTime))])]),t._v(" "),e("div",{staticClass:"uk-flex"},[e("div",[e("div",{staticClass:"comment-item-vertical-line",class:{"last-comment-item-vertical-line":t.isLast}})]),t._v(" "),e("div",{staticClass:"comment-content",class:{"last-comment-content":t.isLast}},[e(n.EditorContent,{attrs:{editor:n.editor}})],1)])])}),[],!1,null,"8f0ccd4c",null).exports,u=(0,o.aZ)({__name:"comment-list",props:{items:null},setup:t=>({__sfc:!0,CommentItem:m})});n(98506);const v=(0,d.Z)(u,(function(){var t=this,e=t._self._c,n=t._self._setupProxy;return e("div",{staticClass:"comment-list-container"},t._l(t.items,(function(o,a){return e(n.CommentItem,{key:o.id,attrs:{comment:o,"is-last":a===t.items.length-1}})})),1)}),[],!1,null,"069226a5",null).exports},7182:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>h});var o=n(2954),a=n(84374),r=n(46016),i=n(89019),s=n(96829);const l=(0,o.aZ)({__name:"comment-popover",props:{width:null,height:null,left:null,top:null},emits:["close","click-comment"],setup(t,{emit:e}){const n=t,a=(0,o.FN)(),r=(0,o.iH)(null),i=(0,o.iH)(`tooltip-${(0,s.hb)()}`),l=(0,o.Fl)((()=>({width:`${n.width}px`,height:`${n.height}px`,left:`${n.left}px`,top:`${n.top}px`})));return(0,o.bv)((()=>{a.proxy.$withUIKit((t=>{t.popTips(r.value).handleShowTip({withOverlay:!0}),t.util.on(r.value,"hidden",(()=>e("close")))}))})),{__sfc:!0,props:n,emit:e,vm:a,tooltipEl:r,tooltipId:i,commentRectStyle:l}}});n(76592);var c=n(51900);const d=(0,c.Z)(l,(function(){var t=this,e=t._self._c,n=t._self._setupProxy;return e("div",{directives:[{name:"focus-contexts",rawName:"v-focus-contexts:group",value:["focus.popover"],expression:"['focus.popover']",arg:"group"}]},[e("div",{staticClass:"uk-position-absolute",style:n.commentRectStyle,attrs:{id:n.tooltipId}}),t._v(" "),e("div",{ref:"tooltipEl",staticClass:"comment-container",attrs:{"uk-pop-tips":"","data-mode":"click","data-type":"secondary","data-pos":"right-top","data-toggle":`#${n.tooltipId}`}},[t._t("default")],2)])}),[],!1,null,"02298a9a",null).exports;var m=n(24610),u=n(48122);const v=(0,o.aZ)({__name:"index",setup(t){const{commentThreadPreviewInfo:e,activeSheetFigure:n,activeSheetViewportMetrics:s}=(0,a.nZ)(),l=(0,o.Fl)((()=>(0,i.c)().lastActiveCommentThreadId)),c=(0,o.Fl)((()=>{var t;return(null===(t=(0,i.c)().sharedDoc)||void 0===t?void 0:t.commentThreads)||[]})),v=(0,o.Fl)((()=>c.value.find((t=>t.id===l.value)))),p=(0,o.Fl)((()=>{var t;return(null===(t=v.value)||void 0===t?void 0:t.comments)||[]})),h=(0,o.Fl)((()=>0===p.value.length)),f=(0,o.Fl)((()=>{var t;return l.value?(null===(t=e.value)||void 0===t?void 0:t.threadId)===l.value?e.value.bound:x(v.value,n.value,s.value):{x:0,y:0}})),g=(0,o.Fl)((()=>({width:32,height:24,left:f.value.x-16,top:f.value.y-12}))),x=(t,e,n)=>{var o;const r=null!==(o=t.anchor.topicId)&&void 0!==o?o:e.modelAttributes.rootTopics[0],i=e.topicFigureByTopicId[r];if(!i)return null;const s=a.viewerKit.translate(i.anchorPoint,t.anchor.position);return a.viewerKit.transformToViewport(s,n)};(0,o.bv)((()=>{if(!h.value){const t=(0,i.c)().onlineCollaborators.find((t=>t.isMe));_({threadId:l.value,readed:!0,author:{xmindId:null==t?void 0:t.xmindId,clientId:null==t?void 0:t.clientId,name:null==t?void 0:t.name,avatarUrl:null==t?void 0:t.avatarUrl,color:null==t?void 0:t.color}})}}));const _=({threadId:t,readed:e,author:n})=>{const o=(0,i.c)().sharedDoc;if(!o)return;const a={...o,commentThreads:o.commentThreads.map((o=>o.id===t?{...o,comments:o.comments.map((t=>{if(e){return!t.readed.some((t=>t.xmindId===n.xmindId))?{...t,readed:t.readed.concat({xmindId:n.xmindId})}:t}return{...t,readed:t.readed.filter((t=>t.xmindId!==n.xmindId))}}))}:o))};(0,i.c)().setSharedDoc(a)};return{__sfc:!0,commentThreadPreviewInfo:e,activeSheetFigure:n,activeSheetViewportMetrics:s,activeCommentThreadId:l,commentThreads:c,activeCommentThread:v,activeComments:p,isEmptyThread:h,threadViewBound:f,commentRect:g,computeCommentThreadViewBound:x,handleClose:()=>{(0,r.$)().setPopoverEditorVisible(""),(0,i.c)().setLastActiveCommentThreadId("")},updateCommentThreadReaded:_,CommentPopover:d,CommentList:m.Z,CommentHeader:u.Z}}}),p=v;const h=(0,c.Z)(p,(function(){var t=this,e=t._self._c,n=t._self._setupProxy;return e(n.CommentPopover,t._b({on:{close:n.handleClose}},"comment-popover",n.commentRect,!1),[e(n.CommentHeader,{attrs:{"comment-thread":n.activeCommentThread}}),t._v(" "),e("hr",{staticClass:"vk-divider-on-surface-bright"}),t._v(" "),e(n.CommentList,{attrs:{items:n.activeComments}})],1)}),[],!1,null,"8be8da38",null).exports},48068:(t,e,n)=>{var o=n(83388);o.__esModule&&(o=o.default),"string"==typeof o&&(o=[[t.id,o,""]]),o.locals&&(t.exports=o.locals);(0,n(45346).Z)("921090b8",o,!0,{})},41048:(t,e,n)=>{var o=n(40874);o.__esModule&&(o=o.default),"string"==typeof o&&(o=[[t.id,o,""]]),o.locals&&(t.exports=o.locals);(0,n(45346).Z)("171be094",o,!0,{})},98506:(t,e,n)=>{var o=n(3587);o.__esModule&&(o=o.default),"string"==typeof o&&(o=[[t.id,o,""]]),o.locals&&(t.exports=o.locals);(0,n(45346).Z)("8f875978",o,!0,{})},76592:(t,e,n)=>{var o=n(843);o.__esModule&&(o=o.default),"string"==typeof o&&(o=[[t.id,o,""]]),o.locals&&(t.exports=o.locals);(0,n(45346).Z)("41a6c5ef",o,!0,{})}}]);