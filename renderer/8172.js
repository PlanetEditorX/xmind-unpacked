(global.webpackChunkxmind_vana=global.webpackChunkxmind_vana||[]).push([[8172],{71884:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>a});var n=o(23645),i=o.n(n)()((function(e){return e[1]}));i.push([e.id,"#editor-container[data-v-44614111] .sheet-viewer {\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  overflow: auto;\n  z-index: -1;\n  outline: none;\n  visibility: hidden;\n}\n#editor-container[data-v-44614111] .sheet-viewer.active {\n  z-index: 0;\n  visibility: visible;\n}\n.sheet-rendering-mask[data-v-44614111] {\n  z-index: 99;\n  position: absolute;\n  width: 100%;\n  height: 100%;\n}\n.editor-tooltip[data-v-44614111] {\n  background: var(--uk-popover-background, rgba(255, 255, 255, 0.7));\n  color: var(--uk-global-color, #27292a);\n  border-radius: 5px;\n  backdrop-filter: blur(30px);\n  filter: drop-shadow(0px 5px 20px rgba(0, 0, 0, 0.35));\n  position: absolute;\n  padding: 8px 16px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  pointer-events: none;\n  font-weight: normal;\n}\n.editor-tooltip[data-v-44614111]::before {\n  content: ' ';\n  display: block;\n  position: absolute;\n  width: 0;\n  height: 0;\n  border-style: solid;\n  border-color: var(--uk-popover-arrow-mask-border, rgba(232, 232, 232, 0));\n  border-width: 5px;\n  top: 100%;\n  left: calc(50%);\n  margin-left: -5px;\n  border-top-color: var(--uk-popover-background, rgba(255, 255, 255, 0.7));\n}\n[data-v-44614111] #editor-container ::selection {\n  color: unset;\n}\n",""]);const a=i},83063:(e,t,o)=>{"use strict";o.d(t,{F:()=>b});var n=o(71017),i=o.n(n),a=o(94593),l=o(72298),r=o(23352),d=o(57147),s=o(67657),c=o(84374),u=o(87141),m=o(13382),p=o(5893),v=o(89411);const h=(0,r.ZP)("editor:attachment"),b=async(e,t)=>{const{getResourceUrlByXapUrl:o}=(0,c.nZ)(),n=await o(t,{ensureFile:(0,v.FU)().source.startsWith("cloud://")}),i=(0,p.iZ)(n);I(e,i)},I=async(e,t)=>{const{T:o}=(0,u.JE)(),{lastSaveDirectory:n,doNotShowAttachmentMessageAgain:a,setDoNotShowAttachmentMessageAgain:l}=(0,u._I)();let r=e,d="";const c=i().extname(t);try{d=n||s.app.getPath("downloads")}catch(e){d="downloads"}if(r&&!r.endsWith(c)&&(r+=c),a)g(t,d,r);else{const{response:e,checkboxChecked:n}=await s.dialog.showMessageBox({title:"Xmind",message:o("Trying to Open Attachment"),detail:o("Xmind will save this attachment to $1 and open with default application in your system.",d),checkboxLabel:o("Don't show this message again."),buttons:[o("Save and Open"),o("Cancel")],defaultId:0,cancelId:1});0===e&&(n&&l(),g(t,d,r))}},g=async(e,t,o)=>{const{T:n}=(0,u.JE)(),{setLastDirectory:r}=(0,u._I)();o=(0,p.N6)(o);try{a.Z.accessSync(t,d.constants.F_OK|d.constants.W_OK);const n=(0,p.AK)(t,o),r=i().join(t,n);await a.Z.copyFile(e,r),await l.shell.openPath(r)}catch(a){h.info("Failed to save and open attachment",a);const[l]=await(0,m.N0)({title:"Xmind",message:n("Failed to Save File"),detail:n("Xmind doesn't have permission to save file to $1, please choose another folder to save.",t),buttons:[n("Choose Folder"),n("Cancel")],defaultId:0,cancelId:1});if(0===l){const t=await(0,m.ZZ)({title:"Save",suggestPath:{suggestedName:o}});if(t){const n=i().dirname(t);r({lastSaveDirectory:n}),await g(e,n,o)}}}}},31621:(e,t,o)=>{"use strict";o.d(t,{S:()=>g,U:()=>I});var n=o(71017),i=o.n(n),a=o(94593),l=o(72298),r=o(23352),d=o(67657),s=o(87141),c=o(57147),u=o(5893),m=o(13382),p=o(84374),v=o(89411),h=o(96829);const b=(0,r.ZP)("editor:hyperlink"),I=async e=>{const{T:t}=(0,s.JE)(),{source:o}=(0,v.FU)();let n,r;if(e.startsWith("file://"))try{n=(0,u.iZ)(e)}catch(t){b.error((0,h.SC)(t)),n=e.slice(7)}else n=e.startsWith("file:")?e.slice(5):e;if(i().isAbsolute(n))r=n;else{if(!o.startsWith("file:"))return;{const e=(0,u.iZ)(o),t=i().dirname(e);r=i().join(t,n)}}try{a.Z.accessSync(r,c.constants.F_OK),await l.shell.openPath(r)}catch(e){b.info("Failed to open file:",e),await(0,m.N0)({title:"Xmind",message:t("Failed to open this file link."),detail:t("Probably the location or name of this file/folder is changed."),buttons:[t("OK")],defaultId:0})}},g=(e,t)=>{var o;const{T:n}=(0,s.JE)(),{executeMutationAction:i,executePropertyAction:a,document:l,setActiveSheetId:r}=(0,p.nZ)(),c=e.replace("xmind:#",""),u=null===(o=l.value.query({id:c}))||void 0===o?void 0:o.asTopic();if(u){const e=l.value.query({id:t}).asTopic().ownerSheet,o=u.ownerSheet;e.id!==o.id&&r(o.id),i({name:"mutate:selectTopics",payload:{topics:[c],centerOn:!0}})}else{0===d.dialog.showMessageBoxSync({title:n("Invalid Topic Link"),message:n("The target topic may have been deleted. Do you want to delete this topic link as well?"),buttons:[n("Delete It"),n("No")],defaultId:0,cancelId:1})&&a({name:"mutateProperty:topicLink",inputValue:""})}}},38172:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>be});var n=o(2954),i=o(87141),a=o(45412),l=o(63111),r=o(27049),d=o(46016),s=o(12455),c=o(80356),u=o(84374),m=o(89411),p=o(53775);var v=o(71017),h=o.n(v),b=o(57310),I=o.n(b),g=o(63477),f=o.n(g),y=o(90435),w=o(54856),T=o(96829),S=o(13382),k=o(19741);function E(){const e=(0,k.y)(),t=(0,d.$)(),o=(0,m.FU)(),a=y.ZP.route((0,w.K3)(window.editorId),(async()=>{if((0,m.FU)().emptyEditorView)return{canceled:!1};const e=(0,s.A)(),t=(0,i.km)(),{activeSheetId:o,currentZoomScale:n,sheets:a}=(0,u.nZ)();t.updateLastViewStatuses({id:o.value,lastSheetIndex:a.value.findIndex((e=>e.id===o.value)),geometryStatus:{scale:n.value}}),await new Promise((e=>setTimeout(e,0)));const l=(0,m.FU)(),r=(0,s.A)().saving;if(l.isDirty||r){const t=await async function(){const e=(0,s.A)().saving,t=(0,i.JE)().T,o=t(e?"Continue to save":"Save"),n=t(e?"Don't save and Close":"Don't Save"),a=t(e?"File is saving":"Do you want to save the changes?"),l=t(e?"The file may be corrupted if you close it now.":"Your changes will be lost if you don't save them."),r=t("Cancel"),d=[];d.push(o,n,r);const[c]=await(0,S.N0)({type:"none",title:"Xmind",message:a,detail:l,buttons:d,defaultId:d.indexOf(o),cancelId:d.indexOf(r),noLink:!0});if(c==d.indexOf(n))return!0;if(c==d.indexOf(o)){if(e)return!1;return await A()}return!1}();return t&&(null==e||e.setAlive(!1),await l.close()),{canceled:!t}}return null==e||e.setAlive(!1),await l.close(),{}}));(0,n.bv)((()=>{e.registerCommands([{id:"save",provider:`editor/${window.editorId}`,enabledFn:()=>o.isDirty,handler:()=>{o.canSave()?A():F()}},{id:"saveAs",provider:`editor/${window.editorId}`,enabledFn:()=>t.isWorkbenchReady,handler:()=>{F()}},{id:"saveSheetAs",provider:`editor/${window.editorId}`,enabledFn:()=>t.isWorkbenchReady,handler:P}])})),(0,n.Jd)((()=>{e.unregisterCommands([{id:"save",provider:`editor/${window.editorId}`},{id:"saveAs",provider:`editor/${window.editorId}`},{id:"saveSheetAs",provider:`editor/${window.editorId}`}]),a()}))}async function A(){const e=(0,m.FU)(),{canSave:t}=(0,m.FU)(),o=(0,u.nZ)().document.value,n=o.metadataFor(u.aX.KnownMetaKey.DataStructureVersion)||"1";if(parseInt(n)<parseInt(u.aX.DocumentDataStructureVersion)){const e=(e,...t)=>(0,i.JE)().T(e,...t),t=await(0,S.yr)(e);if(t.toSave)return(0,u.nZ)().changeDoc((0,m.zw)(o)),await A(),!0;if(t.toSaveAs){return await F()}return!1}if(!t())return await F();await e.save();const{markDocumentSaved:a}=(0,u.nZ)();return a(),!0}async function F(){const{document:e}=(0,u.nZ)(),t=(0,m.FU)(),o=await t.getSaveAsHandlers();if(!o||!o.length)throw new Error("No save-as handlers available.");if(1===o.length)return await M((()=>o[0].prompt()));{const t=(0,m.FU)().source.startsWith("new://")||"new"===(0,m.FU)().protocolFrom,n=e.value.sheets[0].rootTopic;let i=(0,m.FU)().title;t&&(i=n.title);const{result:a}=await y.ZP.fetch(w.Fx,{name:"dialog-multiple-save-as",parentId:window.id,wait:!0,query:{availableSaveTypes:o.map((e=>e.type)).join(","),fileName:i}});if(!a||!a.type)return!1;const l=o.find((e=>e.type===a.type));return!!l&&(a.payload?await M((()=>l.prompt(a.payload))):await M((()=>l.prompt())))}}async function P(e){const{document:t}=(0,u.nZ)(),o=(0,i.JE)().T,n=t.value.sheets[e];if(!n)return;const a=n.rootTopic.title||"",l=await(0,S.ZZ)({title:"Save Sheet As",suggestPath:{suggestedName:a},filters:[{name:o("Xmind Workbook"),extensions:["xmind"]}]});if(!l)return!1;const r=l;return await(0,m.FU)().saveSheetAs(e,r),!0}async function M(e){const t=await e();if(!t)return!1;const o=(0,u.nZ)().document.value,n=o.metadataFor(u.aX.KnownMetaKey.DataStructureVersion)||"1";parseInt(n)<parseInt(u.aX.DocumentDataStructureVersion)&&(0,u.nZ)().changeDoc(o.asMutable().metadataFor(u.aX.KnownMetaKey.DataStructureVersion,u.aX.DocumentDataStructureVersion).commit());const i=(0,m.FU)(),a=i.source;await i.saveAs(t).then((()=>{(0,u.pk)().changeFile({id:i.fileId,stage:i.stage})})).catch((e=>i.handleOpenError(e)));const{markDocumentSaved:l,clearUndo:r}=(0,u.nZ)();return(null==a?void 0:a.startsWith("file:"))&&r(),l(),!0}var C=o(23352),O=o(7104),x=o(5893),R=o(18621),D=o(64805),Z=o(89019),L=o(60746),B=o(18264),N=o(67657),V=o(20993);const U=(0,C.ZP)("editor:fm");function _(){const e=(0,n.FN)().proxy;!function(){const e=(0,m.FU)();(0,n.bv)((()=>{e.fileId||((0,r.E)().updateEditorVisible(!1),e.waitInited().then((()=>{e.open().then((()=>{(0,u.pk)().changeFile({id:e.fileId,stage:e.stage})})).catch((t=>{e.handleOpenError(t).then((e=>{const{recovered:o=!1,prompted:n=!1}=e||{};if(!o){if(!n)return y.ZP.fetch(w.Fx,{name:"dialog-problem",payload:{name:"OpenError",message:t.message||t,stack:t.stack,code:"OPEN_FILE"}}).then((()=>{window.close()}));window.close()}}))}))})))}))}(),function(){const e=(0,m.FU)();window.addEventListener("focus",o);let t=!1;function o(){e.fileId&&(t||(0,s.A)().saving||(t=!0,e.heartbeatTest().then((e=>{setTimeout((()=>{t=!1}),0);const{shouldClose:n=!1}=e||{};n&&(window.removeEventListener("focus",o),y.ZP.fetch(w.s2,{editors:[window.editorId],forceQuit:!1}))}))))}(0,n.Jd)((()=>{window.removeEventListener("focus",o)}))}(),E();const t=(0,m.FU)();t.injectThumbnailGenerator({generateThumbnail:async function(e){var t;const o=(0,m.FU)(),{getSheetViewer:n,activeSheetId:i,document:a}=(0,u.nZ)(),l=o.lastThumbnail,r=n(e||i.value),d=r.getSheetFigure(),s=!(d&&!(null===(t=d.modelAttributes)||void 0===t?void 0:t.scopeTopicId)),c=a.value.sheets.find((t=>t.id===(e||i.value))).clone(),p=JSON.stringify(c).includes("全瀨體");let v;const h=42/26;try{if(p){const e=await r.exportSVGImage({padding:u.viewerKit.insetsOf(16),aspectRatio:h,maximumWidth:2100,maximumHeight:1300,opaqueBackground:!0,disableEmbedFonts:!0,useNewSheetFigure:s}),t=e.size,o=e.svg;if("yes"!==await Promise.race([y.ZP.fetch(w.Lk),new Promise((e=>setTimeout(e,2500)))]))return l;v=await Promise.race([y.ZP.fetch(w.Zm,{data:o,width:Math.round(t.width),height:Math.round(t.height)}),new Promise((e=>setTimeout(e,18e4)))])}else v=await r.exportRasterImage("png",{padding:u.viewerKit.insetsOf(16),aspectRatio:h,maximumWidth:2100,maximumHeight:1300,opaqueBackground:!0,useNewSheetFigure:s})}catch(e){U.info("generateThumbnail fail"+e)}if(v){const e=v.replace(/^data:image\/png;base64,/,"");return Buffer.from(e,"base64")}return l||Buffer.from("","base64")}});const o=[t.addFileEventHook("close",(e=>{"closed"===e&&(0,r.E)().updateEditorVisible(!1)})),t.addFileEventHook("save",(async e=>{if("presave"===e){const e=h().join((0,O.N8)(),window.editorId);let t=null;try{t=await(0,x.cs)(e)}catch(e){return void U.error((0,T.SC)(e))}t>l.tZ.FILE_SIZE&&y.ZP.fetch(w.Fx,{name:"dialog-progress",parentId:window.id,wait:!0,query:{type:"xmind",editorId:window.editorId}})}})),t.addFileEventHook("saveAs",(e=>{(0,m.FU)().source.startsWith("cloud://")&&"postsaveas"===e&&(0,c.C)().openUploadSuccessToast()})),t.addFileEventHook("saveSheet",(e=>{"postsavesheet"===e&&(0,R.L9)({eventCategory:"Save",eventAction:"saveSheet",eventValue:1})})),t.addFileEventHook("close",(e=>{if("closed"===e&&(0,R.L9)({eventCategory:"Quit",eventAction:"closeTab",eventValue:1}),"preclose"===e){const{source:e}=(0,m.FU)();if("new://workbook"===e){const{docBrowsingInfos:t,removeDocBrowsingInfo:o}=(0,i.km)(),n=null==t?void 0:t.find((({docURL:t})=>t===`${e}/${window.editorId}`));n&&o(n.docURL)}}})),t.addFileEventHook("open",(async t=>{"postopen"===t&&async function(){var t;const o=(0,r.E)(),s=(0,m.FU)(),v=(0,i.km)();o.updateMindMapCreated(!0),s.updateMemento(!0);let h=!1;const b=(0,n.YP)((0,u.nZ)().activeSheetFigure,(async()=>{const e=(0,u.nZ)().activeSheetViewer.value;if(e){const t="new://workbook"===s.source,o=v.docBrowsingInfos.find((({docURL:e})=>e===(t?`${E}/${window.editorId}`:s.source)));if(o){const{sheetId:t,selection:n,zoomScale:i,center:l,windowSize:r}=o,[d,s]=(0,N.getCurrentWindow)().getSize(),c=d===r.width&&s===r.height,m={selection:n,zoomScale:i,activeSheetId:t,center:l},{restoreBrowsingState:p,validateBrowsingState:h}=(0,u.pk)(),b=await h(m);b&&c?await p(b):(v.removeDocBrowsingInfo(t),a(e))}else a(e);h=!0,b()}}));(0,n.YP)((0,u.nZ)().activeSheetViewer,(async e=>{if(!h)return;e&&a(e);const{updateSheetRendering:t,sheetRenderingStartAt:o,sheetRendering:n}=(0,r.E)();if(n&&o){const e=(new Date).getTime()-o;e<l.oY&&await(0,T._v)(l.oY-e),t({sheetRendering:!1,sheetRenderingStartAt:null})}e.restoreViewportState()})),(0,n.YP)((0,u.nZ)().currentZoomScale,(e=>{if(null==e)return;const{activeSheetId:t}=(0,u.nZ)();(null==t?void 0:t.value)&&o.updateSheetStatus({id:t.value,zoomScale:100*e})})),(0,n.YP)((()=>v.isAutoBeginnerModeVisible),(e=>o.changeBeginnerModeVisible(e)));const g=3e5,k=(0,p.P2)((()=>{s.makeDocumentCache()}),g);(0,n.YP)((()=>(0,u.nZ)().document.value),(()=>{k()})),(0,n.YP)((()=>(0,B.U)().isFocusMissing),(e=>{var t;(0,d.$)().isOutlinerMode||e&&(null===(t=(0,u.nZ)().activeSheetViewer.value)||void 0===t||t.focus())}));v.hasShownTutorial||setTimeout((()=>{o.changeBeginnerDialogVisible(!0),(0,n.YP)((()=>v.hasShownTutorial),(e=>{e&&o.changeBeginnerDialogVisible(!1)}))}),1400);const E=s.source,A=E.startsWith("cloud://"),F=(0,i.JE)().T,P=s.docCompatibility;if(P===u.viewerKit.LayoutEngineIncompatibility.UnsupportedFeatures)await(0,S.R2)(F);else if(P===u.viewerKit.LayoutEngineIncompatibility.ObsoleteFeatures||P===u.viewerKit.LayoutEngineIncompatibility.Undetermined){if(await(0,S.W5)(e),A){const e=(0,n.YP)((()=>(0,u.nZ)().document.value),(t=>{e(),(0,u.nZ)().changeDoc((0,m.zw)(t))}),{immediate:!1})}else s.changeDirty(!0);s.updateMemento(!1)}const M=I().parse(E),C=f().parse(M.query).template||"default";if("new:"===M.protocol&&"host.xmind.app"===M.hostname){const e=`cloud://host.xmind.app/${s.fileId}`;await s.saveAs(e).then((()=>{(0,u.pk)().changeFile({id:s.fileId,stage:s.stage})})).catch((e=>s.handleOpenError(e)))}if("new:"===M.protocol&&"default"===C){const e=(0,n.YP)((0,u.nZ)().activeSheetViewerInited,(t=>{if(t){const t=(0,n.YP)((()=>(0,u.nZ)().selection.value),(e=>{e.modelIds.length>0&&((0,d.$)().updateRightBarPanel({visible:!0,panel:D.QN.THEME,tab:D.x9.MAP}),t())}));e()}}))}const O=(await s.stage.getDocument()).sheets;if(O.length>0){const e=v.lastViewStatuses.find((e=>O.find((t=>t.id===e.id))));(0,u.nZ)().setInitialSheetId((null==e?void 0:e.id)||O[0].id)}document.addEventListener("mousedown",(e=>{var t,o;if((0,d.$)().editorMode===l.hO){if(null===(o=null===(t=e.target)||void 0===t?void 0:t.classList)||void 0===o?void 0:o.contains("uk-pop-overlay"))return;const n=(0,u.nZ)().activeSheetViewer.value;if(n&&n.includesNode(e.target))return;if(Array.from(document.querySelectorAll(".keep-edit-session")).some((t=>t.contains(e.target))))return;(0,u.nZ)().executeAction({name:"mutate:interruptingEditSession"})}})),(null===(t=(0,Z.c)().cloudFileMeta)||void 0===t?void 0:t.isStaticShare)&&(0,c.C)().openFetchStaticShareFileSuccessToast();(0,Z.c)().isRestoring&&((0,c.C)().openRestoredSnapshotToast(),(0,Z.c)().setIsRestoring(!1));"duplicate"===(0,Z.c)().sourceFrom&&(0,c.C)().openFileDuplicatedToast();const x=await y.ZP.fetch((0,w.gk)(window.editorId));await y.ZP.fetch(w.pO,{planPayload:{...x},winId:window.id})}()}))];function a(e){var t,o;if(!(null==e?void 0:e.sheetId))return;const n=e.sheetId,a=function(){var e,t,o;const{activeSheetId:n}=(0,u.nZ)(),{initialZoomLevel:a}=(0,i.S)(),l=null===(e=(0,r.E)().sheetStatuses)||void 0===e?void 0:e[n.value];return(null!==(o=null!==(t=null==l?void 0:l.suggestedZoomScale)&&void 0!==t?t:null==l?void 0:l.zoomScale)&&void 0!==o?o:(0,L.GI)(a))/100}(),l=null!==(t=e.getZoomScale())&&void 0!==t?t:1,d=null!==(o=e.getViewerCenter())&&void 0!==o?o:{x:0,y:0};a!==l&&(e.centerOn(d,a),e.changeZoomScale(a)),(0,r.E)().updateSheetStatus({id:n,zoomScale:100*a})}(0,n.YP)((()=>(0,s.A)().saving),(e=>{e||y.ZP.fetch(w.g_,{name:"dialog-progress"}).catch((()=>U.warn("Close process dialog failed.")))})),(0,n.YP)((()=>(0,i.S)().cjkFontFamily),(e=>{const{changeDefaultCJKFontFamily:t}=(0,u.nZ)();t(e)}),{immediate:!0}),(0,n.YP)((()=>(0,i.S)().shouldShowGuidelineForMovingTopics),(e=>{const{setShouldShowGuidelineForMovingTopics:t}=(0,u.nZ)();t(e),e?(0,V.cx)():(0,V.Xz)()}),{immediate:!0}),(0,n.Jd)((()=>{o.forEach((e=>e()))})),window.canPreformUIkitMutationObserver=({target:e})=>{var t;return!(e&&e instanceof Element)||!(null===(t=(0,u.nZ)().activeSheetViewer.value)||void 0===t?void 0:t.includesNode(e))}}var q=o(94593);const H=(0,C.ZP)("editor:fm");async function K(){const e=(0,i.km)(),t=(0,m.FU)(),{activeSheetId:o}=(0,u.nZ)(),n=e.recentlyOpenedItems,a=t.source;if(!a.startsWith("file://"))return;let l=null;if(!a)return;const r=n.find((e=>e.source===a));let d=t.lastThumbnail;const s=t.thumbnailGenerator;if((null==d||0===d.byteLength)&&s)try{d=await s.generateThumbnail(o.value)}catch(e){H.error("Export thumbnail failed when update recent",(0,T.SC)(e))}if(d){l=r&&r.previewUrl&&r.previewUrl.endsWith("png")?r.previewUrl:`recent/${(0,T.hb)()}.png`;try{await q.Z.ensureDir(h().join((0,O.D8)(),"recent")),await q.Z.writeFile(h().join((0,O.D8)(),l),Buffer.from(d))}catch(e){H.warn("something wrong when save recent preview img to appData directory",e)}}e.appendRecentlyOpenedItem({source:a,timestamp:(new Date).getTime(),previewUrl:l||r&&r.previewUrl})}var J=o(85786);var W=o(83063),$=o(31621);const Y=()=>{const{document:e,syncedProperties:t,installTopicImageHandler:o,installClickLabelHandler:n,installClickNotesHandler:a,installClickMarkerHandler:l,installTopicWebVideoHandler:s,installClickTopicInfoHandler:c,installClickTaskInfoHandler:m,installCheckTaskButtonHandler:p}=(0,u.nZ)(),{T:v}=(0,i.JE)(),{setPopoverEditorVisible:h}=(0,d.$)(),{handleCommand:b}=(0,i.JX)();n((()=>{h("label")})),m((()=>{})),p((e=>{(0,V.fR)(e.checked?"checkTask":"uncheckTask")})),a((e=>{var o,n;if(!(null==e?void 0:e.topicId))return;"block"===(null===(n=null===(o=t.value)||void 0===o?void 0:o.topicNotesDisplay)||void 0===n?void 0:n.value)&&b("editor.showNotesEditor")})),o((async o=>{var n,i;if(!o||!(null==t?void 0:t.value))return;const a=null===(i=null===(n=t.value)||void 0===n?void 0:n.equation)||void 0===i?void 0:i.value,l=null==a?void 0:a.text,r=e.value.query({id:o.topicId}).asTopic();l?b("editor.showEquationEditor"):(null==r?void 0:r.imageSource)&&b("editor.previewImage",{topicId:o.topicId})})),l((e=>{if(!e)return;const t=e.markerId;t&&b("editor.showMarkerPopup",t)})),s((e=>{var t;const o=null===(t=null==e?void 0:e.webVideo)||void 0===t?void 0:t.embedUrl;o&&b("videoViewer",{url:o})})),c((t=>{if(!t)return;const{infoItemType:o,topicId:n}=t,i=e.value.query({id:n}).asTopic(),{title:a,href:l}=i;if("note"===o)h("notes");else if("topic-link"===o){if(!l)return;(0,$.S)(l,n)}else if("file-link"===o){if(!l)return;(0,$.U)(l)}else if("web-link"===o){if(!l)return;(0,J.DL)(l,v)}else if("attachment"===o){if(!a||!l)return;(0,W.F)(a,l)}else"audio-note"===o?(e=>{const{audioRecording:t,updateAudioBarMode:o,audioBarMode:n}=(0,r.E)();if(t)return;o({audioBarMode:"open_new_audio_play"===n?"audio_play":"open_new_audio_play",audioTopicId:e,audioAutoplay:!0})})(n):"multiple"===o&&h("informationcard")}))};var z=o(57507),X=o(67214);function j(e,t=!1){var o,n,a,l;const r={};if("separator"===e.type)return Object.assign({},e);r.click=e.click||function(){void 0!==e.arg?(0,i.JX)().handleCommand(e.commandId,e.arg):(0,i.JX)().handleCommand(e.commandId)};const d=null!==(o=(0,i.JX)().commandById(e.commandId))&&void 0!==o?o:null===(n=(0,s.A)())||void 0===n?void 0:n.commandById(e.commandId),c=d&&d.enabled;r.enabled=e.enabled||!!c||!1,r.label=null!==(l=null!==(a=e.label)&&void 0!==a?a:null==d?void 0:d.label)&&void 0!==l?l:"",e.interactive&&(r.label=r.label+"..."),r.accelerator=(0,i.f7)().formarKeybindingForMenu(e.accelerator||(0,i.f7)().keybindingByCommandId(e.commandId));const u=e.submenu&&((m=e.submenu)&&m.filter((e=>!function(e){return"---"===e||e&&"separator"===e.type}(e))).every(Q));var m;r.submenu=e.submenu&&e.submenu.map((e=>j(e,u))),e.id&&(r.id=e.id);const p=(0,s.A)().contexts["activation.isValid"],v=Q(e),b="dark"===(0,i.S)().appearance?"static/assets/images/pro/menu-pro-small-dark@2x.png":"static/assets/images/pro/menu-pro-small@2x.png";return p||t||!v&&!u||(r.icon=h().join((0,O.bY)(),b)),r}function Q(e){return l.TK.includes(e.commandId)&&!l.WK.includes(e.commandId)}function G(e,t){return e in t?e:t.length>0?t[0]:""}const ee={validateTargetIsCallout:function(e,t,o){var n;const i=G(e.id,t);if(!i)return;return(null===(n=o.query({id:i}))||void 0===n?void 0:n.asTopic().topicType)===u.viewerKit.TopicType.Callout},getSelectedTopicInfo:function(e,t){const o=[],n=[];return e.forEach((e=>{const i=t.query({id:e}).asTopic();o.push(i),n.push(i.topicType)})),{selectedTopicList:o,selectedTopicTypeList:n}},validateIsIncludeMain:function(e,t){for(const o of e){const e=t.query({id:o}).asTopic();if(e.topicType===u.viewerKit.TopicType.Attached&&e.parentTopic.topicType===u.viewerKit.TopicType.Root)return!0}return!1},getTargetBranchByTopic:function(e,t,o){var n;const i=G(e.id,t);if(i)return null===(n=o.query({id:i}))||void 0===n?void 0:n.asTopic()},getContentOnEquation:function(e,t,o){var n;const i=G(e.topicId,t);if(!i)return;const a=o.query({id:i}).asTopic();if(a.imageIsMathJaxImage){const e=a.extensionBy(u.o9.Equation);return null===(n=null==e?void 0:e.content)||void 0===n?void 0:n.content}},getEmbedUrlOnWebVideo:function(e,t,o){var n;const i=G(e.topicId,t);if(!i)return;const a=o.query({id:i}).asTopic().extensionBy(u.o9.WebVideo);return null===(n=null==a?void 0:a.content)||void 0===n?void 0:n.embedUrl},getMarkerInfo:function(e,t){if(!G(e.topicId,t))return;const o=e.id;if(!o)return;const{markerModule:n}=(0,u.nZ)();return{markerId:o,isMissingMarker:!n.getMarkerInfoById(o)}},getLabelInfo:function(e,t,o){const n=G(e.topicId,t);if(!n)return;const i=e.label,a=o.query({id:n}).asTopic().labels.filter((e=>e!==i)).join(",");return{selectedLabel:i,resultLabelJoinedStringForDelete:a}},getTodoInfo:function(e,t,o){var n;const i=G(e.topicId,t);if(!i)return;const a=null===(n=o.query({id:i}))||void 0===n?void 0:n.asTopic();if(!a)return;return{status:1===a.taskProgress?"done":"todo"}},getInfoButtonType:function(e,t){var o;const n=G(e.topicId,t);if(!n)return;const{activeSheetViewer:i}=(0,u.nZ)();return null===(o=i.value)||void 0===o?void 0:o.getInfoItemTypeForTopicById(n)},validateIsFolderLink:function(e,t,o){var n;const i=G(e.topicId,t);if(!i)return;const a=null===(n=o.query({id:i}))||void 0===n?void 0:n.asTopic(),l="file:";let r=!1;if(a.href&&a.href.startsWith(l)){const e=a.href.slice(5);try{r=q.Z.isDirectorySync(e)}catch(e){}}return r},getTopicIdByInfoButton:function(e,t,o){var n;const i=G(e.topicId,t);if(!i)return;const a=null===(n=o.query({id:i}))||void 0===n?void 0:n.asTopic();return null==a?void 0:a.id},getImagePreviewData:async function(e,t,o){const n=G(e.topicId,t);if(!n)return;const i=o.query({id:n}).asTopic();if(!i)return;const a=await(0,u.nZ)().getResourceUrlByXapUrl(i.imageSource);return{imageUrl:a,imageSize:await(0,X.N8)(a),title:i.title||"",winId:(0,N.getCurrentWindow)().id}}};var te=o(40623);const{TopicType:oe}=u.viewerKit;function ne(e){if(!0!==e.hideOnDisabled)return!0;if(Object.keys(e).includes("enabled"))return e.enabled;const t=(0,i.JX)().commandById(e.commandId);return!!t&&t.enabled}function ie(e){return!0}function ae(e){return!(0,m.FU)().source.startsWith("cloud://")||!l.gY.includes(e.commandId)}const le="editor.toggleBranchOnly";function re(e){if(e.commandId===le&&void 0!==e.arg){let t=e.arg;for(;t&&t.topicType!==oe.Root;){if(t.topicType===oe.Callout)return!1;if(t.topicType===oe.Summary)return!1;t=t.parentTopic}}return!0}function de(e,t,o,n,a){const l=(0,i.JE)().T,{activeSheet:r}=(0,u.nZ)(),d=r.value.rootTopic.structureClass,s=![te.vP.SPREADSHEET,te.vP.COLUMNSPREADSHEET,te.vP.TREETABLE,te.vP.TOPTITLETREETABLE].includes(d),c=[{commandId:"editor.showHyperlinkEditor",label:l("Webpage")},{commandId:"editor.showTopiclinkEditor",label:l("Topic")},{commandId:"editor.addFileLink",label:l("Local File"),hideOnMAS:!0},{commandId:"editor.addFolderLink",label:l("Local Folder"),hideOnMAS:!0}].filter(ie).filter(ae),m=[{commandId:"editor.addTodo",label:l("To-do")}],p=[{commandId:"editor.showNotesEditor",label:l("Note")},{commandId:"editor.showLabelEditor",label:l("Label")},{submenu:m,label:l("Task"),enabled:!0},{submenu:c,label:l("Link(noun)"),enabled:!0},{type:"separator"},{commandId:"editor.addAttachmentOnNewTopic",label:l("Attachment")},{commandId:"editor.addAudioOnNewTopic",label:l("Audio Note")},{type:"separator"},{commandId:"workbench.toggleMarkerPanel",label:l("Marker")},{commandId:"workbench.toggleStickerPanel",label:l("Sticker")},{commandId:"workbench.toggleIllustrationPanel",label:l("Illustration")},{commandId:"editor.addLocalImage",label:l("Local Image")},{commandId:"editor.showEquationEditor",label:l("Equation")}].filter(ae),v=[{commandId:"editor.removeMarker",label:l("Marker"),hideOnDisabled:!0},{commandId:"editor.removeLabel",label:l("Label"),hideOnDisabled:!0},{commandId:"editor.removeTodo",label:l("Task"),hideOnDisabled:!0},{commandId:"editor.removeLink",label:l("Link"),hideOnDisabled:!0}].filter(ne),h=[{commandId:"editor.clearText",label:l("Clear Text"),hideOnDisabled:!0},{commandId:"editor.removeMarkerForTopicContextMenu",label:l("Remove Marker"),hideOnDisabled:!0},{commandId:"editor.removeLabelForTopicContextMenu",label:l("Remove Label"),hideOnDisabled:!0},{commandId:"editor.removeTodoForTopicContextMenu",label:l("Remove Task"),hideOnDisabled:!0},{commandId:"editor.removeLinkForTopicContextMenu",label:l("Remove Link"),hideOnDisabled:!0},{submenu:v,commandId:"editor.removeTopicContent",label:l("Remove"),hideOnDisabled:!0}],b=(null==a?void 0:a.topicType)===oe.Summary?[{commandId:"selectAllSummaryTopics",label:l("All Summaries")},{commandId:"selectAllDescendantTopics",label:l("All Subtopics")},{type:"separator"},{commandId:"selectAll",label:l("Select All")}]:(null==a?void 0:a.topicType)===oe.Detached?[{commandId:"selectAllFloatingTopics",label:l("All Floating Topics")},{commandId:"selectAllDescendantTopics",label:l("All Subtopics")},{type:"separator"},{commandId:"selectAll",label:l("Select All")}]:(null==a?void 0:a.topicType)===oe.Root?[{commandId:"selectAllDescendantTopics",label:l("All Subtopics")},{type:"separator"},{commandId:"selectAll",label:l("Select All")}]:[{commandId:"selectAllDescendantTopics",label:l("All Subtopics")},{commandId:"selectAllSiblingTopics",label:l("All Siblings")},{commandId:"selectAllSameLevelTopics",label:l("All Same Level Topics")},{type:"separator"},{commandId:"selectAll",label:l("Select All")}],I=[{commandId:"workbench.exportBranchPng",label:l("PNG"),interactive:!0},{commandId:"workbench.exportBranchSvg",label:l("SVG"),interactive:!0},{commandId:"workbench.exportBranchPdf",label:l("PDF"),interactive:!0},{commandId:"workbench.exportBranchMd",label:l("Markdown"),arg:{selectedTopicList:t},interactive:!0}],g=[{commandId:"editor.alignTopicsToLeft",label:l("Left")},{commandId:"editor.alignTopicsToCenter",label:l("Center")},{commandId:"editor.alignTopicsToRight",label:l("Right")},{type:"separator"},{commandId:"editor.alignTopicsToTop",label:l("Top")},{commandId:"editor.alignTopicsToMiddle",label:l("Middle")},{commandId:"editor.alignTopicsToBottom",label:l("Bottom")},{type:"separator"},{commandId:"editor.distributeTopicsHorizontally",label:l("Distribute Horizontally")},{commandId:"editor.distributeTopicsVertically",label:l("Distribute Vertically")}],f=[{commandId:"delete",label:l("Delete")},...h,{type:"separator"},{commandId:"editor.copyStyle",label:l("Copy Style")},{commandId:"editor.pasteStyle",label:l("Paste Style")},{commandId:"editor.resetStyle",label:l("Reset Style")},{type:"separator"},{commandId:"selectAllCalloutTopics",label:l("Select All Callouts")}],y=[{submenu:p,label:l("Insert"),enabled:!0},{type:"separator"},{commandId:"cut",label:l("Cut"),hideOnIncludeSummary:!0},{commandId:"copy",label:l("Copy"),hideOnIncludeSummary:!0},{commandId:"paste",label:l("Paste"),hideOnIncludeSummary:!0},{commandId:"duplicate",label:l("Duplicate"),hideOnIncludeSummary:!0},{type:"separator"},{commandId:"delete",label:l("Delete")},{commandId:"deleteSingleTopic",label:l("Delete Single Topic"),hideOnIncludeSummary:!0},...h,{type:"separator"},{commandId:"editor.checkTodo",label:l("Mark as Completed"),hideOnDisabled:!0},{commandId:"editor.uncheckTodo",label:l("Mark as Uncompleted"),hideOnDisabled:!0},{commandId:"editor.cancelTask",label:l("Mark as Canceled"),hideOnDisabled:!0},{type:"separator"},{commandId:"editor.copyStyle",label:l("Copy Style")},{commandId:"editor.pasteStyle",label:l("Paste Style")},{commandId:"editor.resetStyle",label:l("Reset Style")},{type:"separator"},{submenu:b,label:l("Select"),enabled:!0},{type:"separator"},{commandId:"editor.toggleBranch",hideOnIncludeRoot:!0},{commandId:"editor.toggleAllBranch"},{type:"separator",hideOnIncludeRoot:!0},{submenu:I,label:l("Export Branch To"),hideOnIncludeRoot:!0,enabled:s},{commandId:"printBranch",label:l("Print Branch"),hideOnIncludeRoot:!0,interactive:!0},{type:"separator",hideOnIncludeRoot:!0},{commandId:le,hideOnIncludeRoot:!0,arg:a},{type:"separator",hideOnIncludeRoot:!0},{submenu:g,id:"align",label:l("Align Floating Topic"),enabled:!0},{commandId:"editor.newSheetFromTopic",label:l("New Sheet From Topic")},{type:"separator",showOnIncludeMain:!0},{commandId:"editor.resetPosition",label:l("Reset Position"),showOnIncludeMain:!0}];return e?f.filter(ne):y.filter(ne).filter((e=>function(e,t){return!Object.keys(e).includes("hideOnIncludeSummary")||(t.includes(oe.Summary)?!e.hideOnIncludeSummary:!!e.hideOnIncludeSummary)}(e,o))).filter((e=>function(e,t){return!Object.keys(e).includes("hideOnIncludeRoot")||(t.includes(oe.Root)?!e.hideOnIncludeRoot:!!e.hideOnIncludeRoot)}(e,o))).filter((e=>function(e,t){return!Object.keys(e).includes("showOnIncludeMain")||e.showOnIncludeMain&&t}(e,n))).filter(re)}function se(e){return!(0,m.FU)().source.startsWith("cloud://")||!l.gY.includes(e.commandId)}function ce(e,t,o){const n=(0,i.JE)().T,a=[{commandId:"editor.editInfoItem",label:n("Edit")},{type:"separator"},{commandId:"editor.removeNote",label:n("Delete")},{type:"separator"},{commandId:"editor.toggleTopicNotesDisplay",label:n("Display"),arg:"block"},{commandId:"workbench.showNoteNavigationPanelAndSelect",label:n("View All Notes"),arg:o}],l=[{commandId:"editor.removeAudioNotes",label:n("Delete")},{type:"separator"},{commandId:"editor.saveAsAudioNote",label:n("Save As")}],r=[{commandId:"editor.removeAttachment",label:n("Delete")},{type:"separator"},{commandId:"editor.saveAsAttachment",label:n("Save As")}],d=[{commandId:"editor.addFileLink",label:n("Edit"),hideOnIsFolderLink:!0},{commandId:"editor.addFolderLink",label:n("Edit"),hideOnIsFolderLink:!1},{commandId:"editor.removeLink",label:n("Delete")}].filter((e=>function(e,t){return!Object.keys(e).includes("hideOnIsFolderLink")||(t?!e.hideOnIsFolderLink:!!e.hideOnIsFolderLink)}(e,t))).filter(se),s=[{commandId:"editor.showTopiclinkEditor",label:n("Edit")},{type:"separator"},{commandId:"editor.removeLink",label:n("Delete")}],c=[{commandId:"editor.editInfoItem",label:n("Edit")},{type:"separator"},{commandId:"editor.removeLink",label:n("Delete")}];switch(e){case u.viewerKit.InfoItemType.Multiple:return[];case u.viewerKit.InfoItemType.Note:return a;case u.viewerKit.InfoItemType.AudioNote:return l;case u.viewerKit.InfoItemType.Attachment:return r;case u.viewerKit.InfoItemType.FileLink:return d;case u.viewerKit.InfoItemType.TopicLink:return s;case u.viewerKit.InfoItemType.WebLink:return c;default:return[]}}function ue(){const{installContextMenuHandler:e}=(0,u.nZ)();e((e=>{var t;if("map"!==e.type)return;if(null!==e.viewerState.pointerTarget)return;const o=t=>{if((null==t?void 0:t.length)>0)return;const o=function(e){const t=(0,i.JE)().T,o=[{commandId:"selectAllFloatingTopics",label:t("All Floating Topics")},{commandId:"selectAllRelationships",label:t("All Relationships")},{commandId:"selectAllSummaryTopics",label:t("All Summaries")},{commandId:"selectAllBoundaries",label:t("All Boundaries")},{commandId:"selectAllImages",label:t("All Images")},{commandId:"selectAllEquations",label:t("All Equations")},{commandId:"selectAllCalloutTopics",label:t("All Callouts")},{type:"separator"},{commandId:"selectAll",label:t("Select All")}];return[{label:t("Paste"),commandId:"paste",arg:{payload:{targetPoint:e}}},{type:"separator"},{commandId:"editor.preAddFloatingTopic",label:t("Insert Floating Topic")},{commandId:"editor.addRelationship",label:t("Insert Relationship")},{type:"separator"},{commandId:"editor.toggleAllBranch"},{type:"separator"},{commandId:"editor.focusAndSelectCenter",label:t("Go to Central Topic")},{submenu:o,label:t("Select"),enabled:!0}]}(e.contextMenuRequest.locationInContent).map((e=>j(e)));(0,z.k)(o,e.location)},{selection:n}=(0,u.nZ)();"none"!==(null===(t=n.value)||void 0===t?void 0:t.type)?me(n,o):o([])})),e((e=>{var t,o;if("topic"!==e.type)return;const n=e.viewerState.pointerTarget;if("topic"!==(null==n?void 0:n.kind))return;const i=t=>{if(!(null==t?void 0:t.includes(n.id)))return;const o=ee.validateTargetIsCallout(n,t,e.sheet),i=ee.getSelectedTopicInfo(t,e.sheet);if(!i)return;const{selectedTopicList:a,selectedTopicTypeList:l}=i,r=de(o,a,l,ee.validateIsIncludeMain(t,e.sheet),ee.getTargetBranchByTopic(n,t,e.sheet)).map((e=>j(e)));(0,z.k)(r,e.location)},{selection:a}=(0,u.nZ)(),l=u.viewerKit.selectedTopicsFrom(e.viewerState.selection);"topic"!==(null===(t=a.value)||void 0===t?void 0:t.type)||(null===(o=a.value)||void 0===o?void 0:o.modelIds[0])!==l[0]?me(a,i):i(l)})),e((e=>{var t,o,n;if("boundary"!==e.type)return;const a=e.viewerState.pointerTarget;if("boundary"!==(null==a?void 0:a.kind))return;const l=t=>{if(!(null==t?void 0:t.includes(a.id)))return;const o=function(){const e=(0,i.JE)().T;return[{commandId:"editor.showEditBox",label:e("Edit")},{commandId:"delete",label:e("Delete")},{type:"separator"},{commandId:"editor.copyStyle",label:e("Copy Style")},{commandId:"editor.pasteStyle",label:e("Paste Style")},{commandId:"editor.resetStyle",label:e("Reset Style")},{type:"separator"},{commandId:"selectAllBoundaries",label:e("Select All Boundaries")}]}().map((e=>j(e)));(0,z.k)(o,e.location)},{selection:r}=(0,u.nZ)();"textInput"===e.viewerState.focus?pe(r,l):"boundary"!==(null===(t=r.value)||void 0===t?void 0:t.type)||(null===(o=r.value)||void 0===o?void 0:o.modelIds[0])!==a.id?me(r,l):l(null===(n=r.value)||void 0===n?void 0:n.modelIds)})),e((e=>{var t,o,n;if("relationship"!==e.type)return;const a=e.viewerState.pointerTarget;if("relationship"!==(null==a?void 0:a.kind))return;const l=t=>{if(!(null==t?void 0:t.includes(a.id)))return;const o=function(){const e=(0,i.JE)().T;return[{commandId:"editor.showEditBox",label:e("Edit")},{commandId:"delete",label:e("Delete")},{type:"separator"},{commandId:"editor.copyStyle",label:e("Copy Style")},{commandId:"editor.pasteStyle",label:e("Paste Style")},{commandId:"editor.resetStyle",label:e("Reset Style")},{type:"separator"},{commandId:"editor.resetRelationshipPointPositions",label:e("Reset Point Position")},{type:"separator"},{commandId:"selectAllRelationships",label:e("Select All Relationships")}]}().map((e=>j(e)));(0,z.k)(o,e.location)},{selection:r}=(0,u.nZ)();"textInput"===e.viewerState.focus?pe(r,l):"relationship"!==(null===(t=r.value)||void 0===t?void 0:t.type)||(null===(o=r.value)||void 0===o?void 0:o.modelIds[0])!==a.id?me(r,l):l(null===(n=r.value)||void 0===n?void 0:n.modelIds)})),e((e=>{var t,o;if("image"!==e.type)return;const n=e.viewerState.pointerTarget;if("image"!==(null==n?void 0:n.kind))return;const a=async t=>{if(!(null==t?void 0:t.includes(n.topicId)))return;const o=function(e,t,o){const n=(0,i.JE)().T,a=[{commandId:"editor.showEquationEditor",label:n("Edit")},{type:"separator"},{commandId:"cut",label:n("Cut"),arg:{payload:{equation:e}}},{commandId:"copy",label:n("Copy"),arg:{payload:{equation:e}}},{commandId:"delete",label:n("Delete")},{type:"separator"},{commandId:"editor.saveAsEquation",label:n("Save As")},{type:"separator"},{commandId:"editor.resizeEquation",label:n("Reset Size")},{type:"separator"},{commandId:"selectAllEquations",label:n("Select All Equations")}],l=[{commandId:"cut",label:n("Cut")},{commandId:"copy",label:n("Copy")},{commandId:"delete",label:n("Delete")},{type:"separator"},{commandId:"videoViewer",label:n("Play"),arg:{url:t}},{type:"separator"},{commandId:"editor.resetImage",label:n("Reset Size")}],r=[{commandId:"editor.previewImage",label:n("Preview"),arg:{topicId:o}},{type:"separator"},{commandId:"cut",label:n("Cut")},{commandId:"copy",label:n("Copy")},{commandId:"delete",label:n("Delete")},{type:"separator"},{commandId:"editor.saveAsImage",label:n("Save As")},{type:"separator"},{commandId:"editor.rotateImageLeft",label:n("Rotate Left")},{commandId:"editor.resetImage",label:n("Reset Size")},{type:"separator"},{commandId:"selectAllImages",label:n("Select All Images")}];return e?a:t?l:r}(ee.getContentOnEquation(n,t,e.sheet),ee.getEmbedUrlOnWebVideo(n,t,e.sheet),t[0]).map((e=>j(e)));(0,z.k)(o,e.location)},{selection:l}=(0,u.nZ)(),r=u.viewerKit.selectedTopicsFrom(e.viewerState.selection);"image"!==(null===(t=l.value)||void 0===t?void 0:t.type)||(null===(o=l.value)||void 0===o?void 0:o.modelIds[0])!==r[0]?me(l,a):a(r)})),e((e=>{var t,o;if("marker"!==e.type)return;const n=e.viewerState.pointerTarget;if("marker"!==(null==n?void 0:n.kind))return;const a=t=>{if(!(null==t?void 0:t.includes(n.topicId)))return;const o=ee.getMarkerInfo(n,t);if(!o)return;const{markerId:a,isMissingMarker:l}=o,r=function(e,t){const o=(0,i.JE)().T,n=[{commandId:"editor.deleteMarker",label:o("Delete"),arg:{value:e}}],a=[{commandId:"editor.showMarkerPopup",label:o("Edit"),arg:e},{type:"separator"},{commandId:"cut",label:o("Cut"),arg:{payload:{markerId:e}}},{commandId:"copy",label:o("Copy"),arg:{payload:{markerId:e}}},{commandId:"editor.deleteMarker",label:o("Delete"),arg:{value:e}},{type:"separator"},{commandId:"workbench.showMarkerNavigationPanelAndSelect",label:o("Highlight Relevant Topics"),arg:e}];return t?n:a}(a,l).map((e=>j(e)));(0,z.k)(r,e.location)},{selection:l}=(0,u.nZ)(),r=u.viewerKit.selectedTopicsFrom(e.viewerState.selection);"topic"!==(null===(t=l.value)||void 0===t?void 0:t.type)||(null===(o=l.value)||void 0===o?void 0:o.modelIds[0])!==r[0]?me(l,a):a(r)})),e((e=>{var t,o;if("label"!==e.type)return;const n=e.viewerState.pointerTarget;if("label"!==(null==n?void 0:n.kind))return;const a=t=>{if(!(null==t?void 0:t.includes(n.topicId)))return;const o=ee.getLabelInfo(n,t,e.sheet);if(!o)return;const{selectedLabel:a,resultLabelJoinedStringForDelete:l}=o,r=function(e,t){const o=(0,i.JE)().T;return[{commandId:"editor.removeLabel",label:o("Delete"),arg:{value:t}},{type:"separator"},{commandId:"workbench.showLabelNavigationPanelAndSelect",label:o("Highlight Relevant Topics"),arg:e}]}(a,l).map((e=>j(e)));(0,z.k)(r,e.location)},{selection:l}=(0,u.nZ)(),r=u.viewerKit.selectedTopicsFrom(e.viewerState.selection);"topic"!==(null===(t=l.value)||void 0===t?void 0:t.type)||(null===(o=l.value)||void 0===o?void 0:o.modelIds[0])!==r[0]?me(l,a):a(r)})),e((e=>{var t,o;if("infoButton"!==e.type)return;const n=e.viewerState.pointerTarget;if("info-button"!==(null==n?void 0:n.kind))return;const i=t=>{if(!(null==t?void 0:t.includes(n.topicId)))return;const o=ce(ee.getInfoButtonType(n,t),ee.validateIsFolderLink(n,t,e.sheet),ee.getTopicIdByInfoButton(n,t,e.sheet)).map((e=>j(e)));(0,z.k)(o,e.location)},{selection:a}=(0,u.nZ)(),l=u.viewerKit.selectedTopicsFrom(e.viewerState.selection);"topic"!==(null===(t=a.value)||void 0===t?void 0:t.type)||(null===(o=a.value)||void 0===o?void 0:o.modelIds[0])!==l[0]?me(a,i):i(l)})),e((e=>{var t,o,n,a;if("task-button"!==e.type)return;const l=e.viewerState.pointerTarget;if("task-button"!==(null==l?void 0:l.kind))return;const r=t=>{if(!(null==t?void 0:t.includes(l.topicId)))return;const o=function(e){const t=(0,i.JE)().T;return[{commandId:"editor.removeTodo",label:t("Delete")},{commandId:"editor.cancelTask",label:t("Mark as Canceled")},{type:"separator"},{commandId:"workbench.showTaskNavigationPanelAndSelect",label:"done"===(null==e?void 0:e.status)?t("Highlight Completed Task"):t("Highlight Uncompleted Task"),arg:e}]}(ee.getTodoInfo(l,t,e.sheet)).map((e=>j(e)));(0,z.k)(o,e.location)},{selection:d,document:s}=(0,u.nZ)(),c=null===(o=s.value.query({id:null===(t=d.value)||void 0===t?void 0:t.modelIds[0]}))||void 0===o?void 0:o.asTopic();if(!("todo-checkbox"===(null==c?void 0:c.taskPresentation)||"todo-progress"===(null==c?void 0:c.taskPresentation)))return;const m=u.viewerKit.selectedTopicsFrom(e.viewerState.selection);"topic"!==(null===(n=d.value)||void 0===n?void 0:n.type)||(null===(a=d.value)||void 0===a?void 0:a.modelIds[0])!==m[0]?me(d,r):r(m)})),e((e=>{var t,o;if("notes"!==e.type)return;const n=e.viewerState.pointerTarget;if("notes"!==(null==n?void 0:n.kind))return;const a=t=>{if(!(null==t?void 0:t.includes(n.topicId)))return;const o=function(e){const t=(0,i.JE)().T;return[{commandId:"editor.showNotesEditor",label:t("Edit")},{type:"separator"},{commandId:"editor.removeNote",label:t("Delete")},{type:"separator"},{commandId:"editor.toggleTopicNotesDisplay",label:t("Hide"),arg:"icon"},{commandId:"workbench.showNoteNavigationPanelAndSelect",label:t("View All Notes"),arg:e}]}(n.topicId).map((e=>j(e)));(0,z.k)(o,e.location)},{selection:l}=(0,u.nZ)(),r=u.viewerKit.selectedTopicsFrom(e.viewerState.selection);"topic"!==(null===(t=l.value)||void 0===t?void 0:t.type)||(null===(o=l.value)||void 0===o?void 0:o.modelIds[0])!==r[0]?me(l,a):a(r)}))}const me=(e,t)=>{const o=(0,n.YP)(e,(()=>{o&&o();const i=(0,n.YP)((()=>(0,s.A)().commands),(()=>{var o;i&&i(),clearTimeout(a),t(null===(o=e.value)||void 0===o?void 0:o.modelIds)})),a=setTimeout((()=>{var o;i&&i(),t(null===(o=e.value)||void 0===o?void 0:o.modelIds)}),400)}),{immediate:!1})},pe=(e,t)=>{const{activeSheetViewerState:o}=(0,u.nZ)(),i=(0,n.YP)((()=>o.value.editSession),(o=>{if(null===o){i&&i();const o=(0,n.YP)((()=>(0,s.A)().commands),(()=>{var n;o&&o(),clearTimeout(a),t(null===(n=e.value)||void 0===n?void 0:n.modelIds)})),a=setTimeout((()=>{var n;o&&o(),t(null===(n=e.value)||void 0===n?void 0:n.modelIds)}),400)}}))};function ve(){const e=(0,n.FN)().proxy,t=(0,i.JE)().T;!function(){const{document:e,isDirtyDocument:t}=(0,u.nZ)(),o=(0,m.FU)(),i=(0,p.Ds)((async()=>{await o.saveTemp(),await o.updateMemento(!1)}),2e3);(0,n.YP)(e,((e,n)=>{e&&n&&((0,m.FU)().source.startsWith("cloud://")||(0,m.FU)().source.startsWith("new://host.xmind.app")||(o.changeDirty(t()),i()))})),(0,n.YP)((()=>o.password),(async()=>{(0,m.FU)().source.startsWith("cloud://")||(0,m.FU)().source.startsWith("new://host.xmind.app")||(await o.saveTemp(),await o.updateMemento(!1))}))}(),_(),function(){const e=(0,m.FU)(),t=[e.addFileEventHook("open",(t=>{"postopen"===t&&e.source.startsWith("file:")&&setTimeout((()=>{K()}),2e3)})),e.addFileEventHook("save",(async t=>{"postsave"===t&&(e.startJob(),await K(),e.endJob(),(0,R.L9)({eventCategory:"Save",eventAction:"save",eventValue:1}))})),e.addFileEventHook("saveAs",(async t=>{"postsaveas"===t&&(e.startJob(),await K(),e.endJob(),(0,R.L9)({eventCategory:"Save",eventAction:"saveAs",eventValue:1}))}))];(0,n.Jd)((()=>{t.forEach((e=>e()))}))}(),function(){const{editorContainer:e,sheets:t,getSheetViewer:o,restorableBrowsingState:a,activeSheetViewerInited:l}=(0,u.nZ)(),s=(0,d.$)(),c=()=>{t.value.forEach((e=>{var t;return null===(t=o(e.id))||void 0===t?void 0:t.checkSize()}))},v=(0,p.Ds)(c,50),h=()=>{(0,r.E)().isResizeEditorSync?c():v()};(0,n.YP)((()=>s.editorMode),(()=>{"snowbrush"===s.editorMode&&h()}));let b=null;(0,n.bv)((()=>{(0,n.YP)(a,(e=>{var t;if(!l.value)return;if(!e)return;const{selection:o,zoomScale:n,activeSheetId:a,center:r}=e,{appendDocBrowsingInfo:d}=(0,i.km)(),s=null===(t=(0,m.FU)())||void 0===t?void 0:t.source;if(!s)return;const c="new://workbook"===s?`${s}/${window.editorId}`:s;if(!c)return;const[u,p]=(0,N.getCurrentWindow)().getSize();d({docURL:c,sheetId:a,selection:o,zoomScale:n,center:r,windowSize:{width:u,height:p}})})),(0,n.YP)((()=>e.value),(()=>{b&&(b.disconnect(),b=null),e.value&&(b=new ResizeObserver((()=>{h()})),b.observe(e.value))}))}))}(),ue(),Y(),(0,c.C)().initNotification(e,t);const{updateEditorVisible:o}=(0,r.E)();return{updateEditorVisible:o}}const he=(0,n.aZ)({__name:"editor",props:{progressIndicatorText:{default:""}},setup(e){const t=(0,n.RC)((()=>o.e(9891).then(o.bind(o,49891)))),c=(0,n.RC)((()=>Promise.all([o.e(6486),o.e(2118),o.e(2926)]).then(o.bind(o,2926)))),m=(0,n.RC)((()=>Promise.all([o.e(8592),o.e(6486),o.e(5361),o.e(715)]).then(o.bind(o,90715)))),p=(0,n.RC)((()=>o.e(9961).then(o.bind(o,19961)))),v=(0,n.RC)((()=>o.e(2366).then(o.bind(o,12366)))),h=(0,n.RC)((()=>Promise.all([o.e(5644),o.e(5300)]).then(o.bind(o,65300)))),b=(0,n.RC)((()=>o.e(6425).then(o.bind(o,76425)))),I=(0,n.RC)((()=>o.e(371).then(o.bind(o,60371)))),g=(0,n.RC)((()=>Promise.all([o.e(4761),o.e(3418)]).then(o.bind(o,83418)))),f=(0,n.RC)((()=>o.e(3292).then(o.bind(o,43292)))),y=(0,n.RC)((()=>o.e(6211).then(o.bind(o,46211)))),w=(0,n.RC)((()=>o.e(1592).then(o.bind(o,91592)))),T=(0,n.RC)((()=>o.e(4283).then(o.bind(o,34283)))),S=(0,n.RC)((()=>Promise.all([o.e(8396),o.e(7182)]).then(o.bind(o,7182)))),k=(0,n.RC)((()=>Promise.all([o.e(8396),o.e(1270)]).then(o.bind(o,31270)))),E=(0,u.pk)(),{selection:A,isInBranchOnly:F,executeEditorAction:P,changeLanguage:M}=(0,u.nZ)(),{updateEditorVisible:C}=ve(),{updateRightBarPanel:O,updateIconPanel:x,updateWorkbenchReady:R}=(0,d.$)(),L=(0,n.iH)(!1),B=(0,n.Fl)((()=>"cn"===(0,i.qr)().serviceRegion)),N=(0,n.Fl)((()=>(0,d.$)().isOutlinerMode)),V=(0,n.Fl)((()=>(0,d.$)().pitchMode)),U=(0,n.Fl)((()=>(0,d.$)().zenMode)),_=(0,n.Fl)((()=>{var e;return U.value&&(null===(e=(0,s.r)())||void 0===e?void 0:e.activeEditorId)===window.editorId})),q=(0,n.Fl)((()=>{var e;return null===(e=(0,s.A)())||void 0===e?void 0:e.aggregatedContexts["editor.inMapShotMode"]})),H=(0,n.Fl)((()=>(0,r.E)().isBeginnerModeVisible)),K=(0,n.Fl)((()=>""!==(0,r.E)().audioBarMode&&!N.value)),J=(0,n.Fl)((()=>F.value)),W=(0,n.Fl)((()=>{switch((0,d.$)().popoverEditorVisible){case"equation":return I;case"label":return b;case"notes":return g;case"markerpopup":return f;case"informationcard":return w;case"task":return y;case"comment":if(!B.value)return S}})),$=(0,n.Fl)((()=>(0,Z.c)().lastActiveCommentThreadId)),Y=(0,n.iH)(!1),z=e=>{Y.value=e},X=(0,n.iH)(null),j=e=>{X.value=e},Q=(0,n.iH)(null),G=e=>{Q.value=e};let ee;const te=(0,n.Fl)((()=>{var e,t;return{left:((null===(e=null==Q?void 0:Q.value)||void 0===e?void 0:e.left)||0)+"px",top:((null===(t=null==Q?void 0:Q.value)||void 0===t?void 0:t.top)||0)+"px",visibility:Y.value?"visible":"hidden"}})),oe=(0,n.iH)(null),ne=(0,n.Fl)((()=>(0,r.E)().sheetRendering)),ie=(e,t)=>{O({panel:e,tab:t})},ae=()=>{var e;(null===(e=A.value)||void 0===e?void 0:e.modelIds.length)>0?(0,d.$)().rightBarPanel===D.QN.THEME&&ie(D.QN.FORMAT,(0,d.$)().rightPanelTab[D.QN.FORMAT]):(0,d.$)().rightBarPanel===D.QN.FORMAT&&ie(D.QN.THEME,(0,d.$)().rightPanelTab[D.QN.THEME])};return(0,n.YP)((()=>A.value),(()=>{ae()})),(0,n.YP)((()=>(0,d.$)().editorMode),(e=>{O({visible:!1}),x({visible:!1}),e===l.hO&&(ie(D.QN.FORMAT),ae()),e===l.Pq&&ie(D.QN.IMAGE,D.ll.MARKER)})),(0,n.YP)((()=>(0,d.$)().zenMode),(e=>{O({visible:!1}),e?(x({visible:!1}),P({name:"mutateEditor:changeShowMapOverview",inputValue:!1})):(O({panel:D.QN.FORMAT}),ae())})),(0,n.YP)((()=>(0,i.S)().language),(e=>M(e)),{immediate:!0}),(0,n.YP)((0,u.nZ)().activeSheetViewerInited,(e=>{L.value=e})),(0,n.bv)((()=>{const e=document.getElementById("editor-container");E.setContainer(e),e.addEventListener("contextmenu",(e=>{const t=!!(0,i.si)().contexts["mindmap.inEditTitleMode"],o=e.target,n=o.closest('textarea, input[type="text"], [contenteditable="true"], [contenteditable=""]');t&&n&&(e.stopPropagation(),setTimeout((()=>{a.A.buildSpellContextMenu({content:document.getSelection().toString(),target:o,menuType:a.h.DEFAULT})}),100))}),{capture:!0}),C(!0),R(!0)})),(e=>{const{document:t,installHoverChangedTaskHandler:o}=(0,u.nZ)();o((o=>{var n;if(!o)return void e(null);const i=null===(n=t.value.query({id:o.topicId}))||void 0===n?void 0:n.asTopic();"todo-checkbox"===(null==i?void 0:i.taskPresentation)||"todo-progress"===(null==i?void 0:i.taskPresentation)?e({location:o.location,topic:i}):e(null)}))})((e=>{const t=(0,i.JE)().T;z(!1),ee&&(clearTimeout(ee),ee=null);if(!(!!e&&e.topic.taskPresentation))return;const o="task-info-progress"===e.topic.taskPresentation,n=Math.round(e.topic.taskProgress/1*100),a=o?`${n}%(${t("Click to edit")})`:`${n}%`;j(a),ee=setTimeout((()=>{var t,o,n,i;if(!e||!e.topic.taskPresentation)return void z(!1);const a=e.location;G({left:a.x-((null===(o=null===(t=oe.value)||void 0===t?void 0:t.getBoundingClientRect())||void 0===o?void 0:o.width)||0)/2+9,top:a.y-((null===(i=null===(n=oe.value)||void 0===n?void 0:n.getBoundingClientRect())||void 0===i?void 0:i.height)||0)-12}),z(!0)}),1e3)})),{__sfc:!0,TASK_TOOLTIP_SHOW_DELAY:1e3,TASK_TOOLTIP_LEFT_OFFSET:9,TASK_TOOLTIP_TOP_OFFSET:-12,Spinner:t,Pitch:c,ZenModeBar:m,BeginnerMode:p,BranchOnlyBar:v,AudioBar:h,LabelEditor:b,EquationEditor:I,NoteEditor:g,MarkerEditor:f,TaskEditor:y,Informationcard:w,TutorialDialog:T,CommentEditor:S,CommentPreview:k,snowdance:E,selection:A,isInBranchOnly:F,executeEditorAction:P,changeLanguage:M,updateEditorVisible:C,updateRightBarPanel:O,updateIconPanel:x,updateWorkbenchReady:R,isMindMapInited:L,isCN:B,isOutlineMode:N,isPitchMode:V,isZenMode:U,isZenModeBarVisible:_,isInMapShotMode:q,isBeginnerModeVisible:H,isAudioBarEnable:K,isBranchOnlyMode:J,currentPopoverEditor:W,lastActiveCommentThreadId:$,tooltipVisible:Y,changeTooltipVisible:z,tooltipContent:X,changeTooltipContent:j,tooltipLocation:Q,changeTooltipLocation:G,tooltipTimeout:ee,tooltipStyle:te,tooltipRef:oe,sheetRendering:ne,switchRightPanelTab:ie,updateRightPanelTab:ae}}});o(20258);const be=(0,o(51900).Z)(he,(function(){var e=this,t=e._self._c,o=e._self._setupProxy;return t("div",{staticClass:"uk-panel uk-position-cover uk-flex uk-flex-column uk-child-separator"},[o.isBranchOnlyMode&&!o.isInMapShotMode?t(o.BranchOnlyBar,{staticClass:"uk-position-absolute",staticStyle:{left:"20px",top:"20px","z-index":"1"}}):e._e(),e._v(" "),t("div",{staticClass:"uk-height-1-1 uk-width-1-1 uk-position-relative uk-background-default",attrs:{id:"zen-mode-container"}},[t("div",{directives:[{name:"focus-contexts",rawName:"v-focus-contexts:group",value:["focus.mindMap"],expression:"['focus.mindMap']",arg:"group"}],staticClass:"uk-panel uk-position-cover vk-scrollbar",attrs:{id:"editor-container"}}),e._v(" "),o.isAudioBarEnable?t(o.AudioBar,{directives:[{name:"show",rawName:"v-show",value:!o.isInMapShotMode,expression:"!isInMapShotMode"}]}):e._e(),e._v(" "),t(o.currentPopoverEditor,{tag:"component"}),e._v(" "),!o.isCN&&o.lastActiveCommentThreadId?t(o.CommentPreview):e._e(),e._v(" "),o.isZenModeBarVisible?[t(o.ZenModeBar),e._v(" "),t(o.Spinner,{directives:[{name:"show",rawName:"v-show",value:o.sheetRendering||!o.isMindMapInited,expression:"sheetRendering || !isMindMapInited"}],staticClass:"uk-position-cover sheet-rendering-mask",attrs:{text:e.progressIndicatorText}})]:e._e(),e._v(" "),t("transition",{attrs:{name:"beginner"}},[o.isBeginnerModeVisible&&!o.isZenMode?t(o.BeginnerMode):e._e()],1),e._v(" "),t("transition",{attrs:{name:"dialog"}},[t(o.TutorialDialog)],1),e._v(" "),t("div",{directives:[{name:"focus-contexts",rawName:"v-focus-contexts:group",value:["focus.popover"],expression:"['focus.popover']",arg:"group"}],attrs:{id:"popover-container-for-editor"}}),e._v(" "),o.isPitchMode?t(o.Pitch):e._e(),e._v(" "),o.tooltipContent?t("div",{ref:"tooltipRef",staticClass:"editor-tooltip",style:o.tooltipStyle},[e._v("\n      "+e._s(o.tooltipContent)+"\n    ")]):e._e()],2)],1)}),[],!1,null,"44614111",null).exports},20258:(e,t,o)=>{var n=o(71884);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,o(45346).Z)("625f39cf",n,!0,{})}}]);